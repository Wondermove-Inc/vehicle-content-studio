import { Meta } from "@storybook/addon-docs/blocks";

<Meta title="Introduction/Component Patterns" />

# Component Patterns

shadcn-storybook-registryì—ì„œ ì‚¬ìš©í•˜ëŠ” ê³ ê¸‰ ì»´í¬ë„ŒíŠ¸ íŒ¨í„´ì…ë‹ˆë‹¤.

## Compound Components

**Compound Components** íŒ¨í„´ì€ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ê°€ ì•”ë¬µì ìœ¼ë¡œ ìƒíƒœë¥¼ ê³µìœ í•˜ëŠ”
íŒ¨í„´ì…ë‹ˆë‹¤.

### ê°œë…

ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ê°€ Contextë¥¼ í†µí•´ ìì‹ ì»´í¬ë„ŒíŠ¸ë“¤ì—ê²Œ ìƒíƒœë¥¼ ì œê³µí•©ë‹ˆë‹¤:

```typescript
// âœ… Compound Components íŒ¨í„´
<Dialog>
  <DialogTrigger>Open</DialogTrigger>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>Title</DialogTitle>
      <DialogDescription>Description</DialogDescription>
    </DialogHeader>
  </DialogContent>
</Dialog>
```

### êµ¬í˜„ ì˜ˆì‹œ: Dialog

```typescript
import React from "react";

// Contextë¡œ ìƒíƒœ ê³µìœ 
const DialogContext = React.createContext<{
  open: boolean;
  setOpen: (open: boolean) => void;
}>({
  open: false,
  setOpen: () => {},
});

// ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸
function Dialog({ children }: { children: React.ReactNode }) {
  const [open, setOpen] = React.useState(false);

  return (
    <DialogContext.Provider value={{ open, setOpen }}>
      {children}
    </DialogContext.Provider>
  );
}

// ìì‹ ì»´í¬ë„ŒíŠ¸ë“¤ì´ Context ì‚¬ìš©
function DialogTrigger({ children }: { children: React.ReactNode }) {
  const { setOpen } = React.useContext(DialogContext);
  return <button onClick={() => setOpen(true)}>{children}</button>;
}

function DialogContent({ children }: { children: React.ReactNode }) {
  const { open, setOpen } = React.useContext(DialogContext);
  if (!open) return null;
  return (
    <div>
      {children}
      <button onClick={() => setOpen(false)}>Close</button>
    </div>
  );
}
```

### ì¥ì 

- âœ… **ì•”ë¬µì  ìƒíƒœ ê³µìœ **: props drilling ì œê±°
- âœ… **ìœ ì—°í•œ êµ¬ì„±**: ì»´í¬ë„ŒíŠ¸ ìˆœì„œì™€ êµ¬ì¡° ììœ ë¡­ê²Œ ë³€ê²½ ê°€ëŠ¥
- âœ… **ê°€ë…ì„±**: ì»´í¬ë„ŒíŠ¸ ê³„ì¸µì´ ëª…í™•í•¨

### shadcn/ui ì ìš© ì‚¬ë¡€

ë‹¤ìŒ ì»´í¬ë„ŒíŠ¸ë“¤ì´ Compound Components íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

- **Dialog**: `<Dialog>`, `<DialogTrigger>`, `<DialogContent>`, `<DialogHeader>`
- **Popover**: `<Popover>`, `<PopoverTrigger>`, `<PopoverContent>`
- **Accordion**: `<Accordion>`, `<AccordionItem>`, `<AccordionTrigger>`,
  `<AccordionContent>`
- **Tabs**: `<Tabs>`, `<TabsList>`, `<TabsTrigger>`, `<TabsContent>`
- **Select**: `<Select>`, `<SelectTrigger>`, `<SelectContent>`, `<SelectItem>`

## Render Props

**Render Props** íŒ¨í„´ì€ í•¨ìˆ˜ë¥¼ propìœ¼ë¡œ ì „ë‹¬í•˜ì—¬ ë Œë”ë§ì„ ìœ„ì„í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

### ê°œë…

ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ ë¡œì§ì„ ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ìŠµë‹ˆë‹¤:

```typescript
// âœ… Render Props íŒ¨í„´
<DataProvider
  render={(data) => (
    <div>
      {data.map((item) => (
        <Card key={item.id}>{item.name}</Card>
      ))}
    </div>
  )}
/>
```

### êµ¬í˜„ ì˜ˆì‹œ: DataProvider

```typescript
interface DataProviderProps<T> {
  data: T[];
  render: (data: T[]) => React.ReactNode;
  loading?: (isLoading: boolean) => React.ReactNode;
}

function DataProvider<T>({ data, render, loading }: DataProviderProps<T>) {
  const [isLoading, setIsLoading] = React.useState(true);
  const [items, setItems] = React.useState<T[]>([]);

  React.useEffect(() => {
    // ë°ì´í„° ë¡œë”© ì‹œë®¬ë ˆì´ì…˜
    setTimeout(() => {
      setItems(data);
      setIsLoading(false);
    }, 1000);
  }, [data]);

  if (isLoading && loading) {
    return <>{loading(isLoading)}</>;
  }

  return <>{render(items)}</>;
}

// ì‚¬ìš© ì˜ˆì‹œ
<DataProvider
  data={users}
  loading={(isLoading) => <Skeleton />}
  render={(users) => (
    <div>
      {users.map((user) => (
        <UserCard key={user.id} user={user} />
      ))}
    </div>
  )}
/>;
```

### Children as Function

`children`ì„ í•¨ìˆ˜ë¡œ ë°›ëŠ” ë³€í˜• íŒ¨í„´:

```typescript
interface ToggleProps {
  children: (isOn: boolean, toggle: () => void) => React.ReactNode;
}

function Toggle({ children }: ToggleProps) {
  const [isOn, setIsOn] = React.useState(false);
  const toggle = () => setIsOn(!isOn);

  return <>{children(isOn, toggle)}</>;
}

// ì‚¬ìš© ì˜ˆì‹œ
<Toggle>
  {(isOn, toggle) => (
    <Button onClick={toggle}>{isOn ? "ON" : "OFF"}</Button>
  )}
</Toggle>;
```

### ì¥ì 

- âœ… **ì¬ì‚¬ìš©ì„±**: ë¡œì§ê³¼ ë Œë”ë§ ë¶„ë¦¬
- âœ… **ìœ ì—°ì„±**: ë‹¤ì–‘í•œ UIë¥¼ ë™ì¼í•œ ë¡œì§ìœ¼ë¡œ êµ¬í˜„
- âœ… **Type Safety**: TypeScript ì œë„¤ë¦­ìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„± í™•ë³´

## Custom Hooks

**Custom Hooks**ëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë¡œì§ì„ ìº¡ìŠí™”í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

### ê°œë…

ì»´í¬ë„ŒíŠ¸ ë¡œì§ì„ í•¨ìˆ˜ë¡œ ì¶”ì¶œí•˜ì—¬ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤:

```typescript
// âœ… Custom Hook íŒ¨í„´
function useDialog() {
  const [open, setOpen] = React.useState(false);

  const openDialog = () => setOpen(true);
  const closeDialog = () => setOpen(false);
  const toggleDialog = () => setOpen(!open);

  return { open, openDialog, closeDialog, toggleDialog };
}

// ì‚¬ìš© ì˜ˆì‹œ
function MyComponent() {
  const dialog = useDialog();

  return (
    <>
      <Button onClick={dialog.openDialog}>Open Dialog</Button>
      <Dialog open={dialog.open} onOpenChange={dialog.setOpen}>
        <DialogContent>Hello</DialogContent>
      </Dialog>
    </>
  );
}
```

### êµ¬í˜„ ì˜ˆì‹œ: useToggle

```typescript
function useToggle(initialValue = false) {
  const [value, setValue] = React.useState(initialValue);

  const toggle = React.useCallback(() => {
    setValue((v) => !v);
  }, []);

  const setTrue = React.useCallback(() => {
    setValue(true);
  }, []);

  const setFalse = React.useCallback(() => {
    setValue(false);
  }, []);

  return { value, toggle, setTrue, setFalse };
}
```

### êµ¬í˜„ ì˜ˆì‹œ: useLocalStorage

```typescript
function useLocalStorage<T>(key: string, initialValue: T) {
  // ì´ˆê¸°ê°’ ë¡œë“œ
  const [storedValue, setStoredValue] = React.useState<T>(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(error);
      return initialValue;
    }
  });

  // ê°’ ì €ì¥
  const setValue = (value: T | ((val: T) => T)) => {
    try {
      const valueToStore =
        value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(error);
    }
  };

  return [storedValue, setValue] as const;
}

// ì‚¬ìš© ì˜ˆì‹œ
function ThemeToggle() {
  const [theme, setTheme] = useLocalStorage("theme", "light");

  return (
    <Button onClick={() => setTheme(theme === "light" ? "dark" : "light")}>
      {theme === "light" ? "ğŸŒ™" : "â˜€ï¸"}
    </Button>
  );
}
```

### shadcn/ui Custom Hooks

í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì£¼ìš” Custom Hooks:

#### useToast

```typescript
import { useToast } from "@/hooks/use-toast";

function MyComponent() {
  const { toast } = useToast();

  return (
    <Button
      onClick={() => {
        toast({
          title: "Success",
          description: "Operation completed successfully",
        });
      }}
    >
      Show Toast
    </Button>
  );
}
```

#### useMobile

```typescript
import { useMobile } from "@/hooks/use-mobile";

function ResponsiveComponent() {
  const isMobile = useMobile();

  return isMobile ? <MobileView /> : <DesktopView />;
}
```

### ì¥ì 

- âœ… **ë¡œì§ ì¬ì‚¬ìš©**: ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ ë¡œì§ ê³µìœ 
- âœ… **ê°€ë…ì„±**: ì»´í¬ë„ŒíŠ¸ ì½”ë“œ ê°„ê²°í™”
- âœ… **í…ŒìŠ¤íŠ¸ ìš©ì´**: Hookì„ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- âœ… **íƒ€ì… ì•ˆì „ì„±**: TypeScript ì œë„¤ë¦­ í™œìš©

## Controlled vs Uncontrolled

**Controlled**ì™€ **Uncontrolled** ì»´í¬ë„ŒíŠ¸ íŒ¨í„´ì…ë‹ˆë‹¤.

### Controlled Components

ìƒíƒœë¥¼ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ê°€ ì œì–´:

```typescript
function ControlledInput() {
  const [value, setValue] = React.useState("");

  return (
    <Input
      value={value}
      onChange={(e) => setValue(e.target.value)}
    />
  );
}
```

### Uncontrolled Components

ìƒíƒœë¥¼ DOMì´ ì œì–´ (`ref` ì‚¬ìš©):

```typescript
function UncontrolledInput() {
  const inputRef = React.useRef<HTMLInputElement>(null);

  const handleSubmit = () => {
    console.log(inputRef.current?.value);
  };

  return (
    <>
      <Input ref={inputRef} defaultValue="Hello" />
      <Button onClick={handleSubmit}>Submit</Button>
    </>
  );
}
```

### Hybrid Pattern

shadcn/uiëŠ” **Controlledì™€ Uncontrolledë¥¼ ëª¨ë‘ ì§€ì›**í•˜ëŠ” Hybrid íŒ¨í„´ì„
ì‚¬ìš©í•©ë‹ˆë‹¤:

```typescript
interface DialogProps {
  open?: boolean; // Controlled
  defaultOpen?: boolean; // Uncontrolled
  onOpenChange?: (open: boolean) => void;
}

function Dialog({ open, defaultOpen, onOpenChange }: DialogProps) {
  const [uncontrolledOpen, setUncontrolledOpen] = React.useState(
    defaultOpen ?? false
  );

  // Controlledì¸ ê²½ìš° open ì‚¬ìš©, Uncontrolledì¸ ê²½ìš° ë‚´ë¶€ ìƒíƒœ ì‚¬ìš©
  const isOpen = open !== undefined ? open : uncontrolledOpen;

  const handleOpenChange = (newOpen: boolean) => {
    if (open === undefined) {
      setUncontrolledOpen(newOpen);
    }
    onOpenChange?.(newOpen);
  };

  return (
    // Dialog êµ¬í˜„
    <div>{isOpen ? "Open" : "Closed"}</div>
  );
}

// Controlled ì‚¬ìš©
<Dialog open={open} onOpenChange={setOpen} />

// Uncontrolled ì‚¬ìš©
<Dialog defaultOpen={false} />
```

### ì„ íƒ ê¸°ì¤€

| Pattern          | ì‚¬ìš© ì‹œê¸°                    | ì˜ˆì‹œ                      |
| ---------------- | ---------------------------- | ------------------------- |
| **Controlled**   | ë¶€ëª¨ê°€ ìƒíƒœë¥¼ ê´€ë¦¬í•´ì•¼ í•  ë•Œ | Form validation, ë™ê¸°í™”   |
| **Uncontrolled** | ë‹¨ìˆœí•œ ì…ë ¥, ì„±ëŠ¥ ìµœì í™”     | Simple forms, file inputs |
| **Hybrid**       | ì–‘ìª½ ëª¨ë‘ ì§€ì›í•˜ê³  ì‹¶ì„ ë•Œ   | shadcn/ui ì»´í¬ë„ŒíŠ¸ë“¤      |

## Higher-Order Components (HOC)

**HOC**ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ì¸ìë¡œ ë°›ì•„ ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

### ê°œë…

```typescript
// HOC í•¨ìˆ˜
function withLoading<P extends object>(
  Component: React.ComponentType<P>
) {
  return function WithLoadingComponent({
    isLoading,
    ...props
  }: P & { isLoading: boolean }) {
    if (isLoading) {
      return <Skeleton />;
    }
    return <Component {...(props as P)} />;
  };
}

// ì‚¬ìš© ì˜ˆì‹œ
const UserCardWithLoading = withLoading(UserCard);

<UserCardWithLoading isLoading={true} user={user} />;
```

### êµ¬í˜„ ì˜ˆì‹œ: withAuth

```typescript
function withAuth<P extends object>(
  Component: React.ComponentType<P>
) {
  return function WithAuthComponent(props: P) {
    const { user, isAuthenticated } = useAuth();

    if (!isAuthenticated) {
      return <LoginPage />;
    }

    return <Component {...props} user={user} />;
  };
}

// ì‚¬ìš© ì˜ˆì‹œ
const ProtectedDashboard = withAuth(Dashboard);
```

### ì£¼ì˜ì‚¬í•­

- âš ï¸ **HOCëŠ” Modern Reactì—ì„œëŠ” Custom Hooksë¡œ ëŒ€ì²´ ê¶Œì¥**
- âš ï¸ Ref forwarding í•„ìš”
- âš ï¸ ë””ë²„ê¹… ì–´ë ¤ì›€

```typescript
// âŒ HOC ëŒ€ì‹ 
const UserCardWithLoading = withLoading(UserCard);

// âœ… Custom Hook ì‚¬ìš©
function UserCardWithLoading(props) {
  const { isLoading } = useUserData();
  if (isLoading) return <Skeleton />;
  return <UserCard {...props} />;
}
```

## Composition Pattern

**Composition** íŒ¨í„´ì€ ì‘ì€ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ì¡°í•©í•˜ì—¬ ë³µì¡í•œ UIë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.

### ê°œë…

```typescript
// âœ… Composition íŒ¨í„´
<Card>
  <CardHeader>
    <CardTitle>Title</CardTitle>
    <CardDescription>Description</CardDescription>
  </CardHeader>
  <CardContent>
    <p>Content</p>
  </CardContent>
  <CardFooter>
    <Button>Action</Button>
  </CardFooter>
</Card>
```

### ì¥ì 

- âœ… **ì¬ì‚¬ìš©ì„±**: ì‘ì€ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì–‘í•˜ê²Œ ì¡°í•©
- âœ… **ìœ ì—°ì„±**: í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¡°í•© ê°€ëŠ¥
- âœ… **ê°€ë…ì„±**: ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°ê°€ ëª…í™•

### êµ¬í˜„ ì˜ˆì‹œ: Card

```typescript
function Card({ children, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className="rounded-lg border bg-card text-card-foreground shadow-sm" {...props}>
      {children}
    </div>
  );
}

function CardHeader({ children, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className="flex flex-col space-y-1.5 p-6" {...props}>
      {children}
    </div>
  );
}

function CardTitle({ children, ...props }: React.HTMLAttributes<HTMLHeadingElement>) {
  return (
    <h3 className="text-2xl font-semibold leading-none tracking-tight" {...props}>
      {children}
    </h3>
  );
}

// ì‚¬ìš© ì˜ˆì‹œ: í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¡°í•©
<Card>
  <CardHeader>
    <CardTitle>Only Title</CardTitle>
  </CardHeader>
</Card>

<Card>
  <CardContent>
    <p>Only Content</p>
  </CardContent>
  <CardFooter>
    <Button>Action</Button>
  </CardFooter>
</Card>
```

## Polymorphic Components

**Polymorphic Components**ëŠ” `as` propìœ¼ë¡œ ë Œë”ë§í•  HTML íƒœê·¸ë¥¼ ë™ì ìœ¼ë¡œ
ë³€ê²½í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

### ê°œë…

```typescript
// âœ… Polymorphic Component
<Button as="a" href="/login">
  Login
</Button>

<Button as="div" onClick={handleClick}>
  Div Button
</Button>
```

### êµ¬í˜„ ì˜ˆì‹œ

```typescript
type PolymorphicProps<E extends React.ElementType> = {
  as?: E;
  children: React.ReactNode;
} & React.ComponentPropsWithoutRef<E>;

function Button<E extends React.ElementType = "button">({
  as,
  children,
  ...props
}: PolymorphicProps<E>) {
  const Component = as || "button";
  return (
    <Component className="btn" {...props}>
      {children}
    </Component>
  );
}

// ì‚¬ìš© ì˜ˆì‹œ
<Button>Default Button</Button>
<Button as="a" href="/home">Link Button</Button>
<Button as="div" role="button">Div Button</Button>
```

### ì¥ì 

- âœ… **ìœ ì—°ì„±**: ë™ì¼í•œ ìŠ¤íƒ€ì¼ë¡œ ë‹¤ì–‘í•œ HTML íƒœê·¸ ì‚¬ìš©
- âœ… **Type Safety**: TypeScriptë¡œ prop íƒ€ì… ìë™ ì¶”ë¡ 
- âœ… **ì ‘ê·¼ì„±**: ì˜¬ë°”ë¥¸ semantic HTML ì„ íƒ ê°€ëŠ¥

## Best Practices

### 1. Compound Components ìš°ì„  ì‚¬ìš©

ë³µì¡í•œ ìƒíƒœ ê³µìœ ê°€ í•„ìš”í•œ ê²½ìš° Compound Components ì‚¬ìš©:

```typescript
// âœ… Good: Compound Components
<Select>
  <SelectTrigger>Select</SelectTrigger>
  <SelectContent>
    <SelectItem value="1">Option 1</SelectItem>
  </SelectContent>
</Select>

// âŒ Bad: ëª¨ë“  propsë¥¼ ë¶€ëª¨ì—ê²Œ ì „ë‹¬
<Select
  trigger={<button>Select</button>}
  content={[{ value: "1", label: "Option 1" }]}
/>
```

### 2. Custom Hooksë¡œ ë¡œì§ ë¶„ë¦¬

ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë¡œì§ì€ Custom Hookìœ¼ë¡œ ì¶”ì¶œ:

```typescript
// âœ… Good: Custom Hook
function useFormValidation(schema) {
  const [errors, setErrors] = React.useState({});
  const validate = (data) => {
    // validation ë¡œì§
  };
  return { errors, validate };
}

// âŒ Bad: ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ë¡œì§ ì¤‘ë³µ
function Form1() {
  const [errors, setErrors] = React.useState({});
  // validation ë¡œì§ ì¤‘ë³µ
}
```

### 3. TypeScript ì œë„¤ë¦­ í™œìš©

íƒ€ì… ì•ˆì „ì„±ì„ ìœ„í•´ ì œë„¤ë¦­ ì‚¬ìš©:

```typescript
// âœ… Good: ì œë„¤ë¦­ìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„± í™•ë³´
function useData<T>(fetcher: () => Promise<T>) {
  const [data, setData] = React.useState<T | null>(null);
  // ...
  return data;
}

// âŒ Bad: any ì‚¬ìš©
function useData(fetcher: () => Promise<any>) {
  // ...
}
```

## Resources

- [React Patterns](https://reactpatterns.com)
- [Compound Components](https://kentcdodds.com/blog/compound-components-with-react-hooks)
- [Custom Hooks](https://react.dev/learn/reusing-logic-with-custom-hooks)
- [Render Props](https://react.dev/reference/react/cloneElement#passing-data-with-a-render-prop)
- [Polymorphic Components](https://www.benmvp.com/blog/polymorphic-react-components-typescript/)
