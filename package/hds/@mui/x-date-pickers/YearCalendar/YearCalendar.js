import e from"../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import r from"../../../@babel/runtime/helpers/esm/extends.js";import*as o from"react";import t from"../../../prop-types/index.js";import{clsx as a}from"../node_modules/clsx/dist/clsx.js";import{useRtl as s}from"../../system/esm/RtlProvider/index.js";import{PickersYear as l}from"./PickersYear.js";import{useNow as n,useUtils as i,useDefaultDates as u}from"../internals/hooks/useUtils.js";import{getYearCalendarUtilityClass as c}from"./yearCalendarClasses.js";import{applyDefaultDate as m}from"../internals/utils/date-utils.js";import{singleItemValueManager as f}from"../internals/utils/valueManagers.js";import{SECTION_TYPE_GRANULARITY as d}from"../internals/utils/getDefaultReferenceDate.js";import{useControlledValueWithTimezone as p}from"../internals/hooks/useValueWithTimezone.js";import{DIALOG_WIDTH as b,MAX_CALENDAR_HEIGHT as g}from"../internals/constants/dimensions.js";import{jsx as h}from"react/jsx-runtime";import j from"../../material/styles/styled.js";import y from"../../utils/useControlled/useControlled.js";import D from"../../utils/useEventCallback/useEventCallback.js";import Y from"../../utils/useForkRef/useForkRef.js";import v from"../../utils/composeClasses/composeClasses.js";import x from"../../material/styles/useThemeProps.js";const w=["autoFocus","className","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","readOnly","shouldDisableYear","disableHighlightToday","onYearFocus","hasFocus","onFocusedViewChange","yearsPerRow","timezone","gridLabelId","slots","slotProps"];const C=j("div",{name:"MuiYearCalendar",slot:"Root",overridesResolver:(e,r)=>r.root})({display:"flex",flexDirection:"row",flexWrap:"wrap",overflowY:"auto",height:"100%",padding:"0 4px",width:b,maxHeight:g,boxSizing:"border-box",position:"relative"}),F=o.forwardRef((function(t,b){const g=function(e,o){const t=i(),a=u(),s=x({props:e,name:o});return r({disablePast:!1,disableFuture:!1},s,{yearsPerRow:s.yearsPerRow??3,minDate:m(t,s.minDate,a.minDate),maxDate:m(t,s.maxDate,a.maxDate)})}(t,"MuiYearCalendar"),{autoFocus:j,className:F,value:P,defaultValue:R,referenceDate:k,disabled:V,disableFuture:T,disablePast:O,maxDate:z,minDate:M,onChange:A,readOnly:E,shouldDisableYear:N,onYearFocus:H,hasFocus:I,onFocusedViewChange:L,yearsPerRow:S,timezone:B,gridLabelId:W,slots:U,slotProps:_}=g,q=e(g,w),{value:K,handleValueChange:G,timezone:J}=p({name:"YearCalendar",timezone:B,value:P,defaultValue:R,onChange:A,valueManager:f}),Q=n(J),X=s(),Z=i(),$=o.useMemo((()=>f.getInitialReferenceValue({value:K,utils:Z,props:g,timezone:J,referenceDate:k,granularity:d.year})),[]),ee=g,re=(e=>{const{classes:r}=e;return v({root:["root"]},c,r)})(ee),oe=o.useMemo((()=>Z.getYear(Q)),[Z,Q]),te=o.useMemo((()=>null!=K?Z.getYear(K):null),[K,Z]),[ae,se]=o.useState((()=>te||Z.getYear($))),[le,ne]=y({name:"YearCalendar",state:"hasFocus",controlled:I,default:j??!1}),ie=D((e=>{ne(e),L&&L(e)})),ue=o.useCallback((e=>{if(O&&Z.isBeforeYear(e,Q))return!0;if(T&&Z.isAfterYear(e,Q))return!0;if(M&&Z.isBeforeYear(e,M))return!0;if(z&&Z.isAfterYear(e,z))return!0;if(!N)return!1;const r=Z.startOfYear(e);return N(r)}),[T,O,z,M,Q,N,Z]),ce=D(((e,r)=>{if(E)return;const o=Z.setYear(K??$,r);G(o)})),me=D((e=>{ue(Z.setYear(K??$,e))||(se(e),ie(!0),H?.(e))}));o.useEffect((()=>{se((e=>null!==te&&e!==te?te:e))}),[te]);const fe=D(((e,r)=>{switch(e.key){case"ArrowUp":me(r-S),e.preventDefault();break;case"ArrowDown":me(r+S),e.preventDefault();break;case"ArrowLeft":me(r+(X?1:-1)),e.preventDefault();break;case"ArrowRight":me(r+(X?-1:1)),e.preventDefault()}})),de=D(((e,r)=>{me(r)})),pe=D(((e,r)=>{ae===r&&ie(!1)})),be=o.useRef(null),ge=Y(b,be);return o.useEffect((()=>{if(j||null===be.current)return;const e=be.current.querySelector('[tabindex="0"]');if(!e)return;const r=e.offsetHeight,o=e.offsetTop,t=be.current.clientHeight,a=be.current.scrollTop,s=o+r;r>t||o<a||(be.current.scrollTop=s-t/2-r/2)}),[j]),h(C,r({ref:ge,className:a(re.root,F),ownerState:ee,role:"radiogroup","aria-labelledby":W},q,{children:Z.getYearRange([M,z]).map((e=>{const r=Z.getYear(e),o=r===te,t=V||ue(e);return h(l,{selected:o,value:r,onClick:ce,onKeyDown:fe,autoFocus:le&&r===ae,disabled:t,tabIndex:r!==ae||t?-1:0,onFocus:de,onBlur:pe,"aria-current":oe===r?"date":void 0,yearsPerRow:S,slots:U,slotProps:_,children:Z.format(e,"year")},Z.format(e,"year"))}))}))}));"production"!==process.env.NODE_ENV&&(F.propTypes={autoFocus:t.bool,classes:t.object,className:t.string,defaultValue:t.object,disabled:t.bool,disableFuture:t.bool,disableHighlightToday:t.bool,disablePast:t.bool,gridLabelId:t.string,hasFocus:t.bool,maxDate:t.object,minDate:t.object,onChange:t.func,onFocusedViewChange:t.func,onYearFocus:t.func,readOnly:t.bool,referenceDate:t.object,shouldDisableYear:t.func,slotProps:t.object,slots:t.object,sx:t.oneOfType([t.arrayOf(t.oneOfType([t.func,t.object,t.bool])),t.func,t.object]),timezone:t.string,value:t.object,yearsPerRow:t.oneOf([3,4])});export{F as YearCalendar};
