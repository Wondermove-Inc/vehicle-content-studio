import e from"../../../../@babel/runtime/helpers/esm/extends.js";import t from"../../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as r from"react";import{getPickersPopperUtilityClass as o}from"./pickersPopperClasses.js";import{getActiveElement as n}from"../utils/utils.js";import{useDefaultReduceAnimations as s}from"../hooks/useDefaultReduceAnimations.js";import{jsx as a}from"react/jsx-runtime";import c from"../../../material/styles/styled.js";import p from"../../../material/Popper/Popper.js";import i from"../../../material/Paper/Paper.js";import u from"../../../material/styles/useThemeProps.js";import l from"../../../utils/useForkRef/useForkRef.js";import m from"../../../material/Fade/Fade.js";import d from"../../../material/Grow/Grow.js";import{FocusTrap as f}from"../../../base/FocusTrap/FocusTrap.js";import{useSlotProps as P}from"../../../base/utils/useSlotProps.js";import h from"../../../utils/composeClasses/composeClasses.js";import E from"../../../utils/useEventCallback/useEventCallback.js";import v from"../../../utils/ownerDocument/ownerDocument.js";const k=["PaperComponent","popperPlacement","ownerState","children","paperSlotProps","paperClasses","onPaperClick","onPaperTouchStart"],j=c(p,{name:"MuiPickersPopper",slot:"Root",overridesResolver:(e,t)=>t.root})((({theme:e})=>({zIndex:e.zIndex.modal}))),T=c(i,{name:"MuiPickersPopper",slot:"Paper",overridesResolver:(e,t)=>t.paper})({outline:0,transformOrigin:"top center",variants:[{props:({placement:e})=>["top","top-start","top-end"].includes(e),style:{transformOrigin:"bottom center"}}]});const S=r.forwardRef(((r,o)=>{const{PaperComponent:n,popperPlacement:s,ownerState:c,children:p,paperSlotProps:i,paperClasses:u,onPaperClick:l,onPaperTouchStart:m}=r,d=t(r,k),f=e({},c,{placement:s}),h=P({elementType:n,externalSlotProps:i,additionalProps:{tabIndex:-1,elevation:8,ref:o},className:u,ownerState:f});return a(n,e({},d,h,{onClick:e=>{l(e),h.onClick?.(e)},onTouchStart:e=>{m(e),h.onTouchStart?.(e)},ownerState:f,children:p}))}));function w(t){const c=u({props:t,name:"MuiPickersPopper"}),{anchorEl:p,children:i,containerRef:k=null,shouldRestoreFocus:w,onBlur:C,onDismiss:R,open:b,role:L,placement:F,slots:y,slotProps:x,reduceAnimations:g}=c;r.useEffect((()=>{function e(e){b&&"Escape"===e.key&&R()}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[R,b]);const D=r.useRef(null);r.useEffect((()=>{"tooltip"===L||w&&!w()||(b?D.current=n(document):D.current&&D.current instanceof HTMLElement&&setTimeout((()=>{D.current instanceof HTMLElement&&D.current.focus()})))}),[b,L,w]);const[M,A,H]=function(e,t){const o=r.useRef(!1),n=r.useRef(!1),s=r.useRef(null),a=r.useRef(!1);r.useEffect((()=>{if(e)return document.addEventListener("mousedown",t,!0),document.addEventListener("touchstart",t,!0),()=>{document.removeEventListener("mousedown",t,!0),document.removeEventListener("touchstart",t,!0),a.current=!1};function t(){a.current=!0}}),[e]);const c=E((e=>{if(!a.current)return;const r=n.current;n.current=!1;const c=v(s.current);if(!s.current||"clientX"in e&&function(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}(e,c))return;if(o.current)return void(o.current=!1);let p;p=e.composedPath?e.composedPath().indexOf(s.current)>-1:!c.documentElement.contains(e.target)||s.current.contains(e.target),p||r||t(e)})),p=()=>{n.current=!0};return r.useEffect((()=>{if(e){const e=v(s.current),t=()=>{o.current=!0};return e.addEventListener("touchstart",c),e.addEventListener("touchmove",t),()=>{e.removeEventListener("touchstart",c),e.removeEventListener("touchmove",t)}}}),[e,c]),r.useEffect((()=>{if(e){const e=v(s.current);return e.addEventListener("click",c),()=>{e.removeEventListener("click",c),n.current=!1}}}),[e,c]),[s,p,p]}(b,C??R),I=r.useRef(null),O=l(I,k),z=l(O,M),G=c,N=(e=>{const{classes:t}=e;return h({root:["root"],paper:["paper"]},o,t)})(G),W=s(),X=g??W,B=y?.desktopTransition??X?m:d,K=y?.desktopTrapFocus??f,Y=y?.desktopPaper??T,q=y?.popper??j,J=P({elementType:q,externalSlotProps:x?.popper,additionalProps:{transition:!0,role:L,open:b,anchorEl:p,placement:F,onKeyDown:e=>{"Escape"===e.key&&(e.stopPropagation(),R())}},className:N.root,ownerState:c});return a(q,e({},J,{children:({TransitionProps:t,placement:r})=>a(K,e({open:b,disableAutoFocus:!0,disableRestoreFocus:!0,disableEnforceFocus:"tooltip"===L,isEnabled:()=>!0},x?.desktopTrapFocus,{children:a(B,e({},t,x?.desktopTransition,{children:a(S,{PaperComponent:Y,ownerState:G,popperPlacement:r,ref:z,onPaperClick:A,onPaperTouchStart:H,paperClasses:N.paper,paperSlotProps:x?.desktopPaper,children:i})}))}))}))}export{w as PickersPopper};
