import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{useOpenState as a}from"../useOpenState.js";import{useUtils as o,useLocalizationContext as l}from"../useUtils.js";import{useValidation as n}from"../useValidation.js";import{useValueWithTimezone as r}from"../useValueWithTimezone.js";import s from"../../../../utils/useEventCallback/useEventCallback.js";const i=({props:i,valueManager:u,valueType:c,wrapperVariant:d,validator:m})=>{const{onAccept:p,onChange:V,value:h,defaultValue:f,closeOnSelect:v="desktop"===d,timezone:C}=i,{current:S}=t.useRef(f),{current:g}=t.useRef(void 0!==h);"production"!==process.env.NODE_ENV&&(t.useEffect((()=>{g!==(void 0!==h)&&console.error([`MUI X: A component is changing the ${g?"":"un"}controlled value of a picker to be ${g?"un":""}controlled.`,"Elements should not switch from uncontrolled to controlled (or vice versa).","Decide between using a controlled or uncontrolled valuefor the lifetime of the component.","The nature of the state is determined during the first render. It's considered controlled if the value is not `undefined`.","More info: https://fb.me/react-controlled-components"].join("\n"))}),[h]),t.useEffect((()=>{g||S===f||console.error(["MUI X: A component is changing the defaultValue of an uncontrolled picker after being initialized. To suppress this warning opt to use a controlled value."].join("\n"))}),[JSON.stringify(S)]));const F=o(),A=l(),{isOpen:b,setIsOpen:M}=a(i),[E,k]=t.useState((()=>{let e;return e=void 0!==h?h:void 0!==S?S:u.emptyValue,{draft:e,lastPublishedValue:e,lastCommittedValue:e,lastControlledValue:h,hasBeenModifiedSinceMount:!1}})),{timezone:P,handleValueChange:w}=r({timezone:C,value:h,defaultValue:S,onChange:V,valueManager:u});n(e({},i,{value:E.draft,timezone:P}),m,u.isSameError,u.defaultErrorState);const y=s((t=>{const a={action:t,dateState:E,hasChanged:e=>!u.areValuesEqual(F,t.value,e),isControlled:g,closeOnSelect:v},o=(e=>{const{action:t,hasChanged:a,dateState:o,isControlled:l}=e,n=!l&&!o.hasBeenModifiedSinceMount;return"setValueFromField"===t.name||("setValueFromAction"===t.name?!(!n||!["accept","today","clear"].includes(t.pickerAction))||a(o.lastPublishedValue):("setValueFromView"===t.name&&"shallow"!==t.selectionState||"setValueFromShortcut"===t.name)&&(!!n||a(o.lastPublishedValue)))})(a),l=(e=>{const{action:t,hasChanged:a,dateState:o,isControlled:l,closeOnSelect:n}=e,r=!l&&!o.hasBeenModifiedSinceMount;return"setValueFromAction"===t.name?!(!r||!["accept","today","clear"].includes(t.pickerAction))||a(o.lastCommittedValue):"setValueFromView"===t.name&&"finish"===t.selectionState&&n?!!r||a(o.lastCommittedValue):"setValueFromShortcut"===t.name&&"accept"===t.changeImportance&&a(o.lastCommittedValue)})(a),n=(e=>{const{action:t,closeOnSelect:a}=e;return"setValueFromAction"===t.name||("setValueFromView"===t.name?"finish"===t.selectionState&&a:"setValueFromShortcut"===t.name&&"accept"===t.changeImportance)})(a);if(k((a=>e({},a,{draft:t.value,lastPublishedValue:o?t.value:a.lastPublishedValue,lastCommittedValue:l?t.value:a.lastCommittedValue,hasBeenModifiedSinceMount:!0}))),o){const a={validationError:"setValueFromField"===t.name?t.context.validationError:m({adapter:A,value:t.value,props:e({},i,{value:t.value,timezone:P})})};"setValueFromShortcut"===t.name&&(a.shortcut=t.shortcut),w(t.value,a)}l&&p&&p(t.value),n&&M(!1)}));if(void 0!==h&&(void 0===E.lastControlledValue||!u.areValuesEqual(F,E.lastControlledValue,h))){const t=u.areValuesEqual(F,E.draft,h);k((a=>e({},a,{lastControlledValue:h},t?{}:{lastCommittedValue:h,lastPublishedValue:h,draft:h,hasBeenModifiedSinceMount:!0})))}const O=s((()=>{y({value:u.emptyValue,name:"setValueFromAction",pickerAction:"clear"})})),j=s((()=>{y({value:E.lastPublishedValue,name:"setValueFromAction",pickerAction:"accept"})})),z=s((()=>{y({value:E.lastPublishedValue,name:"setValueFromAction",pickerAction:"dismiss"})})),I=s((()=>{y({value:E.lastCommittedValue,name:"setValueFromAction",pickerAction:"cancel"})})),T=s((()=>{y({value:u.getTodayValue(F,P,c),name:"setValueFromAction",pickerAction:"today"})})),B=s((e=>{e.preventDefault(),M(!0)})),D=s((e=>{e?.preventDefault(),M(!1)})),x=s(((e,t="partial")=>y({name:"setValueFromView",value:e,selectionState:t}))),q=s(((e,t,a)=>y({name:"setValueFromShortcut",value:e,changeImportance:t,shortcut:a}))),N=s(((e,t)=>y({name:"setValueFromField",value:e,context:t}))),U={onClear:O,onAccept:j,onDismiss:z,onCancel:I,onSetToday:T,onOpen:B,onClose:D},R={value:E.draft,onChange:N},X=t.useMemo((()=>u.cleanValue(F,E.draft)),[F,u,E.draft]);return{open:b,fieldProps:R,viewProps:{value:X,onChange:x,onClose:D,open:b},layoutProps:e({},U,{value:X,onChange:x,onSelectShortcut:q,isValid:t=>{const a=m({adapter:A,value:t,props:e({},i,{value:t,timezone:P})});return!u.hasError(a)}}),actions:U}};export{i as usePickerValue};
