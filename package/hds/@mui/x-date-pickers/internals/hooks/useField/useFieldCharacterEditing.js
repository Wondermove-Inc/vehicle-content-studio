import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{useUtils as n}from"../useUtils.js";import{isStringNumber as r,applyLocalizedDigits as o,doesSectionFormatHaveLeadingZeros as s,changeSectionValueFormat as u,getDaysInWeekStr as i,getDateSectionConfigFromFormatToken as a,removeLocalizedDigits as c,cleanDigitSectionValue as l,getLetterEditingOptions as m}from"./useField.utils.js";import y from"../../../../utils/useEventCallback/useEventCallback.js";const f=e=>null!=e.saveQuery,d=({sections:d,updateSectionValue:p,sectionsValueBoundaries:h,localizedDigits:x,setTempAndroidValueStr:T,timezone:v})=>{const g=n(),[V,S]=t.useState(null),Q=y((()=>S(null)));t.useEffect((()=>{null!=V&&d[V.sectionIndex]?.type!==V.sectionType&&Q()}),[d,V,Q]),t.useEffect((()=>{if(null!=V){const e=setTimeout((()=>Q()),5e3);return()=>{clearTimeout(e)}}return()=>{}}),[V,Q]);const k=({keyPressed:e,sectionIndex:t},n,r)=>{const o=e.toLowerCase(),s=d[t];if(null!=V&&(!r||r(V.value))&&V.sectionIndex===t){const e=`${V.value}${o}`,r=n(e,s);if(!f(r))return S({sectionIndex:t,value:e,sectionType:s.type}),r}const u=n(o,s);return f(u)&&!u.saveQuery?(Q(),null):(S({sectionIndex:t,value:o,sectionType:s.type}),f(u)?null:u)};return{applyCharacterEditing:y((t=>{const n=d[t.sectionIndex],y=r(t.keyPressed,x)?(t=>{const n=(e,t)=>{const n=c(e,x),r=Number(n),o=h[t.type]({currentDate:null,format:t.format,contentType:t.contentType});if(r>o.maximum)return{saveQuery:!1};if(r<o.minimum)return{saveQuery:!0};const s=10*r>o.maximum||n.length===o.maximum.toString().length;return{sectionValue:l(g,r,o,x,t),shouldGoToNextSection:s}};return k(t,((t,r)=>{if("digit"===r.contentType||"digit-with-letter"===r.contentType)return n(t,r);if("month"===r.type){const o=s(g,v,"digit","month","MM"),i=n(t,{type:r.type,format:"MM",hasLeadingZerosInFormat:o,hasLeadingZerosInInput:!0,contentType:"digit",maxLength:2});if(f(i))return i;const a=u(g,i.sectionValue,"MM",r.format);return e({},i,{sectionValue:a})}if("weekDay"===r.type){const o=n(t,r);if(f(o))return o;const s=i(g,v,r.format)[Number(o.sectionValue)-1];return e({},o,{sectionValue:s})}return{saveQuery:!1}}),(e=>r(e,x)))})(e({},t,{keyPressed:o(t.keyPressed,x)})):(t=>{const n=(e,t,n)=>{const r=t.filter((e=>e.toLowerCase().startsWith(n)));return 0===r.length?{saveQuery:!1}:{sectionValue:r[0],shouldGoToNextSection:1===r.length}},r=(t,r,o,s)=>{const u=e=>m(g,v,r.type,e);if("letter"===r.contentType)return n(r.format,u(r.format),t);if(o&&null!=s&&"letter"===a(g,o).contentType){const r=u(o),i=n(0,r,t);return f(i)?{saveQuery:!1}:e({},i,{sectionValue:s(i.sectionValue,r)})}return{saveQuery:!1}};return k(t,((e,t)=>{switch(t.type){case"month":{const n=e=>u(g,e,g.formats.month,t.format);return r(e,t,g.formats.month,n)}case"weekDay":{const n=(e,t)=>t.indexOf(e).toString();return r(e,t,g.formats.weekday,n)}case"meridiem":return r(e,t);default:return{saveQuery:!1}}}))})(t);null!=y?p({activeSection:n,newSectionValue:y.sectionValue,shouldGoToNextSection:y.shouldGoToNextSection}):T(null)})),resetCharacterQuery:Q}};export{d as useFieldCharacterEditing};
