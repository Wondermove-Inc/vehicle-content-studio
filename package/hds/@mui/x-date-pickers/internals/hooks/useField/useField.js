import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{useRtl as r}from"../../../../system/esm/RtlProvider/index.js";import{useValidation as s}from"../useValidation.js";import{useUtils as l}from"../useUtils.js";import{getSectionOrder as o,adjustSectionValue as a}from"./useField.utils.js";import{useFieldState as i}from"./useFieldState.js";import{useFieldCharacterEditing as n}from"./useFieldCharacterEditing.js";import{useFieldV7TextField as c}from"./useFieldV7TextField.js";import{useFieldV6TextField as d}from"./useFieldV6TextField.js";import u from"../../../../utils/useEventCallback/useEventCallback.js";import m from"../../../../utils/useEnhancedEffect/useEnhancedEffect.js";const f=f=>{const p=l(),{internalProps:S,internalProps:{unstableFieldRef:v,minutesStep:b,enableAccessibleFieldDOMStructure:y=!1,disabled:F=!1,readOnly:D=!1},forwardedProps:{onKeyDown:V,error:g,clearable:x,onClear:k},fieldValueManager:E,valueManager:h,validator:w}=f,A=r(),j=i(f),{state:I,activeSectionIndex:M,parsedSelectedSections:C,setSelectedSections:P,clearValue:K,clearActiveSection:O,updateSectionValue:T,setTempAndroidValueStr:z,sectionsValueBoundaries:B,localizedDigits:R,timezone:U}=j,H=n({sections:I.sections,updateSectionValue:T,sectionsValueBoundaries:B,localizedDigits:R,setTempAndroidValueStr:z,timezone:U}),{resetCharacterQuery:L}=H,q=h.areValuesEqual(p,I.value,h.emptyValue),G=y?c:d,N=t.useMemo((()=>o(I.sections,A&&!y)),[I.sections,A,y]),{returnedValue:Q,interactions:J}=G(e({},f,j,H,{areAllSectionsEmpty:q,sectionOrder:N})),W=u((e=>{switch(V?.(e),!0){case(e.ctrlKey||e.metaKey)&&"a"===e.key.toLowerCase()&&!e.shiftKey&&!e.altKey:e.preventDefault(),P("all");break;case"ArrowRight"===e.key:if(e.preventDefault(),null==C)P(N.startIndex);else if("all"===C)P(N.endIndex);else{const e=N.neighbors[C].rightIndex;null!==e&&P(e)}break;case"ArrowLeft"===e.key:if(e.preventDefault(),null==C)P(N.endIndex);else if("all"===C)P(N.startIndex);else{const e=N.neighbors[C].leftIndex;null!==e&&P(e)}break;case"Delete"===e.key:if(e.preventDefault(),D)break;null==C||"all"===C?K():O(),L();break;case["ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(e.key):{if(e.preventDefault(),D||null==M)break;const t=I.sections[M],r=E.getActiveDateManager(p,I,t),s=a(p,U,t,e.key,B,R,r.date,{minutesStep:b});T({activeSection:t,newSectionValue:s,shouldGoToNextSection:!1});break}}}));m((()=>{J.syncSelectionToDOM()}));const X=s(e({},S,{value:I.value,timezone:U}),w,h.isSameError,h.defaultErrorState),Y=t.useMemo((()=>void 0!==g?g:h.hasError(X)),[h,X,g]);t.useEffect((()=>{Y||null!=M||L()}),[I.referenceValue,M,Y]),t.useEffect((()=>{null!=I.tempValueStrAndroid&&null!=M&&(L(),O())}),[I.sections]),t.useImperativeHandle(v,(()=>({getSections:()=>I.sections,getActiveSectionIndex:J.getActiveSectionIndexFromDOM,setSelectedSections:J.setSelectedSections,focusField:J.focusField,isFieldFocused:J.isFieldFocused})));const Z={onKeyDown:W,onClear:u(((e,...t)=>{e.preventDefault(),k?.(e,...t),K(),J.isFieldFocused()?P(N.startIndex):J.focusField(0)})),error:Y,clearable:Boolean(x&&!q&&!D&&!F)},$={disabled:F,readOnly:D};return e({},f.forwardedProps,Z,$,Q)};export{f as useField};
