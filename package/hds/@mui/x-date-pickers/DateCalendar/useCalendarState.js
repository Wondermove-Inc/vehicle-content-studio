import e from"../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{useIsDateDisabled as n}from"./useIsDateDisabled.js";import{useUtils as i}from"../internals/hooks/useUtils.js";import{singleItemValueManager as a}from"../internals/utils/valueManagers.js";import{SECTION_TYPE_GRANULARITY as o}from"../internals/utils/getDefaultReferenceDate.js";import s from"../../utils/useEventCallback/useEventCallback.js";const r=(t,n,i)=>(a,o)=>{switch(o.type){case"changeMonth":return e({},a,{slideDirection:o.direction,currentMonth:o.newMonth,isMonthSwitchingAnimating:!t});case"finishMonthSwitchingAnimation":return e({},a,{isMonthSwitchingAnimating:!1});case"changeFocusedDay":{if(null!=a.focusedDay&&null!=o.focusedDay&&i.isSameDay(o.focusedDay,a.focusedDay))return a;const s=null!=o.focusedDay&&!n&&!i.isSameMonth(a.currentMonth,o.focusedDay);return e({},a,{focusedDay:o.focusedDay,isMonthSwitchingAnimating:s&&!t&&!o.withoutMonthSwitchingAnimation,currentMonth:s?i.startOfMonth(o.focusedDay):a.currentMonth,slideDirection:null!=o.focusedDay&&i.isAfterDay(o.focusedDay,a.currentMonth)?"left":"right"})}default:throw new Error("missing support")}},c=c=>{const{value:u,referenceDate:h,disableFuture:l,disablePast:D,disableSwitchToMonthOnDayFocus:f=!1,maxDate:d,minDate:m,onMonthChange:M,reduceAnimations:g,shouldDisableDate:y,timezone:w}=c,p=i(),b=t.useRef(r(Boolean(g),f,p)).current,S=t.useMemo((()=>a.getInitialReferenceValue({value:u,utils:p,timezone:w,props:c,referenceDate:h,granularity:o.day})),[]),[A,C]=t.useReducer(b,{isMonthSwitchingAnimating:!1,focusedDay:S,currentMonth:p.startOfMonth(S),slideDirection:"left"}),j=t.useCallback((t=>{C(e({type:"changeMonth"},t)),M&&M(t.newMonth)}),[M]),k=t.useCallback((e=>{const t=e;p.isSameMonth(t,A.currentMonth)||j({newMonth:p.startOfMonth(t),direction:p.isAfterDay(t,A.currentMonth)?"left":"right"})}),[A.currentMonth,j,p]),F=n({shouldDisableDate:y,minDate:m,maxDate:d,disableFuture:l,disablePast:D,timezone:w}),v=t.useCallback((()=>{C({type:"finishMonthSwitchingAnimation"})}),[]),x=s(((e,t)=>{F(e)||C({type:"changeFocusedDay",focusedDay:e,withoutMonthSwitchingAnimation:t})}));return{referenceDate:S,calendarState:A,changeMonth:k,changeFocusedDay:x,isDateDisabled:F,onMonthSwitchingAnimationEnd:v,handleChangeMonth:j}};export{r as createCalendarStateReducer,c as useCalendarState};
