import e from"../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import a from"../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{useRtl as r}from"../../system/esm/RtlProvider/index.js";import{clsx as s}from"../node_modules/clsx/dist/clsx.js";import{PickersDay as o}from"../PickersDay/PickersDay.js";import{useUtils as n,useNow as i,useLocaleText as l}from"../internals/hooks/useUtils.js";import{DAY_SIZE as d,DAY_MARGIN as m}from"../internals/constants/dimensions.js";import{PickersSlideTransition as u}from"./PickersSlideTransition.js";import{useIsDateDisabled as c}from"./useIsDateDisabled.js";import{findClosestEnabledDate as h,getWeekdays as y}from"../internals/utils/date-utils.js";import{getDayCalendarUtilityClass as D}from"./dayCalendarClasses.js";import{jsxs as b,jsx as p}from"react/jsx-runtime";import f from"../../material/styles/styled.js";import g from"../../material/Typography/Typography.js";import k from"../../material/styles/useThemeProps.js";import C from"../../utils/useControlled/useControlled.js";import M from"../../utils/useEventCallback/useEventCallback.js";import w from"../../utils/composeClasses/composeClasses.js";import{useSlotProps as v}from"../../base/utils/useSlotProps.js";const x=["parentProps","day","focusableDay","selectedDays","isDateDisabled","currentMonthNumber","isViewFocused"],N=["ownerState"],j=6*(d+2*m),S=f("div",{name:"MuiDayCalendar",slot:"Root",overridesResolver:(e,a)=>a.root})({}),W=f("div",{name:"MuiDayCalendar",slot:"Header",overridesResolver:(e,a)=>a.header})({display:"flex",justifyContent:"center",alignItems:"center"}),O=f(g,{name:"MuiDayCalendar",slot:"WeekDayLabel",overridesResolver:(e,a)=>a.weekDayLabel})((({theme:e})=>({width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:(e.vars||e).palette.text.secondary}))),P=f(g,{name:"MuiDayCalendar",slot:"WeekNumberLabel",overridesResolver:(e,a)=>a.weekNumberLabel})((({theme:e})=>({width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:e.palette.text.disabled}))),L=f(g,{name:"MuiDayCalendar",slot:"WeekNumber",overridesResolver:(e,a)=>a.weekNumber})((({theme:e})=>a({},e.typography.caption,{width:d,height:d,padding:0,margin:`0 ${m}px`,color:e.palette.text.disabled,fontSize:"0.75rem",alignItems:"center",justifyContent:"center",display:"inline-flex"}))),T=f("div",{name:"MuiDayCalendar",slot:"LoadingContainer",overridesResolver:(e,a)=>a.loadingContainer})({display:"flex",justifyContent:"center",alignItems:"center",minHeight:j}),A=f(u,{name:"MuiDayCalendar",slot:"SlideTransition",overridesResolver:(e,a)=>a.slideTransition})({minHeight:j}),F=f("div",{name:"MuiDayCalendar",slot:"MonthContainer",overridesResolver:(e,a)=>a.monthContainer})({overflow:"hidden"}),R=f("div",{name:"MuiDayCalendar",slot:"WeekContainer",overridesResolver:(e,a)=>a.weekContainer})({margin:`${m}px 0`,display:"flex",justifyContent:"center"});function z(r){let{parentProps:s,day:l,focusableDay:d,selectedDays:m,isDateDisabled:u,currentMonthNumber:c,isViewFocused:h}=r,y=e(r,x);const{disabled:D,disableHighlightToday:b,isMonthSwitchingAnimating:f,showDaysOutsideCurrentMonth:g,slots:k,slotProps:C,timezone:M}=s,w=n(),j=i(M),S=null!==d&&w.isSameDay(l,d),W=m.some((e=>w.isSameDay(e,l))),O=w.isSameDay(l,j),P=k?.day??o,L=v({elementType:P,externalSlotProps:C?.day,additionalProps:a({disableHighlightToday:b,showDaysOutsideCurrentMonth:g,role:"gridcell",isAnimating:f,"data-timestamp":w.toJsDate(l).valueOf()},y),ownerState:a({},s,{day:l,selected:W})}),T=e(L,N),A=t.useMemo((()=>D||u(l)),[D,u,l]),F=t.useMemo((()=>w.getMonth(l)!==c),[w,l,c]),R=t.useMemo((()=>{const e=w.startOfMonth(w.setMonth(l,c));return g?w.isSameDay(l,w.startOfWeek(e)):w.isSameDay(l,e)}),[c,l,g,w]),z=t.useMemo((()=>{const e=w.endOfMonth(w.setMonth(l,c));return g?w.isSameDay(l,w.endOfWeek(e)):w.isSameDay(l,e)}),[c,l,g,w]);return p(P,a({},T,{day:l,disabled:A,autoFocus:h&&S,today:O,outsideCurrentMonth:F,isFirstVisibleCell:R,isLastVisibleCell:z,selected:W,tabIndex:S?0:-1,"aria-selected":W,"aria-current":O?"date":void 0}))}function H(e){const o=k({props:e,name:"MuiDayCalendar"}),d=n(),{onFocusedDayChange:m,className:u,currentMonth:f,selectedDays:g,focusedDay:v,loading:x,onSelectedDaysChange:N,onMonthSwitchingAnimationEnd:j,readOnly:H,reduceAnimations:I,renderLoading:E=(()=>p("span",{children:"..."})),slideDirection:V,TransitionProps:$,disablePast:U,disableFuture:Y,minDate:B,maxDate:K,shouldDisableDate:J,shouldDisableMonth:_,shouldDisableYear:q,dayOfWeekFormatter:G=(e=>d.format(e,"weekdayShort").charAt(0).toUpperCase()),hasFocus:Q,onFocusedViewChange:X,gridLabelId:Z,displayWeekNumber:ee,fixedWeekNumber:ae,autoFocus:te,timezone:re}=o,se=i(re),oe=(e=>{const{classes:a}=e;return w({root:["root"],header:["header"],weekDayLabel:["weekDayLabel"],loadingContainer:["loadingContainer"],slideTransition:["slideTransition"],monthContainer:["monthContainer"],weekContainer:["weekContainer"],weekNumberLabel:["weekNumberLabel"],weekNumber:["weekNumber"]},D,a)})(o),ne=r(),ie=c({shouldDisableDate:J,shouldDisableMonth:_,shouldDisableYear:q,minDate:B,maxDate:K,disablePast:U,disableFuture:Y,timezone:re}),le=l(),[de,me]=C({name:"DayCalendar",state:"hasFocus",controlled:Q,default:te??!1}),[ue,ce]=t.useState((()=>v||se)),he=M((e=>{H||N(e)})),ye=e=>{ie(e)||(m(e),ce(e),X?.(!0),me(!0))},De=M(((e,a)=>{switch(e.key){case"ArrowUp":ye(d.addDays(a,-7)),e.preventDefault();break;case"ArrowDown":ye(d.addDays(a,7)),e.preventDefault();break;case"ArrowLeft":{const t=d.addDays(a,ne?1:-1),r=d.addMonths(a,ne?1:-1),s=h({utils:d,date:t,minDate:ne?t:d.startOfMonth(r),maxDate:ne?d.endOfMonth(r):t,isDateDisabled:ie,timezone:re});ye(s||t),e.preventDefault();break}case"ArrowRight":{const t=d.addDays(a,ne?-1:1),r=d.addMonths(a,ne?-1:1),s=h({utils:d,date:t,minDate:ne?d.startOfMonth(r):t,maxDate:ne?t:d.endOfMonth(r),isDateDisabled:ie,timezone:re});ye(s||t),e.preventDefault();break}case"Home":ye(d.startOfWeek(a)),e.preventDefault();break;case"End":ye(d.endOfWeek(a)),e.preventDefault();break;case"PageUp":ye(d.addMonths(a,1)),e.preventDefault();break;case"PageDown":ye(d.addMonths(a,-1)),e.preventDefault()}})),be=M(((e,a)=>ye(a))),pe=M(((e,a)=>{de&&d.isSameDay(ue,a)&&X?.(!1)})),fe=d.getMonth(f),ge=d.getYear(f),ke=t.useMemo((()=>g.filter((e=>!!e)).map((e=>d.startOfDay(e)))),[d,g]),Ce=`${ge}-${fe}`,Me=t.useMemo((()=>t.createRef()),[Ce]),we=d.startOfWeek(se),ve=t.useMemo((()=>{const e=d.startOfMonth(f),a=d.endOfMonth(f);return ie(ue)||d.isAfterDay(ue,a)||d.isBeforeDay(ue,e)?h({utils:d,date:ue,minDate:e,maxDate:a,disablePast:U,disableFuture:Y,isDateDisabled:ie,timezone:re}):ue}),[f,Y,U,ue,ie,d,re]),xe=t.useMemo((()=>{const e=d.setTimezone(f,re),a=d.getWeekArray(e);let t=d.addMonths(e,1);for(;ae&&a.length<ae;){const e=d.getWeekArray(t),r=d.isSameDay(a[a.length-1][0],e[0][0]);e.slice(r?1:0).forEach((e=>{a.length<ae&&a.push(e)})),t=d.addMonths(t,1)}return a}),[f,ae,d,re]);return b(S,{role:"grid","aria-labelledby":Z,className:oe.root,children:[b(W,{role:"row",className:oe.header,children:[ee&&p(P,{variant:"caption",role:"columnheader","aria-label":le.calendarWeekNumberHeaderLabel,className:oe.weekNumberLabel,children:le.calendarWeekNumberHeaderText}),y(d,se).map(((e,a)=>p(O,{variant:"caption",role:"columnheader","aria-label":d.format(d.addDays(we,a),"weekday"),className:oe.weekDayLabel,children:G(e)},a.toString())))]}),x?p(T,{className:oe.loadingContainer,children:E()}):p(A,a({transKey:Ce,onExited:j,reduceAnimations:I,slideDirection:V,className:s(u,oe.slideTransition)},$,{nodeRef:Me,children:p(F,{ref:Me,role:"rowgroup",className:oe.monthContainer,children:xe.map(((e,a)=>b(R,{role:"row",className:oe.weekContainer,"aria-rowindex":a+1,children:[ee&&p(L,{className:oe.weekNumber,role:"rowheader","aria-label":le.calendarWeekNumberAriaLabelText(d.getWeekNumber(e[0])),children:le.calendarWeekNumberText(d.getWeekNumber(e[0]))}),e.map(((e,a)=>p(z,{parentProps:o,day:e,selectedDays:ke,focusableDay:ve,onKeyDown:De,onFocus:be,onBlur:pe,onDaySelect:he,isDateDisabled:ie,currentMonthNumber:fe,isViewFocused:de,"aria-colindex":a+1},e.toString())))]},`week-${e[0]}`)))})}))]})}export{H as DayCalendar};
