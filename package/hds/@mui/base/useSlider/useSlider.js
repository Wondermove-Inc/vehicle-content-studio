"use client";
import e from"../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import n from"../../utils/useControlled/useControlled.js";import r from"../../utils/clamp/clamp.js";import o from"../../utils/useIsFocusVisible/useIsFocusVisible.js";import u from"../../utils/useForkRef/useForkRef.js";import i from"../../utils/useEnhancedEffect/useEnhancedEffect.js";import s from"../../utils/useEventCallback/useEventCallback.js";import a from"../../utils/ownerDocument/ownerDocument.js";import{areArraysEqual as l}from"../utils/areArraysEqual.js";import{extractEventHandlers as c}from"../utils/extractEventHandlers.js";import d from"../../utils/visuallyHidden/visuallyHidden.js";function f(e,t){return e-t}function v(e,t){var n;const{index:r}=null!=(n=e.reduce(((e,n,r)=>{const o=Math.abs(t-n);return null===e||o<e.distance||o===e.distance?{distance:o,index:r}:e}),null))?n:{};return r}function m(e,t){if(void 0!==t.current&&e.changedTouches){const n=e;for(let e=0;e<n.changedTouches.length;e+=1){const r=n.changedTouches[e];if(r.identifier===t.current)return{x:r.clientX,y:r.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function p(e,t,n){return 100*(e-t)/(n-t)}function h(e,t,n){const r=Math.round((e-n)/t)*t+n;return Number(r.toFixed(function(e){if(Math.abs(e)<1){const t=e.toExponential().split("e-"),n=t[0].split(".")[1];return(n?n.length:0)+parseInt(t[1],10)}const t=e.toString().split(".")[1];return t?t.length:0}(t)))}function g({values:e,newValue:t,index:n}){const r=e.slice();return r[n]=t,r.sort(f)}function b({sliderRef:e,activeIndex:t,setActive:n}){var r,o;const u=a(e.current);var i;null!=(r=e.current)&&r.contains(u.activeElement)&&Number(null==u||null==(o=u.activeElement)?void 0:o.getAttribute("data-index"))===t||(null==(i=e.current)||i.querySelector(`[type="range"][data-index="${t}"]`).focus());n&&n(t)}function x(e,t){return"number"==typeof e&&"number"==typeof t?e===t:"object"==typeof e&&"object"==typeof t&&l(e,t)}const y={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},w=e=>e;let E;function A(){return void 0===E&&(E="undefined"==typeof CSS||"function"!=typeof CSS.supports||CSS.supports("touch-action","none")),E}function R(l){const{"aria-labelledby":E,defaultValue:R,disabled:k=!1,disableSwap:I=!1,isRtl:S=!1,marks:j=!1,max:C=100,min:L=0,name:M,onChange:V,onChangeCommitted:D,orientation:T="horizontal",rootRef:F,scale:O=w,step:P=1,shiftStep:N=10,tabIndex:$,value:z}=l,B=t.useRef(),[H,K]=t.useState(-1),[q,U]=t.useState(-1),[X,Y]=t.useState(!1),G=t.useRef(0),[J,Q]=n({controlled:z,default:null!=R?R:L,name:"Slider"}),W=V&&((e,t,n)=>{const r=e.nativeEvent||e,o=new r.constructor(r.type,r);Object.defineProperty(o,"target",{writable:!0,value:{value:t,name:M}}),V(o,t,n)}),Z=Array.isArray(J);let _=Z?J.slice().sort(f):[J];_=_.map((e=>null==e?L:r(e,L,C)));const ee=!0===j&&null!==P?[...Array(Math.floor((C-L)/P)+1)].map(((e,t)=>({value:L+P*t}))):j||[],te=ee.map((e=>e.value)),{isFocusVisibleRef:ne,onBlur:re,onFocus:oe,ref:ue}=o(),[ie,se]=t.useState(-1),ae=t.useRef(),le=u(ue,ae),ce=u(F,le),de=e=>t=>{var n;const r=Number(t.currentTarget.getAttribute("data-index"));oe(t),!0===ne.current&&se(r),U(r),null==e||null==(n=e.onFocus)||n.call(e,t)},fe=e=>t=>{var n;re(t),!1===ne.current&&se(-1),U(-1),null==e||null==(n=e.onBlur)||n.call(e,t)},ve=(e,t)=>{const n=Number(e.currentTarget.getAttribute("data-index")),o=_[n],u=te.indexOf(o);let i=t;if(ee&&null==P){const e=te[te.length-1];i=i>e?e:i<te[0]?te[0]:i<o?te[u-1]:te[u+1]}if(i=r(i,L,C),Z){I&&(i=r(i,_[n-1]||-1/0,_[n+1]||1/0));const e=i;i=g({values:_,newValue:i,index:n});let t=n;I||(t=i.indexOf(e)),b({sliderRef:ae,activeIndex:t})}Q(i),se(n),W&&!x(i,J)&&W(e,i,n),D&&D(e,i)},me=e=>t=>{var n;if(null!==P){const e=Number(t.currentTarget.getAttribute("data-index")),n=_[e];let r=null;("ArrowLeft"===t.key||"ArrowDown"===t.key)&&t.shiftKey||"PageDown"===t.key?r=Math.max(n-N,L):(("ArrowRight"===t.key||"ArrowUp"===t.key)&&t.shiftKey||"PageUp"===t.key)&&(r=Math.min(n+N,C)),null!==r&&(ve(t,r),t.preventDefault())}null==e||null==(n=e.onKeyDown)||n.call(e,t)};i((()=>{var e;k&&ae.current.contains(document.activeElement)&&(null==(e=document.activeElement)||e.blur())}),[k]),k&&-1!==H&&K(-1),k&&-1!==ie&&se(-1);const pe=t.useRef();let he=T;S&&"horizontal"===T&&(he+="-reverse");const ge=({finger:e,move:t=!1})=>{const{current:n}=ae,{width:o,height:u,bottom:i,left:s}=n.getBoundingClientRect();let a,l;if(a=0===he.indexOf("vertical")?(i-e.y)/u:(e.x-s)/o,-1!==he.indexOf("-reverse")&&(a=1-a),l=function(e,t,n){return(n-t)*e+t}(a,L,C),P)l=h(l,P,L);else{const e=v(te,l);l=te[e]}l=r(l,L,C);let c=0;if(Z){c=t?pe.current:v(_,l),I&&(l=r(l,_[c-1]||-1/0,_[c+1]||1/0));const e=l;l=g({values:_,newValue:l,index:c}),I&&t||(c=l.indexOf(e),pe.current=c)}return{newValue:l,activeIndex:c}},be=s((e=>{const t=m(e,B);if(!t)return;if(G.current+=1,"mousemove"===e.type&&0===e.buttons)return void xe(e);const{newValue:n,activeIndex:r}=ge({finger:t,move:!0});b({sliderRef:ae,activeIndex:r,setActive:K}),Q(n),!X&&G.current>2&&Y(!0),W&&!x(n,J)&&W(e,n,r)})),xe=s((e=>{const t=m(e,B);if(Y(!1),!t)return;const{newValue:n}=ge({finger:t,move:!0});K(-1),"touchend"===e.type&&U(-1),D&&D(e,n),B.current=void 0,we()})),ye=s((e=>{if(k)return;A()||e.preventDefault();const t=e.changedTouches[0];null!=t&&(B.current=t.identifier);const n=m(e,B);if(!1!==n){const{newValue:t,activeIndex:r}=ge({finger:n});b({sliderRef:ae,activeIndex:r,setActive:K}),Q(t),W&&!x(t,J)&&W(e,t,r)}G.current=0;const r=a(ae.current);r.addEventListener("touchmove",be,{passive:!0}),r.addEventListener("touchend",xe,{passive:!0})})),we=t.useCallback((()=>{const e=a(ae.current);e.removeEventListener("mousemove",be),e.removeEventListener("mouseup",xe),e.removeEventListener("touchmove",be),e.removeEventListener("touchend",xe)}),[xe,be]);t.useEffect((()=>{const{current:e}=ae;return e.addEventListener("touchstart",ye,{passive:A()}),()=>{e.removeEventListener("touchstart",ye),we()}}),[we,ye]),t.useEffect((()=>{k&&we()}),[k,we]);const Ee=p(Z?_[0]:L,L,C),Ae=p(_[_.length-1],L,C)-Ee,Re=e=>t=>{var n;null==(n=e.onMouseLeave)||n.call(e,t),U(-1)};return{active:H,axis:he,axisProps:y,dragging:X,focusedThumbIndex:ie,getHiddenInputProps:(t={})=>{var n;const r=c(t),o={onChange:(u=r||{},e=>{var t;null==(t=u.onChange)||t.call(u,e),ve(e,e.target.valueAsNumber)}),onFocus:de(r||{}),onBlur:fe(r||{}),onKeyDown:me(r||{})};var u;const i=e({},r,o);return e({tabIndex:$,"aria-labelledby":E,"aria-orientation":T,"aria-valuemax":O(C),"aria-valuemin":O(L),name:M,type:"range",min:l.min,max:l.max,step:null===l.step&&l.marks?"any":null!=(n=l.step)?n:void 0,disabled:k},t,i,{style:e({},d,{direction:S?"rtl":"ltr",width:"100%",height:"100%"})})},getRootProps:(t={})=>{const n=c(t),r={onMouseDown:(o=n||{},e=>{var t;if(null==(t=o.onMouseDown)||t.call(o,e),k)return;if(e.defaultPrevented)return;if(0!==e.button)return;e.preventDefault();const n=m(e,B);if(!1!==n){const{newValue:t,activeIndex:r}=ge({finger:n});b({sliderRef:ae,activeIndex:r,setActive:K}),Q(t),W&&!x(t,J)&&W(e,t,r)}G.current=0;const r=a(ae.current);r.addEventListener("mousemove",be,{passive:!0}),r.addEventListener("mouseup",xe)})};var o;const u=e({},n,r);return e({},t,{ref:ce},u)},getThumbProps:(t={})=>{const n=c(t),r={onMouseOver:(o=n||{},e=>{var t;null==(t=o.onMouseOver)||t.call(o,e);const n=Number(e.currentTarget.getAttribute("data-index"));U(n)}),onMouseLeave:Re(n||{})};var o;return e({},t,n,r)},marks:ee,open:q,range:Z,rootRef:ce,trackLeap:Ae,trackOffset:Ee,values:_,getThumbStyle:e=>({pointerEvents:-1!==H&&H!==e?"none":void 0})}}export{w as Identity,R as useSlider,p as valueToPercent};
