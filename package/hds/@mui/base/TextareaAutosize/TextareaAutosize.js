"use client";
import e from"../../../@babel/runtime/helpers/esm/extends.js";import t from"../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as r from"react";import o from"../../../prop-types/index.js";import{jsxs as n,jsx as s}from"react/jsx-runtime";import i from"../../utils/useForkRef/useForkRef.js";import a from"../../utils/ownerWindow/ownerWindow.js";import l from"../../utils/useEnhancedEffect/useEnhancedEffect.js";import u from"../../utils/debounce/debounce.js";const c=["onChange","maxRows","minRows","style","value"];function m(e){return parseInt(e,10)||0}const d={visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"};const p=r.forwardRef((function(o,p){const{onChange:f,maxRows:h,minRows:g=1,style:b,value:v}=o,y=t(o,c),{current:w}=r.useRef(null!=v),x=r.useRef(null),R=i(p,x),j=r.useRef(null),E=r.useCallback((()=>{const e=x.current,t=a(e).getComputedStyle(e);if("0px"===t.width)return{outerHeightStyle:0,overflowing:!1};const r=j.current;r.style.width=t.width,r.value=e.value||o.placeholder||"x","\n"===r.value.slice(-1)&&(r.value+=" ");const n=t.boxSizing,s=m(t.paddingBottom)+m(t.paddingTop),i=m(t.borderBottomWidth)+m(t.borderTopWidth),l=r.scrollHeight;r.value="x";const u=r.scrollHeight;let c=l;g&&(c=Math.max(Number(g)*u,c)),h&&(c=Math.min(Number(h)*u,c)),c=Math.max(c,u);return{outerHeightStyle:c+("border-box"===n?s+i:0),overflowing:Math.abs(c-l)<=1}}),[h,g,o.placeholder]),O=r.useCallback((()=>{const e=E();if(null==(t=e)||0===Object.keys(t).length||0===t.outerHeightStyle&&!t.overflowing)return;var t;const r=x.current;r.style.height=`${e.outerHeightStyle}px`,r.style.overflow=e.overflowing?"hidden":""}),[E]);l((()=>{const e=()=>{O()};let t;const r=()=>{cancelAnimationFrame(t),t=requestAnimationFrame((()=>{e()}))},o=u(e),n=x.current,s=a(n);let i;return s.addEventListener("resize",o),"undefined"!=typeof ResizeObserver&&(i=new ResizeObserver("test"===process.env.NODE_ENV?r:e),i.observe(n)),()=>{o.clear(),cancelAnimationFrame(t),s.removeEventListener("resize",o),i&&i.disconnect()}}),[E,O]),l((()=>{O()}));return n(r.Fragment,{children:[s("textarea",e({value:v,onChange:e=>{w||O(),f&&f(e)},ref:R,rows:g,style:b},y)),s("textarea",{"aria-hidden":!0,className:o.className,readOnly:!0,ref:j,tabIndex:-1,style:e({},d,b,{paddingTop:0,paddingBottom:0})})]})}));"production"!==process.env.NODE_ENV&&(p.propTypes={className:o.string,maxRows:o.oneOfType([o.number,o.string]),minRows:o.oneOfType([o.number,o.string]),onChange:o.func,placeholder:o.string,style:o.object,value:o.oneOfType([o.arrayOf(o.string),o.number,o.string])});export{p as TextareaAutosize};
