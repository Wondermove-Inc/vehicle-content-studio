"use client";
import*as e from"react";import t from"../../../prop-types/index.js";import{jsxs as n,jsx as r}from"react/jsx-runtime";import o from"../../utils/useForkRef/useForkRef.js";import u from"../../utils/ownerDocument/ownerDocument.js";import c from"../../utils/elementAcceptingRef/elementAcceptingRef.js";import s from"../../utils/exactProp/exactProp.js";const i=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function a(e){const t=[],n=[];return Array.from(e.querySelectorAll(i)).forEach(((e,r)=>{const o=function(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}(e);-1!==o&&function(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;const t=t=>e.ownerDocument.querySelector(`input[type="radio"]${t}`);let n=t(`[name="${e.name}"]:checked`);return n||(n=t(`[name="${e.name}"]`)),n!==e}(e))}(e)&&(0===o?t.push(e):n.push({documentOrder:r,tabIndex:o,node:e}))})),n.sort(((e,t)=>e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex)).map((e=>e.node)).concat(t)}function l(){return!0}function d(t){const{children:c,disableAutoFocus:s=!1,disableEnforceFocus:i=!1,disableRestoreFocus:d=!1,getTabbable:f=a,isEnabled:m=l,open:b}=t,p=e.useRef(!1),E=e.useRef(null),v=e.useRef(null),h=e.useRef(null),x=e.useRef(null),I=e.useRef(!1),g=e.useRef(null),y=o(c.ref,g),N=e.useRef(null);e.useEffect((()=>{b&&g.current&&(I.current=!s)}),[s,b]),e.useEffect((()=>{if(!b||!g.current)return;const e=u(g.current);return g.current.contains(e.activeElement)||(g.current.hasAttribute("tabIndex")||("production"!==process.env.NODE_ENV&&console.error(["MUI: The modal content node does not accept focus.",'For the benefit of assistive technologies, the tabIndex of the node is being set to "-1".'].join("\n")),g.current.setAttribute("tabIndex","-1")),I.current&&g.current.focus()),()=>{d||(h.current&&h.current.focus&&(p.current=!0,h.current.focus()),h.current=null)}}),[b]),e.useEffect((()=>{if(!b||!g.current)return;const e=u(g.current),t=t=>{N.current=t,!i&&m()&&"Tab"===t.key&&e.activeElement===g.current&&t.shiftKey&&(p.current=!0,v.current&&v.current.focus())},n=()=>{const t=g.current;if(null===t)return;if(!e.hasFocus()||!m()||p.current)return void(p.current=!1);if(t.contains(e.activeElement))return;if(i&&e.activeElement!==E.current&&e.activeElement!==v.current)return;if(e.activeElement!==x.current)x.current=null;else if(null!==x.current)return;if(!I.current)return;let n=[];if(e.activeElement!==E.current&&e.activeElement!==v.current||(n=f(g.current)),n.length>0){var r,o;const e=Boolean((null==(r=N.current)?void 0:r.shiftKey)&&"Tab"===(null==(o=N.current)?void 0:o.key)),t=n[0],u=n[n.length-1];"string"!=typeof t&&"string"!=typeof u&&(e?u.focus():t.focus())}else t.focus()};e.addEventListener("focusin",n),e.addEventListener("keydown",t,!0);const r=setInterval((()=>{e.activeElement&&"BODY"===e.activeElement.tagName&&n()}),50);return()=>{clearInterval(r),e.removeEventListener("focusin",n),e.removeEventListener("keydown",t,!0)}}),[s,i,d,m,b,f]);const F=e=>{null===h.current&&(h.current=e.relatedTarget),I.current=!0};return n(e.Fragment,{children:[r("div",{tabIndex:b?0:-1,onFocus:F,ref:E,"data-testid":"sentinelStart"}),e.cloneElement(c,{ref:y,onFocus:e=>{null===h.current&&(h.current=e.relatedTarget),I.current=!0,x.current=e.target;const t=c.props.onFocus;t&&t(e)}}),r("div",{tabIndex:b?0:-1,onFocus:F,ref:v,"data-testid":"sentinelEnd"})]})}"production"!==process.env.NODE_ENV&&(d.propTypes={children:c,disableAutoFocus:t.bool,disableEnforceFocus:t.bool,disableRestoreFocus:t.bool,getTabbable:t.func,isEnabled:t.func,open:t.bool.isRequired}),"production"!==process.env.NODE_ENV&&(d.propTypes=s(d.propTypes));export{d as FocusTrap};
