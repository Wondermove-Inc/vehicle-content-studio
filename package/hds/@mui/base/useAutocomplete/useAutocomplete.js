"use client";
import e from"../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import n from"../../utils/useId/useId.js";import r from"../../utils/useControlled/useControlled.js";import o from"../../utils/usePreviousProps/usePreviousProps.js";import i from"../../utils/useEventCallback/useEventCallback.js";import l from"../../utils/setRef/setRef.js";function s(e){return void 0!==e.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}function u(e={}){const{ignoreAccents:t=!0,ignoreCase:n=!0,limit:r,matchFrom:o="any",stringify:i,trim:l=!1}=e;return(e,{inputValue:u,getOptionLabel:a})=>{let c=l?u.trim():u;n&&(c=c.toLowerCase()),t&&(c=s(c));const p=c?e.filter((e=>{let r=(i||a)(e);return n&&(r=r.toLowerCase()),t&&(r=s(r)),"start"===o?0===r.indexOf(c):r.indexOf(c)>-1})):e;return"number"==typeof r?p.slice(0,r):p}}function a(e,t){for(let n=0;n<e.length;n+=1)if(t(e[n]))return n;return-1}const c=u(),p=e=>{var t;return null!==e.current&&(null==(t=e.current.parentElement)?void 0:t.contains(document.activeElement))};function d(s){const{unstable_isActiveElementInListbox:u=p,unstable_classNamePrefix:d="Mui",autoComplete:f=!1,autoHighlight:g=!1,autoSelect:h=!1,blurOnSelect:b=!1,clearOnBlur:v=!s.freeSolo,clearOnEscape:m=!1,componentName:x="useAutocomplete",defaultValue:y=(s.multiple?[]:null),disableClearable:O=!1,disableCloseOnSelect:k=!1,disabled:w,disabledItemsFocusable:E=!1,disableListWrap:$=!1,filterOptions:A=c,filterSelectedOptions:D=!1,freeSolo:S=!1,getOptionDisabled:T,getOptionKey:C,getOptionLabel:I=(e=>{var t;return null!=(t=e.label)?t:e}),groupBy:N,handleHomeEndKeys:P=!s.freeSolo,id:L,includeInputInList:M=!1,inputValue:V,isOptionEqualToValue:R=((e,t)=>e===t),multiple:H=!1,onChange:j,onClose:q,onHighlightChange:U,onInputChange:F,onOpen:K,open:_,openOnFocus:B=!1,options:z,readOnly:J=!1,selectOnFocus:Y=!s.freeSolo,value:W}=s,X=n(L);let G=I;G=e=>{const t=I(e);if("string"!=typeof t){if("production"!==process.env.NODE_ENV){const n=void 0===t?"undefined":`${typeof t} (${t})`;console.error(`MUI: The \`getOptionLabel\` method of ${x} returned ${n} instead of a string for ${JSON.stringify(e)}.`)}return String(t)}return t};const Q=t.useRef(!1),Z=t.useRef(!0),ee=t.useRef(null),te=t.useRef(null),[ne,re]=t.useState(null),[oe,ie]=t.useState(-1),le=g?0:-1,se=t.useRef(le),[ue,ae]=r({controlled:W,default:y,name:x}),[ce,pe]=r({controlled:V,default:"",name:x,state:"inputValue"}),[de,fe]=t.useState(!1),ge=t.useCallback(((e,t)=>{if(!(H?ue.length<t.length:null!==t)&&!v)return;let n;if(H)n="";else if(null==t)n="";else{const e=G(t);n="string"==typeof e?e:""}ce!==n&&(pe(n),F&&F(e,n,"reset"))}),[G,ce,H,F,pe,v,ue]),[he,be]=r({controlled:_,default:!1,name:x,state:"open"}),[ve,me]=t.useState(!0),xe=!H&&null!=ue&&ce===G(ue),ye=he&&!J,Oe=ye?A(z.filter((e=>!D||!(H?ue:[ue]).some((t=>null!==t&&R(e,t))))),{inputValue:xe&&ve?"":ce,getOptionLabel:G}):[],ke=o({filteredOptions:Oe,value:ue,inputValue:ce});t.useEffect((()=>{const e=ue!==ke.value;de&&!e||S&&!e||ge(null,ue)}),[ue,ge,de,ke.value,S]);const we=he&&Oe.length>0&&!J;if("production"!==process.env.NODE_ENV&&null!==ue&&!S&&z.length>0){const e=(H?ue:[ue]).filter((e=>!z.some((t=>R(t,e)))));e.length>0&&console.warn([`MUI: The value provided to ${x} is invalid.`,`None of the options match with \`${e.length>1?JSON.stringify(e):JSON.stringify(e[0])}\`.`,"You can use the `isOptionEqualToValue` prop to customize the equality test."].join("\n"))}const Ee=i((e=>{-1===e?ee.current.focus():ne.querySelector(`[data-tag-index="${e}"]`).focus()}));t.useEffect((()=>{H&&oe>ue.length-1&&(ie(-1),Ee(-1))}),[ue,H,oe,Ee]);const $e=i((({event:e,index:t,reason:n="auto"})=>{if(se.current=t,-1===t?ee.current.removeAttribute("aria-activedescendant"):ee.current.setAttribute("aria-activedescendant",`${X}-option-${t}`),U&&U(e,-1===t?null:Oe[t],n),!te.current)return;const r=te.current.querySelector(`[role="option"].${d}-focused`);r&&(r.classList.remove(`${d}-focused`),r.classList.remove(`${d}-focusVisible`));let o=te.current;if("listbox"!==te.current.getAttribute("role")&&(o=te.current.parentElement.querySelector('[role="listbox"]')),!o)return;if(-1===t)return void(o.scrollTop=0);const i=te.current.querySelector(`[data-option-index="${t}"]`);if(i&&(i.classList.add(`${d}-focused`),"keyboard"===n&&i.classList.add(`${d}-focusVisible`),o.scrollHeight>o.clientHeight&&"mouse"!==n&&"touch"!==n)){const e=i,t=o.clientHeight+o.scrollTop,n=e.offsetTop+e.offsetHeight;n>t?o.scrollTop=n-o.clientHeight:e.offsetTop-e.offsetHeight*(N?1.3:0)<o.scrollTop&&(o.scrollTop=e.offsetTop-e.offsetHeight*(N?1.3:0))}})),Ae=i((({event:e,diff:t,direction:n="next",reason:r="auto"})=>{if(!ye)return;const o=function(e,t){if(!te.current||e<0||e>=Oe.length)return-1;let n=e;for(;;){const r=te.current.querySelector(`[data-option-index="${n}"]`),o=!E&&(!r||r.disabled||"true"===r.getAttribute("aria-disabled"));if(r&&r.hasAttribute("tabindex")&&!o)return n;if(n="next"===t?(n+1)%Oe.length:(n-1+Oe.length)%Oe.length,n===e)return-1}}((()=>{const e=Oe.length-1;if("reset"===t)return le;if("start"===t)return 0;if("end"===t)return e;const n=se.current+t;return n<0?-1===n&&M?-1:$&&-1!==se.current||Math.abs(t)>1?0:e:n>e?n===e+1&&M?-1:$||Math.abs(t)>1?e:0:n})(),n);if($e({index:o,reason:r,event:e}),f&&"reset"!==t)if(-1===o)ee.current.value=ce;else{const e=G(Oe[o]);ee.current.value=e;0===e.toLowerCase().indexOf(ce.toLowerCase())&&ce.length>0&&ee.current.setSelectionRange(ce.length,e.length)}})),De=t.useCallback((()=>{if(!ye)return;const e=(()=>{if(-1!==se.current&&ke.filteredOptions&&ke.filteredOptions.length!==Oe.length&&ke.inputValue===ce&&(H?ue.length===ke.value.length&&ke.value.every(((e,t)=>G(ue[t])===G(e))):(e=ke.value,t=ue,(e?G(e):"")===(t?G(t):"")))){const e=ke.filteredOptions[se.current];if(e)return a(Oe,(t=>G(t)===G(e)))}var e,t;return-1})();if(-1!==e)return void(se.current=e);const t=H?ue[0]:ue;if(0!==Oe.length&&null!=t){if(te.current)if(null==t)se.current>=Oe.length-1?$e({index:Oe.length-1}):$e({index:se.current});else{const e=Oe[se.current];if(H&&e&&-1!==a(ue,(t=>R(e,t))))return;const n=a(Oe,(e=>R(e,t)));-1===n?Ae({diff:"reset"}):$e({index:n})}}else Ae({diff:"reset"})}),[Oe.length,!H&&ue,D,Ae,$e,ye,ce,H]),Se=i((e=>{l(te,e),e&&De()}));"production"!==process.env.NODE_ENV&&t.useEffect((()=>{ee.current&&"INPUT"===ee.current.nodeName||(ee.current&&"TEXTAREA"===ee.current.nodeName?console.warn([`A textarea element was provided to ${x} where input was expected.`,"This is not a supported scenario but it may work under certain conditions.","A textarea keyboard navigation may conflict with Autocomplete controls (for example enter and arrow keys).","Make sure to test keyboard navigation and add custom event handlers if necessary."].join("\n")):console.error([`MUI: Unable to find the input element. It was resolved to ${ee.current} while an HTMLInputElement was expected.`,`Instead, ${x} expects an input element.`,"","useAutocomplete"===x?"Make sure you have bound getInputProps correctly and that the normal ref/effect resolutions order is guaranteed.":"Make sure you have customized the input component correctly."].join("\n")))}),[x]),t.useEffect((()=>{De()}),[De]);const Te=e=>{he||(be(!0),me(!0),K&&K(e))},Ce=(e,t)=>{he&&(be(!1),q&&q(e,t))},Ie=(e,t,n,r)=>{if(H){if(ue.length===t.length&&ue.every(((e,n)=>e===t[n])))return}else if(ue===t)return;j&&j(e,t,n,r),ae(t)},Ne=t.useRef(!1),Pe=(e,t,n="selectOption",r="options")=>{let o=n,i=t;if(H){if(i=Array.isArray(ue)?ue.slice():[],"production"!==process.env.NODE_ENV){const e=i.filter((e=>R(t,e)));e.length>1&&console.error([`MUI: The \`isOptionEqualToValue\` method of ${x} does not handle the arguments correctly.`,`The component expects a single value to match a given option but found ${e.length} matches.`].join("\n"))}const e=a(i,(e=>R(t,e)));-1===e?i.push(t):"freeSolo"!==r&&(i.splice(e,1),o="removeOption")}ge(e,i),Ie(e,i,o,{option:t}),k||e&&(e.ctrlKey||e.metaKey)||Ce(e,o),(!0===b||"touch"===b&&Ne.current||"mouse"===b&&!Ne.current)&&ee.current.blur()};const Le=(e,t)=>{if(!H)return;""===ce&&Ce(e,"toggleInput");let n=oe;-1===oe?""===ce&&"previous"===t&&(n=ue.length-1):(n+="next"===t?1:-1,n<0&&(n=0),n===ue.length&&(n=-1)),n=function(e,t){if(-1===e)return-1;let n=e;for(;;){if("next"===t&&n===ue.length||"previous"===t&&-1===n)return-1;const e=ne.querySelector(`[data-tag-index="${n}"]`);if(e&&e.hasAttribute("tabindex")&&!e.disabled&&"true"!==e.getAttribute("aria-disabled"))return n;n+="next"===t?1:-1}}(n,t),ie(n),Ee(n)},Me=e=>{Q.current=!0,pe(""),F&&F(e,"","clear"),Ie(e,H?[]:null,"clear")},Ve=e=>t=>{if(e.onKeyDown&&e.onKeyDown(t),!t.defaultMuiPrevented&&(-1!==oe&&-1===["ArrowLeft","ArrowRight"].indexOf(t.key)&&(ie(-1),Ee(-1)),229!==t.which))switch(t.key){case"Home":ye&&P&&(t.preventDefault(),Ae({diff:"start",direction:"next",reason:"keyboard",event:t}));break;case"End":ye&&P&&(t.preventDefault(),Ae({diff:"end",direction:"previous",reason:"keyboard",event:t}));break;case"PageUp":t.preventDefault(),Ae({diff:-5,direction:"previous",reason:"keyboard",event:t}),Te(t);break;case"PageDown":t.preventDefault(),Ae({diff:5,direction:"next",reason:"keyboard",event:t}),Te(t);break;case"ArrowDown":t.preventDefault(),Ae({diff:1,direction:"next",reason:"keyboard",event:t}),Te(t);break;case"ArrowUp":t.preventDefault(),Ae({diff:-1,direction:"previous",reason:"keyboard",event:t}),Te(t);break;case"ArrowLeft":Le(t,"previous");break;case"ArrowRight":Le(t,"next");break;case"Enter":if(-1!==se.current&&ye){const e=Oe[se.current],n=!!T&&T(e);if(t.preventDefault(),n)return;Pe(t,e,"selectOption"),f&&ee.current.setSelectionRange(ee.current.value.length,ee.current.value.length)}else S&&""!==ce&&!1===xe&&(H&&t.preventDefault(),Pe(t,ce,"createOption","freeSolo"));break;case"Escape":ye?(t.preventDefault(),t.stopPropagation(),Ce(t,"escape")):m&&(""!==ce||H&&ue.length>0)&&(t.preventDefault(),t.stopPropagation(),Me(t));break;case"Backspace":if(H&&!J&&""===ce&&ue.length>0){const e=-1===oe?ue.length-1:oe,n=ue.slice();n.splice(e,1),Ie(t,n,"removeOption",{option:ue[e]})}break;case"Delete":if(H&&!J&&""===ce&&ue.length>0&&-1!==oe){const e=oe,n=ue.slice();n.splice(e,1),Ie(t,n,"removeOption",{option:ue[e]})}}},Re=e=>{fe(!0),B&&!Q.current&&Te(e)},He=e=>{u(te)?ee.current.focus():(fe(!1),Z.current=!0,Q.current=!1,h&&-1!==se.current&&ye?Pe(e,Oe[se.current],"blur"):h&&S&&""!==ce?Pe(e,ce,"blur","freeSolo"):v&&ge(e,ue),Ce(e,"blur"))},je=e=>{const t=e.target.value;ce!==t&&(pe(t),me(!1),F&&F(e,t,"input")),""===t?O||H||Ie(e,null,"clear"):Te(e)},qe=e=>{const t=Number(e.currentTarget.getAttribute("data-option-index"));se.current!==t&&$e({event:e,index:t,reason:"mouse"})},Ue=e=>{$e({event:e,index:Number(e.currentTarget.getAttribute("data-option-index")),reason:"touch"}),Ne.current=!0},Fe=e=>{const t=Number(e.currentTarget.getAttribute("data-option-index"));Pe(e,Oe[t],"selectOption"),Ne.current=!1},Ke=e=>t=>{const n=ue.slice();n.splice(e,1),Ie(t,n,"removeOption",{option:ue[e]})},_e=e=>{he?Ce(e,"toggleInput"):Te(e)},Be=e=>{e.currentTarget.contains(e.target)&&e.target.getAttribute("id")!==X&&e.preventDefault()},ze=e=>{e.currentTarget.contains(e.target)&&(ee.current.focus(),Y&&Z.current&&ee.current.selectionEnd-ee.current.selectionStart==0&&ee.current.select(),Z.current=!1)},Je=e=>{w||""!==ce&&he||_e(e)};let Ye=S&&ce.length>0;Ye=Ye||(H?ue.length>0:null!==ue);let We=Oe;if(N){const e=new Map;let t=!1;We=Oe.reduce(((n,r,o)=>{const i=N(r);return n.length>0&&n[n.length-1].group===i?n[n.length-1].options.push(r):("production"!==process.env.NODE_ENV&&(e.get(i)&&!t&&(console.warn(`MUI: The options provided combined with the \`groupBy\` method of ${x} returns duplicated headers.`,"You can solve the issue by sorting the options with the output of `groupBy`."),t=!0),e.set(i,!0)),n.push({key:o,index:o,group:i,options:[r]})),n}),[])}return w&&de&&He(),{getRootProps:(t={})=>e({"aria-owns":we?`${X}-listbox`:null},t,{onKeyDown:Ve(t),onMouseDown:Be,onClick:ze}),getInputLabelProps:()=>({id:`${X}-label`,htmlFor:X}),getInputProps:()=>({id:X,value:ce,onBlur:He,onFocus:Re,onChange:je,onMouseDown:Je,"aria-activedescendant":ye?"":null,"aria-autocomplete":f?"both":"list","aria-controls":we?`${X}-listbox`:void 0,"aria-expanded":we,autoComplete:"off",ref:ee,autoCapitalize:"none",spellCheck:"false",role:"combobox",disabled:w}),getClearProps:()=>({tabIndex:-1,type:"button",onClick:Me}),getPopupIndicatorProps:()=>({tabIndex:-1,type:"button",onClick:_e}),getTagProps:({index:t})=>e({key:t,"data-tag-index":t,tabIndex:-1},!J&&{onDelete:Ke(t)}),getListboxProps:()=>({role:"listbox",id:`${X}-listbox`,"aria-labelledby":`${X}-label`,ref:Se,onMouseDown:e=>{e.preventDefault()}}),getOptionProps:({index:e,option:t})=>{var n;const r=(H?ue:[ue]).some((e=>null!=e&&R(t,e))),o=!!T&&T(t);return{key:null!=(n=null==C?void 0:C(t))?n:G(t),tabIndex:-1,role:"option",id:`${X}-option-${e}`,onMouseMove:qe,onClick:Fe,onTouchStart:Ue,"data-option-index":e,"aria-disabled":o,"aria-selected":r}},id:X,inputValue:ce,value:ue,dirty:Ye,expanded:ye&&ne,popupOpen:ye,focused:de||-1!==oe,anchorEl:ne,setAnchorEl:re,focusedTag:oe,groupedOptions:We}}export{u as createFilterOptions,d as useAutocomplete};
