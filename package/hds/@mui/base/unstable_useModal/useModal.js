"use client";
import e from"../../../@babel/runtime/helpers/esm/extends.js";import*as n from"react";import{ariaHidden as r,ModalManager as o}from"./ModalManager.js";import t from"../../utils/useForkRef/useForkRef.js";import s from"../../utils/useEventCallback/useEventCallback.js";import i from"../../utils/ownerDocument/ownerDocument.js";import{extractEventHandlers as a}from"../utils/extractEventHandlers.js";import c from"../../utils/createChainedFunction/createChainedFunction.js";const l=new o;function u(o){const{container:u,disableEscapeKeyDown:p=!1,disableScrollLock:d=!1,manager:f=l,closeAfterTransition:m=!1,onTransitionEnter:E,onTransitionExited:k,children:b,onClose:h,open:T,rootRef:C}=o,R=n.useRef({}),w=n.useRef(null),g=n.useRef(null),v=t(g,C),[x,y]=n.useState(!T),j=function(e){return!!e&&e.props.hasOwnProperty("in")}(b);let D=!0;"false"!==o["aria-hidden"]&&!1!==o["aria-hidden"]||(D=!1);const P=()=>(R.current.modalRef=g.current,R.current.mount=w.current,R.current),F=()=>{f.mount(P(),{disableScrollLock:d}),g.current&&(g.current.scrollTop=0)},K=s((()=>{const e=function(e){return"function"==typeof e?e():e}(u)||i(w.current).body;f.add(P(),e),g.current&&F()})),M=n.useCallback((()=>f.isTopModal(P())),[f]),S=s((e=>{w.current=e,e&&(T&&M()?F():g.current&&r(g.current,D))})),L=n.useCallback((()=>{f.remove(P(),D)}),[D,f]);n.useEffect((()=>()=>{L()}),[L]),n.useEffect((()=>{T?K():j&&m||L()}),[T,L,j,m,K]);const A=e=>n=>{var r;null==(r=e.onKeyDown)||r.call(e,n),"Escape"===n.key&&229!==n.which&&M()&&(p||(n.stopPropagation(),h&&h(n,"escapeKeyDown")))},B=e=>n=>{var r;null==(r=e.onClick)||r.call(e,n),n.target===n.currentTarget&&h&&h(n,"backdropClick")};return{getRootProps:(n={})=>{const r=a(o);delete r.onTransitionEnter,delete r.onTransitionExited;const t=e({},r,n);return e({role:"presentation"},t,{onKeyDown:A(t),ref:v})},getBackdropProps:(n={})=>e({"aria-hidden":!0},n,{onClick:B(n),open:T}),getTransitionProps:()=>({onEnter:c((()=>{y(!1),E&&E()}),null==b?void 0:b.props.onEnter),onExited:c((()=>{y(!0),k&&k(),m&&L()}),null==b?void 0:b.props.onExited)}),rootRef:v,portalRef:S,isTopModal:M,exited:x,hasTransition:j}}export{u as useModal};
