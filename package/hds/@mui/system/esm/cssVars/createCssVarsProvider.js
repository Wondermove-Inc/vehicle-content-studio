import e from"../../../../@babel/runtime/helpers/esm/extends.js";import o from"../../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as t from"react";import r from"../../../../prop-types/index.js";import s,{DEFAULT_ATTRIBUTE as n,DEFAULT_MODE_STORAGE_KEY as c,DEFAULT_COLOR_SCHEME_STORAGE_KEY as i}from"./getInitColorSchemeScript.js";import l from"./useCurrentColorScheme.js";import{jsxs as m,jsx as a}from"react/jsx-runtime";import d from"../../../utils/formatMuiErrorMessage/formatMuiErrorMessage.js";import h from"../../../private-theming/useTheme/useTheme.js";import u from"../../../utils/deepmerge/deepmerge.js";import S from"../../../styled-engine/GlobalStyles/GlobalStyles.js";import p from"../ThemeProvider/ThemeProvider.js";const f=["colorSchemes","components","generateCssVars","cssVarPrefix"],g="*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}";function y(y){const{themeId:C,theme:b={},attribute:v=n,modeStorageKey:j=c,colorSchemeStorageKey:x=i,defaultMode:E="light",defaultColorScheme:M,disableTransitionOnChange:N=!1,resolveTheme:k,excludeVariablesFromRoot:T}=y;(!b.colorSchemes||"string"==typeof M&&!b.colorSchemes[M]||"object"==typeof M&&!b.colorSchemes[null==M?void 0:M.light]||"object"==typeof M&&!b.colorSchemes[null==M?void 0:M.dark])&&console.error(`MUI: \`${M}\` does not exist in \`theme.colorSchemes\`.`);const w=t.createContext(void 0);"production"!==process.env.NODE_ENV&&(w.displayName="ColorSchemeContext");function V(r){const{children:s,theme:n=b,modeStorageKey:c=j,colorSchemeStorageKey:i=x,attribute:d=v,defaultMode:y=E,defaultColorScheme:V=M,disableTransitionOnChange:$=N,storageWindow:K=("undefined"==typeof window?void 0:window),documentNode:O=("undefined"==typeof document?void 0:document),colorSchemeNode:P=("undefined"==typeof document?void 0:document.documentElement),colorSchemeSelector:I=":root",disableNestedContext:D=!1,disableStyleSheetGeneration:G=!1}=r,W=t.useRef(!1),F=h(),L=t.useContext(w),_=!!L&&!D,R=n[C],U=R||n,{colorSchemes:z={},components:A={},generateCssVars:q=(()=>({vars:{},css:{}})),cssVarPrefix:B}=U,H=o(U,f),J=Object.keys(z),Q="string"==typeof V?V:V.light,X="string"==typeof V?V:V.dark,{mode:Y,setMode:Z,systemMode:ee,lightColorScheme:oe,darkColorScheme:te,colorScheme:re,setColorScheme:se}=l({supportedColorSchemes:J,defaultLightColorScheme:Q,defaultDarkColorScheme:X,modeStorageKey:c,colorSchemeStorageKey:i,defaultMode:y,storageWindow:K});let ne=Y,ce=re;_&&(ne=L.mode,ce=L.colorScheme);const ie=ce||("dark"===(ne||("system"===y?E:y))?X:Q),{css:le,vars:me}=q(),ae=e({},H,{components:A,colorSchemes:z,cssVarPrefix:B,vars:me,getColorSchemeSelector:e=>`[${d}="${e}"] &`}),de={},he={};Object.entries(z).forEach((([o,t])=>{const{css:r,vars:s}=q(o);ae.vars=u(ae.vars,s),o===ie&&(Object.keys(t).forEach((o=>{t[o]&&"object"==typeof t[o]?ae[o]=e({},ae[o],t[o]):ae[o]=t[o]})),ae.palette&&(ae.palette.colorScheme=o));if(o===("string"==typeof V?V:"dark"===y?V.dark:V.light)){if(T){const e={};T(B).forEach((o=>{e[o]=r[o],delete r[o]})),de[`[${d}="${o}"]`]=e}de[`${I}, [${d}="${o}"]`]=r}else he[`${":root"===I?"":I}[${d}="${o}"]`]=r})),ae.vars=u(ae.vars,me),t.useEffect((()=>{ce&&P&&P.setAttribute(d,ce)}),[ce,d,P]),t.useEffect((()=>{let e;if($&&W.current&&O){const o=O.createElement("style");o.appendChild(O.createTextNode(g)),O.head.appendChild(o),window.getComputedStyle(O.body),e=setTimeout((()=>{O.head.removeChild(o)}),1)}return()=>{clearTimeout(e)}}),[ce,$,O]),t.useEffect((()=>(W.current=!0,()=>{W.current=!1})),[]);const ue=t.useMemo((()=>({allColorSchemes:J,colorScheme:ce,darkColorScheme:te,lightColorScheme:oe,mode:ne,setColorScheme:se,setMode:Z,systemMode:ee})),[J,ce,te,oe,ne,se,Z,ee]);let Se=!0;(G||_&&(null==F?void 0:F.cssVarPrefix)===B)&&(Se=!1);const pe=m(t.Fragment,{children:[Se&&m(t.Fragment,{children:[a(S,{styles:{[I]:le}}),a(S,{styles:de}),a(S,{styles:he})]}),a(p,{themeId:R?C:void 0,theme:k?k(ae):ae,children:s})]});return _?pe:a(w.Provider,{value:ue,children:pe})}"production"!==process.env.NODE_ENV&&(V.propTypes={attribute:r.string,children:r.node,colorSchemeNode:r.any,colorSchemeSelector:r.string,colorSchemeStorageKey:r.string,defaultColorScheme:r.oneOfType([r.string,r.object]),defaultMode:r.string,disableNestedContext:r.bool,disableStyleSheetGeneration:r.bool,disableTransitionOnChange:r.bool,documentNode:r.any,modeStorageKey:r.string,storageWindow:r.any,theme:r.object});const $="string"==typeof M?M:M.light,K="string"==typeof M?M:M.dark;return{CssVarsProvider:V,useColorScheme:()=>{const e=t.useContext(w);if(!e)throw new Error("production"!==process.env.NODE_ENV?"MUI: `useColorScheme` must be called under <CssVarsProvider />":d(19));return e},getInitColorSchemeScript:o=>s(e({attribute:v,colorSchemeStorageKey:x,defaultMode:E,defaultLightColorScheme:$,defaultDarkColorScheme:K,modeStorageKey:j},o))}}export{g as DISABLE_CSS_TRANSITION,y as default};
