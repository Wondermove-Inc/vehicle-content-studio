"use client";
import e from"../../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{DEFAULT_MODE_STORAGE_KEY as o,DEFAULT_COLOR_SCHEME_STORAGE_KEY as r}from"./getInitColorSchemeScript.js";function s(e){if("undefined"!=typeof window&&"system"===e){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}}function l(e,t){return"light"===e.mode||"system"===e.mode&&"light"===e.systemMode?t("light"):"dark"===e.mode||"system"===e.mode&&"dark"===e.systemMode?t("dark"):void 0}function c(e){return l(e,(t=>"light"===t?e.lightColorScheme:"dark"===t?e.darkColorScheme:void 0))}function n(e,t){if("undefined"==typeof window)return;let o;try{o=localStorage.getItem(e)||void 0,o||localStorage.setItem(e,t)}catch(e){}return o||t}function d(d){const{defaultMode:i="light",defaultLightColorScheme:a,defaultDarkColorScheme:m,supportedColorSchemes:h=[],modeStorageKey:u=o,colorSchemeStorageKey:g=r,storageWindow:f=("undefined"==typeof window?void 0:window)}=d,S=h.join(","),[k,y]=t.useState((()=>{const e=n(u,i),t=n(`${g}-light`,a),o=n(`${g}-dark`,m);return{mode:e,systemMode:s(e),lightColorScheme:t,darkColorScheme:o}})),C=c(k),p=t.useCallback((t=>{y((o=>{if(t===o.mode)return o;const r=null!=t?t:i;try{localStorage.setItem(u,r)}catch(e){}return e({},o,{mode:r,systemMode:s(r)})}))}),[u,i]),w=t.useCallback((t=>{t?"string"==typeof t?t&&!S.includes(t)?console.error(`\`${t}\` does not exist in \`theme.colorSchemes\`.`):y((o=>{const r=e({},o);return l(o,(e=>{try{localStorage.setItem(`${g}-${e}`,t)}catch(e){}"light"===e&&(r.lightColorScheme=t),"dark"===e&&(r.darkColorScheme=t)})),r})):y((o=>{const r=e({},o),s=null===t.light?a:t.light,l=null===t.dark?m:t.dark;if(s)if(S.includes(s)){r.lightColorScheme=s;try{localStorage.setItem(`${g}-light`,s)}catch(e){}}else console.error(`\`${s}\` does not exist in \`theme.colorSchemes\`.`);if(l)if(S.includes(l)){r.darkColorScheme=l;try{localStorage.setItem(`${g}-dark`,l)}catch(e){}}else console.error(`\`${l}\` does not exist in \`theme.colorSchemes\`.`);return r})):y((t=>{try{localStorage.setItem(`${g}-light`,a),localStorage.setItem(`${g}-dark`,m)}catch(e){}return e({},t,{lightColorScheme:a,darkColorScheme:m})}))}),[S,g,a,m]),$=t.useCallback((t=>{"system"===k.mode&&y((o=>{const r=null!=t&&t.matches?"dark":"light";return o.systemMode===r?o:e({},o,{systemMode:r})}))}),[k.mode]),M=t.useRef($);return M.current=$,t.useEffect((()=>{const e=(...e)=>M.current(...e),t=window.matchMedia("(prefers-color-scheme: dark)");return t.addListener(e),e(t),()=>{t.removeListener(e)}}),[]),t.useEffect((()=>{if(f){const e=e=>{const t=e.newValue;"string"!=typeof e.key||!e.key.startsWith(g)||t&&!S.match(t)||(e.key.endsWith("light")&&w({light:t}),e.key.endsWith("dark")&&w({dark:t})),e.key!==u||t&&!["light","dark","system"].includes(t)||p(t||i)};return f.addEventListener("storage",e),()=>{f.removeEventListener("storage",e)}}}),[w,p,u,g,S,i,f]),e({},k,{colorScheme:C,setMode:p,setColorScheme:w})}export{d as default,c as getColorScheme,s as getSystemMode};
