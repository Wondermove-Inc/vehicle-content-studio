import*as r from"react";import{TimerBasedCleanupTracking as e}from"../utils/cleanupTracking/TimerBasedCleanupTracking.js";import{FinalizationRegistryBasedCleanupTracking as n}from"../utils/cleanupTracking/FinalizationRegistryBasedCleanupTracking.js";class t{}function u(u){let c=0;return function(i,s,l){null===u.registry&&(u.registry="undefined"!=typeof FinalizationRegistry?new n:new e);const[a]=r.useState(new t),o=r.useRef(null),f=r.useRef();f.current=l;const g=r.useRef(null);if(!o.current&&f.current){const r=(r,e)=>{e.defaultMuiPrevented||f.current?.(r,e)};o.current=i.$$subscribeEvent(s,r),c+=1,g.current={cleanupToken:c},u.registry.register(a,(()=>{o.current?.(),o.current=null,g.current=null}),g.current)}else!f.current&&o.current&&(o.current(),o.current=null,g.current&&(u.registry.unregister(g.current),g.current=null));r.useEffect((()=>{if(!o.current&&f.current){const r=(r,e)=>{e.defaultMuiPrevented||f.current?.(r,e)};o.current=i.$$subscribeEvent(s,r)}return g.current&&u.registry&&(u.registry.unregister(g.current),g.current=null),()=>{o.current?.(),o.current=null}}),[i,s])}}const c=u({registry:null});export{u as createUseInstanceEventHandler,c as useInstanceEventHandler};
