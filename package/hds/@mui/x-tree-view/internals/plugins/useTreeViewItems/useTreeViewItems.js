import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{publishTreeViewEvent as i}from"../../utils/publishTreeViewEvent.js";import{TREE_VIEW_ROOT_PARENT_ID as r,buildSiblingIndexes as a}from"./useTreeViewItems.utils.js";import{jsx as s}from"react/jsx-runtime";import{TreeViewItemDepthContext as m}from"../../TreeViewItemDepthContext/TreeViewItemDepthContext.js";const n=({items:e,isItemDisabled:t,getItemLabel:i,getItemId:s})=>{const m={},n={},d={[r]:[]},l=(e,a,o)=>{const I=s?s(e):e.id;if(null==I)throw new Error(["MUI X: The Tree View component requires all items to have a unique `id` property.","Alternatively, you can use the `getItemId` prop to specify a custom id for each item.","An item was provided without id in the `items` prop:",JSON.stringify(e)].join("\n"));if(null!=m[I])throw new Error(["MUI X: The Tree View component requires all items to have a unique `id` property.","Alternatively, you can use the `getItemId` prop to specify a custom id for each item.",`Two items were provided with the same id in the \`items\` prop: "${I}"`].join("\n"));const p=i?i(e):e.label;if(null==p)throw new Error(["MUI X: The Tree View component requires all items to have a `label` property.","Alternatively, you can use the `getItemLabel` prop to specify a custom label for each item.","An item was provided without label in the `items` prop:",JSON.stringify(e)].join("\n"));m[I]={id:I,label:p,parentId:o,idAttribute:void 0,expandable:!!e.children?.length,disabled:!!t&&t(e),depth:a},n[I]=e,d[I]=[];const u=o??r;d[u]||(d[u]=[]),d[u].push(I),e.children?.forEach((e=>l(e,a+1,I)))};e.forEach((e=>l(e,0,null)));const o={};return Object.keys(d).forEach((e=>{o[e]=a(d[e])})),{itemMetaMap:m,itemMap:n,itemOrderedChildrenIds:d,itemChildrenIndexes:o}},d=({instance:a,params:s,state:m,setState:d,experimentalFeatures:l})=>{const o=t.useCallback((e=>m.items.itemMetaMap[e]),[m.items.itemMetaMap]),I=t.useCallback((e=>m.items.itemMap[e]),[m.items.itemMap]),p=t.useCallback((e=>{if(null==e)return!1;let t=a.getItemMeta(e);if(!t)return!1;if(t.disabled)return!0;for(;null!=t.parentId;)if(t=a.getItemMeta(t.parentId),t.disabled)return!0;return!1}),[a]),u=t.useCallback((e=>{const t=a.getItemMeta(e).parentId??r;return m.items.itemChildrenIndexes[t][e]}),[a,m.items.itemChildrenIndexes]),c=t.useCallback((e=>m.items.itemOrderedChildrenIds[e??r]??[]),[m.items.itemOrderedChildrenIds]),b=t.useRef(!1),h=t.useCallback((()=>{b.current=!0}),[]),g=t.useCallback((()=>b.current),[]);t.useEffect((()=>{a.areItemUpdatesPrevented()||d((t=>{const r=n({items:s.items,isItemDisabled:s.isItemDisabled,getItemId:s.getItemId,getItemLabel:s.getItemLabel});return Object.values(t.items.itemMetaMap).forEach((e=>{r.itemMetaMap[e.id]||i(a,"removeItem",{id:e.id})})),e({},t,{items:r})}))}),[a,d,s.items,s.isItemDisabled,s.getItemId,s.getItemLabel]);return{getRootProps:()=>({style:{"--TreeView-itemChildrenIndentation":"number"==typeof s.itemChildrenIndentation?`${s.itemChildrenIndentation}px`:s.itemChildrenIndentation}}),publicAPI:{getItem:I},instance:{getItemMeta:o,getItem:I,getItemsToRender:()=>{const e=t=>{const i=m.items.itemMetaMap[t];return{label:i.label,itemId:i.id,id:i.idAttribute,children:m.items.itemOrderedChildrenIds[t].map(e)}};return m.items.itemOrderedChildrenIds[r].map(e)},getItemIndex:u,getItemOrderedChildrenIds:c,isItemDisabled:p,isItemNavigable:e=>!!s.disabledItemsFocusable||!a.isItemDisabled(e),preventItemUpdates:h,areItemUpdatesPrevented:g},contextValue:{disabledItemsFocusable:s.disabledItemsFocusable,indentationAtItemLevel:l.indentationAtItemLevel??!1}}};d.getInitialState=e=>({items:n({items:e.items,isItemDisabled:e.isItemDisabled,getItemId:e.getItemId,getItemLabel:e.getItemLabel})}),d.getDefaultizedParams=t=>e({},t,{disabledItemsFocusable:t.disabledItemsFocusable??!1,itemChildrenIndentation:t.itemChildrenIndentation??"12px"}),d.wrapRoot=({children:e,instance:t})=>s(m.Provider,{value:e=>t.getItemMeta(e)?.depth??0,children:e}),d.params={disabledItemsFocusable:!0,items:!0,isItemDisabled:!0,getItemLabel:!0,getItemId:!0,itemChildrenIndentation:!0};export{d as useTreeViewItems};
