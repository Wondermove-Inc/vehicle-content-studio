import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{useInstanceEventHandler as o}from"../../hooks/useInstanceEventHandler.js";import{getActiveElement as s}from"../../utils/utils.js";import{getFirstNavigableItem as n}from"../../utils/tree.js";import{convertSelectedItemsToArray as r}from"../useTreeViewSelection/useTreeViewSelection.utils.js";import u from"../../../../utils/useEventCallback/useEventCallback.js";import m from"../../../../utils/ownerDocument/ownerDocument.js";const c=({instance:c,params:I,state:d,setState:l,models:i,rootRef:a})=>{const f=((e,t)=>{let o=r(t).find((t=>{if(!e.isItemNavigable(t))return!1;const o=e.getItemMeta(t);return o&&(null==o.parentId||e.isItemExpanded(o.parentId))}));return null==o&&(o=n(e)),o})(c,i.selectedItems.value),p=u((t=>{const o="function"==typeof t?t(d.focusedItemId):t;d.focusedItemId!==o&&l((t=>e({},t,{focusedItemId:o})))})),b=t.useCallback((()=>!!a.current&&a.current.contains(s(m(a.current)))),[a]),g=t.useCallback((e=>d.focusedItemId===e&&b()),[d.focusedItemId,b]),v=(e,t)=>{const o=c.getItemMeta(t),s=document.getElementById(c.getTreeItemIdAttribute(t,o.idAttribute));s&&s.focus(),p(t),I.onItemFocus&&I.onItemFocus(e,t)},j=u(((e,t)=>{(e=>{const t=c.getItemMeta(e);return t&&(null==t.parentId||c.isItemExpanded(t.parentId))})(t)&&v(e,t)})),E=u((()=>{if(null==d.focusedItemId)return;const e=c.getItemMeta(d.focusedItemId);if(e){const t=document.getElementById(c.getTreeItemIdAttribute(d.focusedItemId,e.idAttribute));t&&t.blur()}p(null)}));o(c,"removeItem",(({id:e})=>{d.focusedItemId===e&&v(null,f)}));const F=e=>t=>{e.onFocus?.(t),t.defaultMuiPrevented||t.target===t.currentTarget&&v(t,f)};return{getRootProps:e=>({onFocus:F(e)}),publicAPI:{focusItem:j},instance:{isItemFocused:g,canItemBeTabbed:e=>e===f,focusItem:j,removeFocusedItem:E}}};c.getInitialState=()=>({focusedItemId:null}),c.params={onItemFocus:!0};export{c as useTreeViewFocus};
