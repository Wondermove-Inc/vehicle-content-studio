import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{findOrderInTremauxTree as l,getFirstNavigableItem as c,getLastNavigableItem as s,getAllNavigableItems as n,getNonDisabledItemsInRange as i}from"../../utils/tree.js";import{convertSelectedItemsToArray as o,getLookupFromArray as r}from"./useTreeViewSelection.utils.js";const u=({instance:e,params:u,models:m})=>{const a=t.useRef(null),d=t.useRef({}),S=t.useMemo((()=>{const e=new Map;return Array.isArray(m.selectedItems.value)?m.selectedItems.value.forEach((t=>{e.set(t,!0)})):null!=m.selectedItems.value&&e.set(m.selectedItems.value,!0),e}),[m.selectedItems.value]),I=(t,l)=>{if(u.onItemSelectionToggle)if(u.multiSelect){const c=l.filter((t=>!e.isItemSelected(t))),s=m.selectedItems.value.filter((e=>!l.includes(e)));c.forEach((e=>{u.onItemSelectionToggle(t,e,!0)})),s.forEach((e=>{u.onItemSelectionToggle(t,e,!1)}))}else l!==m.selectedItems.value&&(null!=m.selectedItems.value&&u.onItemSelectionToggle(t,m.selectedItems.value,!1),null!=l&&u.onItemSelectionToggle(t,l,!0));u.onSelectedItemsChange&&u.onSelectedItemsChange(t,l),m.selectedItems.setControlledValue(l)},f=(t,[l,c])=>{if(u.disableSelection||!u.multiSelect)return;let s=o(m.selectedItems.value).slice();Object.keys(d.current).length>0&&(s=s.filter((e=>!d.current[e])));const n=r(s),a=i(e,l,c),S=a.filter((e=>!n[e]));s=s.concat(S),I(t,s),d.current=r(a)};return{getRootProps:()=>({"aria-multiselectable":u.multiSelect}),instance:{isItemSelected:e=>S.has(e),selectItem:(t,l,c,s)=>{if(u.disableSelection)return;let n;if(c){const t=o(m.selectedItems.value),c=e.isItemSelected(l);n=!c||!1!==s&&null!=s?c||!0!==s&&null!=s?t:[l].concat(t):t.filter((e=>e!==l))}else n=!1===s?u.multiSelect?[]:null:u.multiSelect?[l]:l;I(t,n),a.current=l,d.current={}},selectAllNavigableItems:t=>{if(u.disableSelection||!u.multiSelect)return;const l=n(e);I(t,l),d.current=r(l)},expandSelectionRange:(t,c)=>{if(null!=a.current){const[s,n]=l(e,c,a.current);f(t,[s,n])}},selectRangeFromStartToItem:(t,l)=>{f(t,[c(e),l])},selectRangeFromItemToEnd:(t,l)=>{f(t,[l,s(e)])},selectItemFromArrowNavigation:(e,t,l)=>{if(u.disableSelection||!u.multiSelect)return;let c=o(m.selectedItems.value).slice();0===Object.keys(d.current).length?(c.push(l),d.current={[t]:!0,[l]:!0}):(d.current[t]||(d.current={}),d.current[l]?(c=c.filter((e=>e!==t)),delete d.current[t]):(c.push(l),d.current[l]=!0)),I(e,c)}},contextValue:{selection:{multiSelect:u.multiSelect,checkboxSelection:u.checkboxSelection,disableSelection:u.disableSelection}}}};u.models={selectedItems:{getDefaultValue:e=>e.defaultSelectedItems}};const m=[];u.getDefaultizedParams=t=>e({},t,{disableSelection:t.disableSelection??!1,multiSelect:t.multiSelect??!1,checkboxSelection:t.checkboxSelection??!1,defaultSelectedItems:t.defaultSelectedItems??(t.multiSelect?m:null)}),u.params={disableSelection:!0,multiSelect:!0,checkboxSelection:!0,defaultSelectedItems:!0,selectedItems:!0,onSelectedItemsChange:!0,onItemSelectionToggle:!0};export{u as useTreeViewSelection};
