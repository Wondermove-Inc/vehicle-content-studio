import*as e from"react";import{useRtl as t}from"../../../../system/esm/RtlProvider/index.js";import{getLastNavigableItem as r,getFirstNavigableItem as a,getNextNavigableItem as s,getPreviousNavigableItem as l}from"../../utils/tree.js";import n from"../../../../utils/useEventCallback/useEventCallback.js";const c=({instance:c,params:o,state:i})=>{const m=t(),u=e.useRef({}),f=n((e=>{u.current=e(u.current)}));e.useEffect((()=>{if(c.areItemUpdatesPrevented())return;const e={};Object.values(i.items.itemMetaMap).forEach((t=>{e[t.id]=t.label.substring(0,1).toLowerCase()})),u.current=e}),[i.items.itemMetaMap,o.getItemId,c]);const p=e=>!o.disableSelection&&!c.isItemDisabled(e),I=e=>!c.isItemDisabled(e)&&c.isItemExpandable(e);return{instance:{updateFirstCharMap:f,handleItemKeyDown:(e,t)=>{if(e.defaultMuiPrevented)return;if(e.altKey||e.currentTarget!==e.target.closest('*[role="treeitem"]'))return;const n=e.ctrlKey||e.metaKey,i=e.key;switch(!0){case" "===i&&p(t):e.preventDefault(),o.multiSelect&&e.shiftKey?c.expandSelectionRange(e,t):o.multiSelect?c.selectItem(e,t,!0):c.selectItem(e,t,!1);break;case"Enter"===i:I(t)?(c.toggleItemExpansion(e,t),e.preventDefault()):p(t)&&(o.multiSelect?(e.preventDefault(),c.selectItem(e,t,!0)):c.isItemSelected(t)||(c.selectItem(e,t,!1),e.preventDefault()));break;case"ArrowDown"===i:{const r=s(c,t);r&&(e.preventDefault(),c.focusItem(e,r),o.multiSelect&&e.shiftKey&&p(r)&&c.selectItemFromArrowNavigation(e,t,r));break}case"ArrowUp"===i:{const r=l(c,t);r&&(e.preventDefault(),c.focusItem(e,r),o.multiSelect&&e.shiftKey&&p(r)&&c.selectItemFromArrowNavigation(e,t,r));break}case"ArrowRight"===i&&!m||"ArrowLeft"===i&&m:if(c.isItemExpanded(t)){const r=s(c,t);r&&(c.focusItem(e,r),e.preventDefault())}else I(t)&&(c.toggleItemExpansion(e,t),e.preventDefault());break;case"ArrowLeft"===i&&!m||"ArrowRight"===i&&m:if(I(t)&&c.isItemExpanded(t))c.toggleItemExpansion(e,t),e.preventDefault();else{const r=c.getItemMeta(t).parentId;r&&(c.focusItem(e,r),e.preventDefault())}break;case"Home"===i:p(t)&&o.multiSelect&&n&&e.shiftKey?c.selectRangeFromStartToItem(e,t):c.focusItem(e,a(c)),e.preventDefault();break;case"End"===i:p(t)&&o.multiSelect&&n&&e.shiftKey?c.selectRangeFromItemToEnd(e,t):c.focusItem(e,r(c)),e.preventDefault();break;case"*"===i:c.expandAllSiblings(e,t),e.preventDefault();break;case"a"===i&&n&&o.multiSelect&&!o.disableSelection:c.selectAllNavigableItems(e),e.preventDefault();break;case!(n||e.shiftKey||(f=i,!f||1!==f.length||!f.match(/\S/))):{const r=((e,t)=>{const r=t.toLowerCase(),l=e=>{const t=s(c,e);return null===t?a(c):t};let n=null,o=l(e);const i={};for(;null==n&&!i[o];)u.current[o]===r?n=o:(i[o]=!0,o=l(o));return n})(t,i);null!=r&&(c.focusItem(e,r),e.preventDefault());break}}var f}}}};c.params={};export{c as useTreeViewKeyboardNavigation};
