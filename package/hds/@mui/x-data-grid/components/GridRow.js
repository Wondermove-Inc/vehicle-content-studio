import e from"../../../@babel/runtime/helpers/esm/extends.js";import i from"../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as o from"react";import r from"../../../prop-types/index.js";import{clsx as t}from"../node_modules/clsx/dist/clsx.js";import{fastMemo as s}from"../utils/fastMemo.js";import{GridRowModes as n,GridEditModes as l,GridCellModes as u}from"../models/gridEditRowModel.js";import{useGridApiContext as d}from"../hooks/utils/useGridApiContext.js";import{gridClasses as a,getDataGridUtilityClass as m}from"../constants/gridClasses.js";import{useGridRootProps as c}from"../hooks/utils/useGridRootProps.js";import{gridColumnPositionsSelector as f}from"../hooks/features/columns/gridColumnsSelector.js";import{useGridSelector as h,objectShallowCompare as b}from"../hooks/utils/useGridSelector.js";import{useGridVisibleRows as p}from"../hooks/utils/useGridVisibleRows.js";import{isEventTargetInPortal as g,findParentElementFromClassName as R}from"../utils/domUtils.js";import{GRID_CHECKBOX_SELECTION_COL_DEF as w}from"../colDef/gridCheckboxSelectionColDef.js";import{GRID_ACTIONS_COLUMN_TYPE as C}from"../colDef/gridActionsColDef.js";import{GRID_DETAIL_PANEL_TOGGLE_FIELD as q}from"../constants/gridDetailPanelToggleField.js";import{gridSortModelSelector as x}from"../hooks/features/sorting/gridSortingSelector.js";import{gridRowMaximumTreeDepthSelector as S}from"../hooks/features/rows/gridRowsSelector.js";import{gridColumnGroupsHeaderMaxDepthSelector as j}from"../hooks/features/columnGrouping/gridColumnGroupsSelector.js";import{gridEditRowsStateSelector as v}from"../hooks/features/editing/gridEditingSelectors.js";import{PinnedPosition as k,gridPinnedColumnPositionLookup as I}from"./cell/GridCell.js";import{GridScrollbarFillerCell as y}from"./GridScrollbarFillerCell.js";import{getPinnedCellOffset as M}from"../internals/utils/getPinnedCellOffset.js";import{jsxs as T,jsx as V}from"react/jsx-runtime";import L from"../../utils/useForkRef/useForkRef.js";import O from"../../utils/composeClasses/composeClasses.js";const N=["selected","rowId","row","index","style","rowHeight","className","visibleColumns","pinnedColumns","offsetTop","offsetLeft","dimensions","renderContext","focusedColumnIndex","isFirstVisible","isLastVisible","isNotVisible","focusedCell","tabbableCell","onClick","onDoubleClick","onMouseEnter","onMouseLeave","onMouseOut","onMouseOver"];function E({width:e}){return e?V("div",{role:"presentation",className:t(a.cell,a.cellEmpty),style:{"--width":`${e}px`}}):null}const H=o.forwardRef((function(r,s){const{selected:H,rowId:z,row:P,index:_,style:F,rowHeight:D,className:W,visibleColumns:G,pinnedColumns:B,offsetLeft:A,dimensions:U,renderContext:Y,focusedColumnIndex:$,isFirstVisible:X,isLastVisible:J,isNotVisible:K,onClick:Q,onDoubleClick:Z,onMouseEnter:ee,onMouseLeave:ie,onMouseOut:oe,onMouseOver:re}=r,te=i(r,N),se=d(),ne=o.useRef(null),le=c(),ue=p(se,le),de=h(se,x),ae=h(se,S),me=h(se,j),ce=h(se,f),fe=h(se,v),he=L(ne,s),be=se.current.getRowNode(z),pe=U.hasScrollY?U.scrollbarSize:0,ge=U.columnsTotalWidth<U.viewportOuterSize.width,Re=void 0!==$,we=Re&&$>=B.left.length&&$<Y.firstColumnIndex,Ce=Re&&$<G.length-B.right.length&&$>=Y.lastColumnIndex,qe=_+me+2,xe=(e=>{const{editable:i,editing:o,selected:r,isFirstVisible:t,isLastVisible:s,rowHeight:n,classes:l}=e;return O({root:["row",r&&"selected",i&&"row--editable",o&&"row--editing",t&&"row--firstVisible",s&&"row--lastVisible","auto"===n&&"row--dynamicHeight"]},m,l)})({selected:H,isFirstVisible:X,isLastVisible:J,classes:le.classes,editing:se.current.getRowMode(z)===n.Edit,editable:le.editMode===l.Row,rowHeight:D});o.useLayoutEffect((()=>{if(ue.range){const e=se.current.getRowIndexRelativeToVisibleRows(z);null!=e&&se.current.unstable_setLastMeasuredRowIndex(e)}const e=ne.current;if(!e||"auto"!==D||"undefined"==typeof ResizeObserver)return;const i=new ResizeObserver((e=>{const[i]=e,o=i.borderBoxSize&&i.borderBoxSize.length>0?i.borderBoxSize[0].blockSize:i.contentRect.height;se.current.unstable_storeRowHeightMeasurement(z,o)}));return i.observe(e),()=>i.disconnect()}),[se,ue.range,_,D,z]);const Se=o.useCallback(((e,i)=>o=>{g(o)||se.current.getRow(z)&&(se.current.publishEvent(e,se.current.getRowParams(z),o),i&&i(o))}),[se,z]),je=o.useCallback((e=>{const i=R(e.target,a.cell),o=i?.getAttribute("data-field");if(o){if(o===w.field)return;if(o===q)return;if("__reorder__"===o)return;if(se.current.getCellMode(z,o)===u.Edit)return;const e=se.current.getColumn(o);if(e?.type===C)return}Se("rowClick",Q)(e)}),[se,Q,Se,z]),{slots:ve,slotProps:ke,disableColumnReorder:Ie}=le,ye=le.rowReordering,Me=h(se,(()=>e({},se.current.unstable_getRowInternalSizes(z))),b);let Te=D;if("auto"===Te&&Me){const e=1,i=Me.baseCenter??0;i>0&&e>1&&(Te=i)}const Ve=o.useMemo((()=>{if(K)return{opacity:0,width:0,height:0};const i=e({},F,{maxHeight:"auto"===D?"none":D,minHeight:Te,"--height":"number"==typeof D?`${D}px`:D});if(Me?.spacingTop){i["border"===le.rowSpacingType?"borderTopWidth":"marginTop"]=Me.spacingTop}if(Me?.spacingBottom){const e="border"===le.rowSpacingType?"borderBottomWidth":"marginBottom";let o=i[e];"number"!=typeof o&&(o=parseInt(o||"0",10)),o+=Me.spacingBottom,i[e]=o}return i}),[K,D,F,Te,Me,le.rowSpacingType]),Le=se.current.unstable_applyPipeProcessors("rowClassName",[],z);if("function"==typeof le.getRowClassName){const i=_-(ue.range?.firstRowIndex||0),o=e({},se.current.getRowParams(z),{isFirstVisible:0===i,isLastVisible:i===ue.rows.length-1,indexRelativeToCurrentPage:i});Le.push(le.getRowClassName(o))}const Oe=(i,o,r,t,s=k.NONE)=>{const n=se.current.unstable_getCellColSpanInfo(z,r);if(n?.spannedByColSpan)return null;const l=n?.cellProps.width??i.computedWidth,u=n?.cellProps.colSpan??1,d=M(I[s],i.computedWidth,r,ce,U);if("skeletonRow"===be?.type)return V(ve.skeletonCell,{width:l,height:D,field:i.field,align:i.align??"left"},i.field);const a=fe[z]?.[i.field]??null,m="__reorder__"===i.field,c=Object.keys(fe).length>0,f=!(Ie||i.disableReorder),h=ye&&!de.length&&ae<=1&&!c,b=!(f||m&&h),p=s===k.VIRTUAL;return V(ve.cell,e({column:i,width:l,rowId:z,align:i.align||"left",colIndex:r,colSpan:u,disableDragEvents:b,editCellState:a,isNotVisible:p,pinnedOffset:d,pinnedPosition:s,sectionIndex:o,sectionLength:t,gridHasFiller:ge},ke?.cell),i.field)};if(!be)return null;const Ne=B.left.map(((e,i)=>Oe(e,i,i,B.left.length,k.LEFT))),Ee=B.right.map(((e,i)=>{const o=G.length-B.right.length+i;return Oe(e,i,o,B.right.length,k.RIGHT)})),He=G.length-B.left.length-B.right.length,ze=[];we&&ze.push(Oe(G[$],$-B.left.length,$,He,k.VIRTUAL));for(let e=Y.firstColumnIndex;e<Y.lastColumnIndex;e+=1){const i=G[e],o=e-B.left.length;ze.push(Oe(i,o,e,He))}Ce&&ze.push(Oe(G[$],$-B.left.length,$,He,k.VIRTUAL));const Pe=P?{onClick:je,onDoubleClick:Se("rowDoubleClick",Z),onMouseEnter:Se("rowMouseEnter",ee),onMouseLeave:Se("rowMouseLeave",ie),onMouseOut:Se("rowMouseOut",oe),onMouseOver:Se("rowMouseOver",re)}:null,_e=U.viewportOuterSize.width-U.columnsTotalWidth-pe,Fe=Math.max(0,_e);return T("div",e({ref:he,"data-id":z,"data-rowindex":_,role:"row",className:t(...Le,xe.root,W),"aria-rowindex":qe,"aria-selected":H,style:Ve},Pe,te,{children:[Ne,V("div",{role:"presentation",className:a.cellOffsetLeft,style:{width:A}}),ze,Fe>0&&V(E,{width:Fe}),Ee.length>0&&V("div",{role:"presentation",className:a.filler}),Ee,0!==pe&&V(y,{pinnedRight:B.right.length>0})]}))}));"production"!==process.env.NODE_ENV&&(H.propTypes={dimensions:r.shape({bottomContainerHeight:r.number.isRequired,columnsTotalWidth:r.number.isRequired,contentSize:r.shape({height:r.number.isRequired,width:r.number.isRequired}).isRequired,hasScrollX:r.bool.isRequired,hasScrollY:r.bool.isRequired,headerFilterHeight:r.number.isRequired,headerHeight:r.number.isRequired,headersTotalHeight:r.number.isRequired,isReady:r.bool.isRequired,leftPinnedWidth:r.number.isRequired,minimumSize:r.shape({height:r.number.isRequired,width:r.number.isRequired}).isRequired,rightPinnedWidth:r.number.isRequired,root:r.shape({height:r.number.isRequired,width:r.number.isRequired}).isRequired,rowHeight:r.number.isRequired,rowWidth:r.number.isRequired,scrollbarSize:r.number.isRequired,topContainerHeight:r.number.isRequired,viewportInnerSize:r.shape({height:r.number.isRequired,width:r.number.isRequired}).isRequired,viewportOuterSize:r.shape({height:r.number.isRequired,width:r.number.isRequired}).isRequired}).isRequired,focusedColumnIndex:r.number,index:r.number.isRequired,isFirstVisible:r.bool.isRequired,isLastVisible:r.bool.isRequired,isNotVisible:r.bool.isRequired,offsetLeft:r.number.isRequired,offsetTop:r.number,onClick:r.func,onDoubleClick:r.func,onMouseEnter:r.func,onMouseLeave:r.func,pinnedColumns:r.object.isRequired,renderContext:r.shape({firstColumnIndex:r.number.isRequired,firstRowIndex:r.number.isRequired,lastColumnIndex:r.number.isRequired,lastRowIndex:r.number.isRequired}).isRequired,row:r.object.isRequired,rowHeight:r.oneOfType([r.oneOf(["auto"]),r.number]).isRequired,rowId:r.oneOfType([r.number,r.string]).isRequired,selected:r.bool.isRequired,tabbableCell:r.string,visibleColumns:r.arrayOf(r.object).isRequired});const z=s(H);export{z as GridRow};
