import e from"../../../../@babel/runtime/helpers/esm/extends.js";import*as o from"react";import t from"../../../../prop-types/index.js";import{gridColumnDefinitionsSelector as l,gridColumnVisibilityModelSelector as s}from"../../hooks/features/columns/gridColumnsSelector.js";import{useGridSelector as r}from"../../hooks/utils/useGridSelector.js";import{useGridApiContext as n}from"../../hooks/utils/useGridApiContext.js";import{useGridRootProps as a}from"../../hooks/utils/useGridRootProps.js";import{getDataGridUtilityClass as i}from"../../constants/gridClasses.js";import{checkColumnVisibilityModelsSame as c,defaultSearchPredicate as m}from"./utils.js";import{jsxs as u,jsx as d}from"react/jsx-runtime";import f from"../../../utils/useLazyRef/useLazyRef.js";import p from"../../../material/FormControlLabel/FormControlLabel.js";import g from"../../../material/styles/styled.js";import h from"../../../utils/composeClasses/composeClasses.js";const b=new Intl.Collator;function C(t){const g=n(),C=o.useRef(null),k=r(g,l),w=f((()=>s(g))).current,T=r(g,s),j=a(),[R,S]=o.useState(""),F=(e=>{const{classes:o}=e;return h({root:["columnsManagement"],header:["columnsManagementHeader"],footer:["columnsManagementFooter"],row:["columnsManagementRow"]},i,o)})(j),{sort:N,searchPredicate:L=m,autoFocusSearchField:H=!0,disableShowHideToggle:P=!1,disableResetButton:A=!1,toggleAllMode:G="all",getTogglableColumns:D}=t,I=o.useMemo((()=>c(T,w)),[T,w]),O=o.useMemo((()=>{switch(N){case"asc":return[...k].sort(((e,o)=>b.compare(e.headerName||e.field,o.headerName||o.field)));case"desc":return[...k].sort(((e,o)=>-b.compare(e.headerName||e.field,o.headerName||o.field)));default:return k}}),[k,N]),B=e=>{const{name:o}=e.target;g.current.setColumnVisibility(o,!1===T[o])},E=o.useMemo((()=>{const e=D?D(O):null,o=e?O.filter((({field:o})=>e.includes(o))):O;return R?o.filter((e=>L(e,R.toLowerCase()))):o}),[O,R,L,D]),V=o.useCallback((o=>{const t=s(g),l=e({},t),r=D?D(k):null;return("filteredOnly"===G?E:k).forEach((e=>{e.hideable&&(null==r||r.includes(e.field))&&(o?delete l[e.field]:l[e.field]=!1)})),g.current.setColumnVisibilityModel(l)}),[g,k,D,G,E]),z=o.useCallback((e=>{S(e.target.value)}),[]),q=o.useMemo((()=>E.filter((e=>e.hideable))),[E]),W=o.useMemo((()=>q.every((e=>null==T[e.field]||!1!==T[e.field]))),[T,q]),$=o.useMemo((()=>q.every((e=>!1===T[e.field]))),[T,q]),_=o.useRef(null);o.useEffect((()=>{H?C.current.focus():_.current&&"function"==typeof _.current.focus&&_.current.focus()}),[H]);let J=!1;const K=e=>!1===J&&!1!==e.hideable&&(J=!0,!0);return u(o.Fragment,{children:[d(M,{className:F.header,ownerState:j,children:d(j.slots.baseTextField,e({placeholder:g.current.getLocaleText("columnsManagementSearchTitle"),inputRef:C,value:R,onChange:z,variant:"outlined",size:"small",InputProps:{startAdornment:d(j.slots.baseInputAdornment,{position:"start",children:d(j.slots.quickFilterIcon,{})}),sx:{pl:1.5}},fullWidth:!0},j.slotProps?.baseTextField))}),u(x,{className:F.root,ownerState:j,children:[E.map((o=>d(p,{className:F.row,control:d(j.slots.baseCheckbox,e({disabled:!1===o.hideable,checked:!1!==T[o.field],onClick:B,name:o.field,sx:{p:.5},inputRef:K(o)?_:void 0},j.slotProps?.baseCheckbox)),label:o.headerName||o.field},o.field))),0===E.length&&d(y,{ownerState:j,children:g.current.getLocaleText("columnsManagementNoColumns")})]}),P&&A||!(E.length>0)?null:u(v,{ownerState:j,className:F.footer,children:[P?d("span",{}):d(p,{control:d(j.slots.baseCheckbox,e({disabled:0===q.length,checked:W,indeterminate:!W&&!$,onClick:()=>V(!W),name:g.current.getLocaleText("columnsManagementShowHideAllText"),sx:{p:.5}},j.slotProps?.baseCheckbox)),label:g.current.getLocaleText("columnsManagementShowHideAllText")}),A?null:d(j.slots.baseButton,e({onClick:()=>g.current.setColumnVisibilityModel(w),disabled:I},j.slotProps?.baseButton,{children:g.current.getLocaleText("columnsManagementReset")}))]})]})}"production"!==process.env.NODE_ENV&&(C.propTypes={autoFocusSearchField:t.bool,disableResetButton:t.bool,disableShowHideToggle:t.bool,getTogglableColumns:t.func,searchPredicate:t.func,sort:t.oneOf(["asc","desc"]),toggleAllMode:t.oneOf(["all","filteredOnly"])});const x=g("div",{name:"MuiDataGrid",slot:"ColumnsManagement",overridesResolver:(e,o)=>o.columnsManagement})((({theme:e})=>({padding:e.spacing(0,3,1.5),display:"flex",flexDirection:"column",overflow:"auto",flex:"1 1",maxHeight:400,alignItems:"flex-start"}))),M=g("div",{name:"MuiDataGrid",slot:"ColumnsManagementHeader",overridesResolver:(e,o)=>o.columnsManagementHeader})((({theme:e})=>({padding:e.spacing(1.5,3)}))),v=g("div",{name:"MuiDataGrid",slot:"ColumnsManagementFooter",overridesResolver:(e,o)=>o.columnsManagementFooter})((({theme:e})=>({padding:e.spacing(.5,1,.5,3),display:"flex",justifyContent:"space-between",borderTop:`1px solid ${e.palette.divider}`}))),y=g("div")((({theme:e})=>({padding:e.spacing(.5,0),color:e.palette.grey[500]})));export{C as GridColumnsManagement};
