import e from"../../../../@babel/runtime/helpers/esm/extends.js";import o from"../../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as t from"react";import s from"../../../../prop-types/index.js";import{isMultipleRowSelectionEnabled as r}from"../../hooks/features/rowSelection/utils.js";import{useGridSelector as i}from"../../hooks/utils/useGridSelector.js";import{gridTabIndexColumnHeaderSelector as c}from"../../hooks/features/focus/gridFocusStateSelector.js";import{gridRowSelectionStateSelector as l}from"../../hooks/features/rowSelection/gridRowSelectionSelector.js";import{useGridApiContext as n}from"../../hooks/utils/useGridApiContext.js";import{getDataGridUtilityClass as a}from"../../constants/gridClasses.js";import{useGridRootProps as u}from"../../hooks/utils/useGridRootProps.js";import{gridExpandedSortedRowIdsSelector as m}from"../../hooks/features/filter/gridFilterSelector.js";import{gridPaginatedVisibleSortedGridRowIdsSelector as f}from"../../hooks/features/pagination/gridPaginationSelector.js";import{jsx as p}from"react/jsx-runtime";import b from"../../../utils/composeClasses/composeClasses.js";const h=["field","colDef"],d=t.forwardRef((function(s,d){const k=o(s,h),[,g]=t.useState(!1),S=n(),j=u(),x=(e=>{const{classes:o}=e;return b({root:["checkboxInput"]},a,o)})({classes:j.classes}),C=i(S,c),w=i(S,l),R=i(S,m),y=i(S,f),E=t.useMemo((()=>"function"!=typeof j.isRowSelectable?w:w.filter((e=>!!S.current.getRow(e)&&j.isRowSelectable(S.current.getRowParams(e))))),[S,j.isRowSelectable,w]),v=t.useMemo((()=>(j.pagination&&j.checkboxSelectionVisibleOnly?y:R).reduce(((e,o)=>(e[o]=!0,e)),{})),[j.pagination,j.checkboxSelectionVisibleOnly,y,R]),P=t.useMemo((()=>E.filter((e=>v[e])).length),[E,v]),D=P>0&&P<Object.keys(v).length,O=P>0,A=null!==C&&C.field===s.field?0:-1;t.useLayoutEffect((()=>{const e=S.current.getColumnHeaderElement(s.field);0===A&&e&&(e.tabIndex=-1)}),[A,S,s.field]);const G=t.useCallback((e=>{" "===e.key&&S.current.publishEvent("headerSelectionCheckboxChange",{value:!O})}),[S,O]),I=t.useCallback((()=>{g((e=>!e))}),[]);t.useEffect((()=>S.current.subscribeEvent("rowSelectionChange",I)),[S,I]);const L=S.current.getLocaleText(O?"checkboxSelectionUnselectAllRows":"checkboxSelectionSelectAllRows");return p(j.slots.baseCheckbox,e({ref:d,indeterminate:D,checked:O,onChange:e=>{const o={value:e.target.checked};S.current.publishEvent("headerSelectionCheckboxChange",o)},className:x.root,inputProps:{"aria-label":L},tabIndex:A,onKeyDown:G,disabled:!r(j)},j.slotProps?.baseCheckbox,k))}));"production"!==process.env.NODE_ENV&&(d.propTypes={colDef:s.object.isRequired,field:s.string.isRequired});export{d as GridHeaderCheckbox};
