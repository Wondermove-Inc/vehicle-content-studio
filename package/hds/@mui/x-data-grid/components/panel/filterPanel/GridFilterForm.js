import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import t from"../../../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as r from"react";import{createElement as l}from"react";import o from"../../../../../prop-types/index.js";import{clsx as s}from"../../../node_modules/clsx/dist/clsx.js";import{gridColumnLookupSelector as a,gridFilterableColumnDefinitionsSelector as i}from"../../../hooks/features/columns/gridColumnsSelector.js";import{gridFilterModelSelector as n}from"../../../hooks/features/filter/gridFilterSelector.js";import{useGridSelector as p}from"../../../hooks/utils/useGridSelector.js";import{GridLogicOperator as u}from"../../../models/gridFilterItem.js";import{useGridApiContext as d}from"../../../hooks/utils/useGridApiContext.js";import{useGridRootProps as c}from"../../../hooks/utils/useGridRootProps.js";import{getDataGridUtilityClass as m}from"../../../constants/gridClasses.js";import{getValueOptions as f,getValueFromValueOptions as v}from"./filterPanelUtils.js";import{jsxs as I,jsx as g}from"react/jsx-runtime";import b from"../../../../material/styles/styled.js";import F from"../../../../utils/useId/useId.js";import h from"../../../../utils/capitalize/capitalize.js";import O from"../../../../utils/composeClasses/composeClasses.js";const C=["item","hasMultipleFilters","deleteFilter","applyFilterChanges","showMultiFilterOperators","disableMultiFilterOperator","applyMultiFilterOperatorChanges","focusElementRef","logicOperators","columnsSort","filterColumns","deleteIconProps","logicOperatorInputProps","operatorInputProps","columnInputProps","valueInputProps","readOnly","children"],P=["InputComponentProps"],y=b("div",{name:"MuiDataGrid",slot:"FilterForm",overridesResolver:(e,t)=>t.filterForm})((({theme:e})=>({display:"flex",padding:e.spacing(1)}))),S=b("div",{name:"MuiDataGrid",slot:"FilterFormDeleteIcon",overridesResolver:(e,t)=>t.filterFormDeleteIcon})((({theme:e})=>({flexShrink:0,justifyContent:"flex-end",marginRight:e.spacing(.5),marginBottom:e.spacing(.2)}))),R=b("div",{name:"MuiDataGrid",slot:"FilterFormLogicOperatorInput",overridesResolver:(e,t)=>t.filterFormLogicOperatorInput})({minWidth:55,marginRight:5,justifyContent:"end"}),x=b("div",{name:"MuiDataGrid",slot:"FilterFormColumnInput",overridesResolver:(e,t)=>t.filterFormColumnInput})({width:150}),M=b("div",{name:"MuiDataGrid",slot:"FilterFormOperatorInput",overridesResolver:(e,t)=>t.filterFormOperatorInput})({width:120}),j=b("div",{name:"MuiDataGrid",slot:"FilterFormValueInput",overridesResolver:(e,t)=>t.filterFormValueInput})({width:190}),L=e=>e.headerName||e.field,N=new Intl.Collator,w=r.forwardRef((function(o,b){const{item:w,hasMultipleFilters:k,deleteFilter:D,applyFilterChanges:T,showMultiFilterOperators:G,disableMultiFilterOperator:A,applyMultiFilterOperatorChanges:q,focusElementRef:E,logicOperators:V=[u.And,u.Or],columnsSort:z,filterColumns:B,deleteIconProps:U={},logicOperatorInputProps:W={},operatorInputProps:_={},columnInputProps:H={},valueInputProps:X={},readOnly:$}=o,J=t(o,C),K=d(),Q=p(K,a),Y=p(K,i),Z=p(K,n),ee=F(),te=F(),re=F(),le=F(),oe=c(),se=(e=>{const{classes:t}=e;return O({root:["filterForm"],deleteIcon:["filterFormDeleteIcon"],logicOperatorInput:["filterFormLogicOperatorInput"],columnInput:["filterFormColumnInput"],operatorInput:["filterFormOperatorInput"],valueInput:["filterFormValueInput"]},m,t)})(oe),ae=r.useRef(null),ie=r.useRef(null),ne=Z.logicOperator??u.And,pe=k&&V.length>0,ue=oe.slotProps?.baseFormControl||{},de=(oe.slotProps?.baseSelect||{}).native??!1,ce=oe.slotProps?.baseInputLabel||{},me=oe.slotProps?.baseSelectOption||{},{InputComponentProps:fe}=X,ve=t(X,P),{filteredColumns:Ie,selectedField:ge}=r.useMemo((()=>{let e=w.field;const t=!1===Q[w.field].filterable?Q[w.field]:null;if(t)return{filteredColumns:[t],selectedField:e};if(void 0===B||"function"!=typeof B)return{filteredColumns:Y,selectedField:e};const r=B({field:w.field,columns:Y,currentFilters:Z?.items||[]});return{filteredColumns:Y.filter((t=>{const l=r.includes(t.field);return t.field!==w.field||l||(e=void 0),l})),selectedField:e}}),[B,Z?.items,Y,w.field,Q]),be=r.useMemo((()=>{switch(z){case"asc":return Ie.sort(((e,t)=>N.compare(L(e),L(t))));case"desc":return Ie.sort(((e,t)=>-N.compare(L(e),L(t))));default:return Ie}}),[Ie,z]),Fe=w.field?K.current.getColumn(w.field):null,he=r.useMemo((()=>w.operator&&Fe?Fe.filterOperators?.find((e=>e.value===w.operator)):null),[w,Fe]),Oe=r.useCallback((t=>{const r=t.target.value,l=K.current.getColumn(r);if(l.field===Fe.field)return;const o=l.filterOperators.find((e=>e.value===w.operator))||l.filterOperators[0];let s=!o.InputComponent||o.InputComponent!==he?.InputComponent||l.type!==Fe.type?void 0:w.value;if("singleSelect"===l.type&&void 0!==s){const e=l,t=f(e);Array.isArray(s)?s=s.filter((r=>void 0!==v(r,t,e?.getOptionValue))):void 0===v(w.value,t,e?.getOptionValue)&&(s=void 0)}T(e({},w,{field:r,operator:o.value,value:s}))}),[K,T,w,Fe,he]),Ce=r.useCallback((t=>{const r=t.target.value,l=Fe?.filterOperators.find((e=>e.value===r));T(e({},w,{operator:r,value:!l?.InputComponent||l?.InputComponent!==he?.InputComponent?void 0:w.value}))}),[T,w,Fe,he]),Pe=r.useCallback((e=>{const t=e.target.value===u.And.toString()?u.And:u.Or;q(t)}),[q]);return r.useImperativeHandle(E,(()=>({focus:()=>{he?.InputComponent?ae?.current?.focus():ie.current.focus()}})),[he]),I(y,e({ref:b,className:se.root,"data-id":w.id,ownerState:oe},J,{children:[g(S,e({variant:"standard",as:oe.slots.baseFormControl},ue,U,{className:s(se.deleteIcon,ue.className,U.className),ownerState:oe,children:g(oe.slots.baseIconButton,e({"aria-label":K.current.getLocaleText("filterPanelDeleteIconLabel"),title:K.current.getLocaleText("filterPanelDeleteIconLabel"),onClick:()=>{oe.disableMultipleColumnsFiltering?void 0===w.value?D(w):T(e({},w,{value:void 0})):D(w)},size:"small",disabled:$},oe.slotProps?.baseIconButton,{children:g(oe.slots.filterPanelDeleteIcon,{fontSize:"small"})}))})),g(R,e({variant:"standard",as:oe.slots.baseFormControl},ue,W,{sx:e({display:pe?"flex":"none",visibility:G?"visible":"hidden"},ue.sx||{},W.sx||{}),className:s(se.logicOperatorInput,ue.className,W.className),ownerState:oe,children:g(oe.slots.baseSelect,e({inputProps:{"aria-label":K.current.getLocaleText("filterPanelLogicOperator")},value:ne??"",onChange:Pe,disabled:!!A||1===V.length,native:de},oe.slotProps?.baseSelect,{children:V.map((t=>l(oe.slots.baseSelectOption,e({},me,{native:de,key:t.toString(),value:t.toString()}),K.current.getLocaleText((e=>{switch(e){case u.And:return"filterPanelOperatorAnd";case u.Or:return"filterPanelOperatorOr";default:throw new Error("MUI X: Invalid `logicOperator` property in the `GridFilterPanel`.")}})(t)))))}))})),I(x,e({variant:"standard",as:oe.slots.baseFormControl},ue,H,{className:s(se.columnInput,ue.className,H.className),ownerState:oe,children:[g(oe.slots.baseInputLabel,e({},ce,{htmlFor:ee,id:te,children:K.current.getLocaleText("filterPanelColumns")})),g(oe.slots.baseSelect,e({labelId:te,id:ee,label:K.current.getLocaleText("filterPanelColumns"),value:ge??"",onChange:Oe,native:de,disabled:$},oe.slotProps?.baseSelect,{children:be.map((t=>l(oe.slots.baseSelectOption,e({},me,{native:de,key:t.field,value:t.field}),L(t))))}))]})),I(M,e({variant:"standard",as:oe.slots.baseFormControl},ue,_,{className:s(se.operatorInput,ue.className,_.className),ownerState:oe,children:[g(oe.slots.baseInputLabel,e({},ce,{htmlFor:re,id:le,children:K.current.getLocaleText("filterPanelOperator")})),g(oe.slots.baseSelect,e({labelId:le,label:K.current.getLocaleText("filterPanelOperator"),id:re,value:w.operator,onChange:Ce,native:de,inputRef:ie,disabled:$},oe.slotProps?.baseSelect,{children:Fe?.filterOperators?.map((t=>l(oe.slots.baseSelectOption,e({},me,{native:de,key:t.value,value:t.value}),t.label||K.current.getLocaleText(`filterOperator${h(t.value)}`))))}))]})),g(j,e({variant:"standard",as:oe.slots.baseFormControl},ue,ve,{className:s(se.valueInput,ue.className,ve.className),ownerState:oe,children:he?.InputComponent?g(he.InputComponent,e({apiRef:K,item:w,applyValue:T,focusElementRef:ae,disabled:$},he.InputComponentProps,fe),w.field):null}))]}))}));"production"!==process.env.NODE_ENV&&(w.propTypes={applyFilterChanges:o.func.isRequired,applyMultiFilterOperatorChanges:o.func.isRequired,children:o.node,columnInputProps:o.any,columnsSort:o.oneOf(["asc","desc"]),deleteFilter:o.func.isRequired,deleteIconProps:o.any,disableMultiFilterOperator:o.bool,filterColumns:o.func,focusElementRef:o.oneOfType([o.func,o.object]),hasMultipleFilters:o.bool.isRequired,item:o.shape({field:o.string.isRequired,id:o.oneOfType([o.number,o.string]),operator:o.string.isRequired,value:o.any}).isRequired,logicOperatorInputProps:o.any,logicOperators:o.arrayOf(o.oneOf(["and","or"]).isRequired),operatorInputProps:o.any,readOnly:o.bool,showMultiFilterOperators:o.bool,valueInputProps:o.any});export{w as GridFilterForm};
