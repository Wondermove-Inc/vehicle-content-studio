import e from"../../../../@babel/runtime/helpers/esm/extends.js";import o from"../../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as t from"react";import l from"../../../../prop-types/index.js";import{clsx as s}from"../../node_modules/clsx/dist/clsx.js";import{fastMemo as n}from"../../utils/fastMemo.js";import{doesSupportPreventScroll as r}from"../../utils/doesSupportPreventScroll.js";import{gridClasses as i,getDataGridUtilityClass as c}from"../../constants/gridClasses.js";import{useGridSelector as u,objectShallowCompare as a}from"../../hooks/utils/useGridSelector.js";import{useGridApiContext as d}from"../../hooks/utils/useGridApiContext.js";import{useGridRootProps as f}from"../../hooks/utils/useGridRootProps.js";import{gridFocusCellSelector as p}from"../../hooks/features/focus/gridFocusStateSelector.js";import{MissingRowIdError as m}from"../../hooks/features/rows/useGridParamsApi.js";import{shouldCellShowLeftBorder as h,shouldCellShowRightBorder as g}from"../../utils/cellBorderUtils.js";import{GridPinnedColumnPosition as b}from"../../hooks/features/columns/gridColumnsInterfaces.js";import{jsx as w}from"react/jsx-runtime";import{GridCellModes as C}from"../../models/gridEditRowModel.js";import E from"../../../utils/useForkRef/useForkRef.js";import R from"../../../utils/ownerDocument/ownerDocument.js";import v from"../../../utils/capitalize/capitalize.js";import D from"../../../utils/composeClasses/composeClasses.js";const y=["column","rowId","editCellState","align","children","colIndex","width","className","style","gridHasScrollX","colSpan","disableDragEvents","isNotVisible","pinnedOffset","pinnedPosition","sectionIndex","sectionLength","gridHasFiller","onClick","onDoubleClick","onMouseDown","onMouseUp","onMouseOver","onKeyDown","onKeyUp","onDragEnter","onDragOver"],I=["changeReason","unstable_updateValueOnRender"];let N=function(e){return e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.VIRTUAL=3]="VIRTUAL",e}({});const S={[N.LEFT]:b.LEFT,[N.RIGHT]:b.RIGHT,[N.NONE]:void 0,[N.VIRTUAL]:void 0},j={id:-1,field:"__unset__",row:{},rowNode:{id:-1,depth:0,type:"leaf",parent:-1,groupingKey:null},colDef:{type:"string",field:"__unset__",computedWidth:0},cellMode:C.View,hasFocus:!1,tabIndex:-1,value:null,formattedValue:"__unset__",isEditable:!1,api:{}};let x=!1;const F=t.forwardRef((function(l,n){const{column:b,rowId:F,editCellState:M,align:k,colIndex:O,width:P,className:V,style:T,colSpan:_,disableDragEvents:L,isNotVisible:U,pinnedOffset:q,pinnedPosition:G,sectionIndex:H,sectionLength:K,gridHasFiller:B,onClick:A,onDoubleClick:$,onMouseDown:W,onMouseUp:z,onMouseOver:X,onKeyDown:J,onKeyUp:Q,onDragEnter:Y,onDragOver:Z}=l,ee=o(l,y),oe=d(),te=f(),le=b.field,se=u(oe,(()=>{try{const e=oe.current.getCellParams(F,le);return e.api=oe.current,e}catch(e){if(e instanceof m)return j;throw e}}),a),ne=u(oe,(()=>oe.current.unstable_applyPipeProcessors("isCellSelected",!1,{id:F,field:le}))),{cellMode:re,hasFocus:ie,isEditable:ce=!1,value:ue}=se,ae="actions"===b.type&&b.getActions?.(oe.current.getRowParams(F)).some((e=>!e.props.disabled)),de="view"!==re&&ce||ae?-1:se.tabIndex,{classes:fe,getCellClassName:pe}=te,me=[u(oe,(()=>oe.current.unstable_applyPipeProcessors("cellClassName",[],{id:F,field:le}).filter(Boolean).join(" ")))];b.cellClassName&&me.push("function"==typeof b.cellClassName?b.cellClassName(se):b.cellClassName),"flex"===b.display&&me.push(i["cell--flex"]),pe&&me.push(pe(se));const he=se.formattedValue??ue,ge=t.useRef(null),be=E(n,ge),we=t.useRef(null),Ce=te.cellSelection??!1,Ee=S[G],Re=(e=>{const{align:o,showLeftBorder:t,showRightBorder:l,pinnedPosition:s,isEditable:n,isSelected:r,isSelectionMode:i,classes:u}=e,a={root:["cell",`cell--text${v(o)}`,r&&"selected",n&&"cell--editable",t&&"cell--withLeftBorder",l&&"cell--withRightBorder",s===N.LEFT&&"cell--pinnedLeft",s===N.RIGHT&&"cell--pinnedRight",i&&!n&&"cell--selectionMode"]};return D(a,c,u)})({align:k,showLeftBorder:h(Ee,H),showRightBorder:g(Ee,H,K,te.showCellVerticalBorder,B),isEditable:ce,classes:te.classes,pinnedPosition:G,isSelected:ne,isSelectionMode:Ce}),ve=t.useCallback((e=>o=>{const t=oe.current.getCellParams(F,le||"");oe.current.publishEvent(e,t,o),z&&z(o)}),[oe,le,z,F]),De=t.useCallback((e=>o=>{const t=oe.current.getCellParams(F,le||"");oe.current.publishEvent(e,t,o),W&&W(o)}),[oe,le,W,F]),ye=t.useCallback(((e,o)=>t=>{if(!oe.current.getRow(F))return;const l=oe.current.getCellParams(F,le||"");oe.current.publishEvent(e,l,t),o&&o(t)}),[oe,le,F]),Ie=t.useMemo((()=>{if(U)return{padding:0,opacity:0,width:0,border:0};const o=e({"--width":`${P}px`},T);return G===N.LEFT&&(o.left=q),G===N.RIGHT&&(o.right=q),o}),[P,U,T,q,G]);if(t.useEffect((()=>{if(!ie||re===C.Edit)return;const e=R(oe.current.rootElementRef.current);if(ge.current&&!ge.current.contains(e.activeElement)){const e=ge.current.querySelector('[tabindex="0"]'),o=we.current||e||ge.current;if(r())o.focus({preventScroll:!0});else{const e=oe.current.getScrollPosition();o.focus(),oe.current.scroll(e)}}}),[ie,re,oe]),se===j)return null;let Ne,Se,je=ee.onFocus;if("test"===process.env.NODE_ENV&&te.experimentalFeatures?.warnIfFocusStateIsNotSynced&&(je=e=>{const o=p(oe);o?.id!==F||o.field!==le?x||(console.warn([`MUI X: The cell with id=${F} and field=${le} received focus.`,`According to the state, the focus should be at id=${o?.id}, field=${o?.field}.`,"Not syncing the state may cause unwanted behaviors since the `cellFocusIn` event won't be fired.","Call `fireEvent.mouseUp` before the `fireEvent.click` to sync the focus with the state."].join("\n")),x=!0):"function"==typeof ee.onFocus&&ee.onFocus(e)}),null===M&&b.renderCell&&(Ne=b.renderCell(se)),null!==M&&b.renderEditCell){const t=oe.current.getRowWithUpdatedValues(F,b.field),l=o(M,I),s=b.valueFormatter?b.valueFormatter(M.value,t,b,oe):se.formattedValue,n=e({},se,{row:t,formattedValue:s},l);Ne=b.renderEditCell(n),me.push(i["cell--editing"]),me.push(fe?.["cell--editing"])}if(void 0===Ne){const e=he?.toString();Ne=e,Se=e}t.isValidElement(Ne)&&ae&&(Ne=t.cloneElement(Ne,{focusElementRef:we}));const xe=L?null:{onDragEnter:ye("cellDragEnter",Y),onDragOver:ye("cellDragOver",Z)};return w("div",e({ref:be,className:s(V,me,Re.root),role:"gridcell","data-field":le,"data-colindex":O,"aria-colindex":O+1,"aria-colspan":_,style:Ie,title:Se,tabIndex:de,onClick:ye("cellClick",A),onDoubleClick:ye("cellDoubleClick",$),onMouseOver:ye("cellMouseOver",X),onMouseDown:De("cellMouseDown"),onMouseUp:ve("cellMouseUp"),onKeyDown:ye("cellKeyDown",J),onKeyUp:ye("cellKeyUp",Q)},xe,ee,{onFocus:je,children:Ne}))}));"production"!==process.env.NODE_ENV&&(F.propTypes={align:l.oneOf(["center","left","right"]).isRequired,className:l.string,colIndex:l.number.isRequired,colSpan:l.number,column:l.object.isRequired,disableDragEvents:l.bool,editCellState:l.shape({changeReason:l.oneOf(["debouncedSetEditCellValue","setEditCellValue"]),isProcessingProps:l.bool,isValidating:l.bool,value:l.any}),gridHasFiller:l.bool.isRequired,isNotVisible:l.bool.isRequired,onClick:l.func,onDoubleClick:l.func,onDragEnter:l.func,onDragOver:l.func,onKeyDown:l.func,onMouseDown:l.func,onMouseUp:l.func,pinnedOffset:l.number.isRequired,pinnedPosition:l.oneOf([0,1,2,3]).isRequired,rowId:l.oneOfType([l.number,l.string]).isRequired,sectionIndex:l.number.isRequired,sectionLength:l.number.isRequired,width:l.number.isRequired});const M=n(F);export{M as GridCell,N as PinnedPosition,S as gridPinnedColumnPositionLookup};
