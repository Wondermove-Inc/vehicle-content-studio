import e from"../../../../@babel/runtime/helpers/esm/extends.js";import o from"../../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as t from"react";import{createElement as i}from"react";import r from"../../../../prop-types/index.js";import{GridCellEditStopReasons as s}from"../../models/params/gridEditCellParams.js";import{isEscapeKey as l}from"../../utils/keyboardUtils.js";import{useGridRootProps as n}from"../../hooks/utils/useGridRootProps.js";import{GridEditModes as a}from"../../models/gridEditRowModel.js";import{isSingleSelectColDef as u,getValueOptions as d,getValueFromValueOptions as c}from"../panel/filterPanel/filterPanelUtils.js";import{useGridApiContext as p}from"../../hooks/utils/useGridApiContext.js";import{jsx as f}from"react/jsx-runtime";import m from"../../../utils/useEnhancedEffect/useEnhancedEffect.js";const b=["id","value","formattedValue","api","field","row","rowNode","colDef","cellMode","isEditable","tabIndex","className","hasFocus","isValidating","isProcessingProps","error","onValueChange","initialOpen"],h=["MenuProps"];function g(r){const g=n(),{id:E,value:P,field:R,row:j,colDef:y,hasFocus:O,error:v,onValueChange:C,initialOpen:w=g.editMode===a.Cell}=r,V=o(r,b),k=p(),q=t.useRef(),M=t.useRef(),[S,x]=t.useState(w),D=(g.slotProps?.baseSelect||{}).native??!1,N=g.slotProps?.baseSelect||{},{MenuProps:F}=N,G=o(N,h);if(m((()=>{O&&M.current?.focus()}),[O]),!u(y))return null;const I=d(y,{id:E,row:j});if(!I)return null;const L=y.getOptionValue,T=y.getOptionLabel;return I&&y?f(g.slots.baseSelect,e({ref:q,inputRef:M,value:P,onChange:async e=>{if(!u(y)||!I)return;x(!1);const o=e.target,t=c(o.value,I,L);C&&await C(e,t),await k.current.setEditCellValue({id:E,field:R,value:t},e)},open:S,onOpen:e=>{(function(e){return!!e.key})(e)&&"Enter"===e.key||x(!0)},MenuProps:e({onClose:(o,t)=>{if(g.editMode!==a.Row){if("backdropClick"===t||l(o.key)){const t=k.current.getCellParams(E,R);k.current.publishEvent("cellEditStop",e({},t,{reason:l(o.key)?s.escapeKeyDown:s.cellFocusOut}))}}else x(!1)}},F),error:v,native:D,fullWidth:!0},V,G,{children:I.map((o=>{const t=L(o);return i(g.slots.baseSelectOption,e({},g.slotProps?.baseSelectOption||{},{native:D,key:t,value:t}),T(o))}))})):null}"production"!==process.env.NODE_ENV&&(g.propTypes={api:r.object.isRequired,cellMode:r.oneOf(["edit","view"]).isRequired,changeReason:r.oneOf(["debouncedSetEditCellValue","setEditCellValue"]),colDef:r.object.isRequired,field:r.string.isRequired,formattedValue:r.any,hasFocus:r.bool.isRequired,id:r.oneOfType([r.number,r.string]).isRequired,initialOpen:r.bool,isEditable:r.bool,isProcessingProps:r.bool,isValidating:r.bool,onValueChange:r.func,row:r.any.isRequired,rowNode:r.object.isRequired,tabIndex:r.oneOf([-1,0]).isRequired,value:r.any});const E=o=>f(g,e({},o));export{g as GridEditSingleSelectCell,E as renderEditSingleSelectCell};
