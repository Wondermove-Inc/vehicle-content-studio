import e from"../../../../@babel/runtime/helpers/esm/extends.js";import s from"../../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as t from"react";import o from"../../../../prop-types/index.js";import{getDataGridUtilityClass as r}from"../../constants/gridClasses.js";import{useGridRootProps as i}from"../../hooks/utils/useGridRootProps.js";import{useGridApiContext as a}from"../../hooks/utils/useGridApiContext.js";import{jsx as l}from"react/jsx-runtime";import n from"../../../material/styles/styled.js";import u from"../../../material/InputBase/InputBase.js";import d from"../../../utils/useEnhancedEffect/useEnhancedEffect.js";import m from"../../../utils/composeClasses/composeClasses.js";const p=["id","value","formattedValue","api","field","row","rowNode","colDef","cellMode","isEditable","tabIndex","hasFocus","inputProps","isValidating","isProcessingProps","onValueChange"],c=n(u)({fontSize:"inherit"});function f(o){const{id:n,value:u,field:f,colDef:b,hasFocus:g,inputProps:h,onValueChange:j}=o,C=s(o,p),N="dateTime"===b.type,R=a(),E=t.useRef(),y=t.useMemo((()=>{let e,s;if(e=null==u?null:u instanceof Date?u:new Date((u??"").toString()),null==e||Number.isNaN(e.getTime()))s="";else{s=new Date(e.getTime()-60*e.getTimezoneOffset()*1e3).toISOString().substr(0,N?16:10)}return{parsed:e,formatted:s}}),[u,N]),[V,T]=t.useState(y),q=(e=>{const{classes:s}=e;return m({root:["editInputCell"]},r,s)})({classes:i().classes}),w=t.useCallback((e=>{if(""===e)return null;const[s,t]=e.split("T"),[o,r,i]=s.split("-"),a=new Date;if(a.setFullYear(Number(o),Number(r)-1,Number(i)),a.setHours(0,0,0,0),t){const[e,s]=t.split(":");a.setHours(Number(e),Number(s),0,0)}return a}),[]),P=t.useCallback((async e=>{const s=e.target.value,t=w(s);j&&await j(e,t),T({parsed:t,formatted:s}),R.current.setEditCellValue({id:n,field:f,value:t},e)}),[R,f,n,j,w]);return t.useEffect((()=>{T((e=>y.parsed!==e.parsed&&y.parsed?.getTime()!==e.parsed?.getTime()?y:e))}),[y]),d((()=>{g&&E.current.focus()}),[g]),l(c,e({inputRef:E,fullWidth:!0,className:q.root,type:N?"datetime-local":"date",inputProps:e({max:N?"9999-12-31T23:59":"9999-12-31"},h),value:V.formatted,onChange:P},C))}"production"!==process.env.NODE_ENV&&(f.propTypes={api:o.object.isRequired,cellMode:o.oneOf(["edit","view"]).isRequired,changeReason:o.oneOf(["debouncedSetEditCellValue","setEditCellValue"]),colDef:o.object.isRequired,field:o.string.isRequired,formattedValue:o.any,hasFocus:o.bool.isRequired,id:o.oneOfType([o.number,o.string]).isRequired,isEditable:o.bool,isProcessingProps:o.bool,isValidating:o.bool,onValueChange:o.func,row:o.any.isRequired,rowNode:o.object.isRequired,tabIndex:o.oneOf([-1,0]).isRequired,value:o.any});const b=s=>l(f,e({},s));export{f as GridEditDateCell,b as renderEditDateCell};
