import e from"../../../../@babel/runtime/helpers/esm/extends.js";import t from"../../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as o from"react";import r from"../../../../prop-types/index.js";import{gridClasses as n}from"../../constants/gridClasses.js";import{GridMenu as s}from"../menu/GridMenu.js";import{useGridRootProps as i}from"../../hooks/utils/useGridRootProps.js";import{useGridApiContext as l}from"../../hooks/utils/useGridApiContext.js";import{jsx as u,jsxs as a}from"react/jsx-runtime";import c from"../../../material/styles/useTheme.js";import f from"../../../utils/useId/useId.js";import p from"../../../material/MenuList/MenuList.js";const d=["api","colDef","id","hasFocus","isEditable","field","value","formattedValue","row","rowNode","cellMode","tabIndex","position","focusElementRef"];function m(r){const{colDef:m,id:h,hasFocus:b,tabIndex:g,position:R="bottom-end",focusElementRef:y}=r,I=t(r,d),[j,E]=o.useState(-1),[w,x]=o.useState(!1),k=l(),v=o.useRef(null),M=o.useRef(null),q=o.useRef(!1),C=o.useRef({}),D=c(),A=f(),L=f(),O=i();if(!(e=>"function"==typeof e.getActions)(m))throw new Error("MUI X: Missing the `getActions` property in the `GridColDef`.");const T=m.getActions(k.current.getRowParams(h)),N=T.filter((e=>!e.props.showInMenu)),P=T.filter((e=>e.props.showInMenu)),F=N.length+(P.length?1:0);o.useLayoutEffect((()=>{b||Object.entries(C.current).forEach((([e,t])=>{t?.stop({},(()=>{delete C.current[e]}))}))}),[b]),o.useEffect((()=>{if(j<0||!v.current)return;if(j>=v.current.children.length)return;v.current.children[j].focus({preventScroll:!0})}),[j]),o.useEffect((()=>{b||(E(-1),q.current=!1)}),[b]),o.useImperativeHandle(y,(()=>({focus(){if(!q.current){const e=T.findIndex((e=>!e.props.disabled));E(e)}}})),[T]),o.useEffect((()=>{j>=F&&E(F-1)}),[j,F]);const G=()=>{x(!1)},S=e=>t=>{C.current[e]=t},V=(e,t)=>o=>{E(e),q.current=!0,t&&t(o)};return a("div",e({role:"menu",ref:v,tabIndex:-1,className:n.actionsCell,onKeyDown:e=>{if(F<=1)return;const t=(e,o)=>{if(e<0||e>T.length)return e;const r=("left"===o?-1:1)*("rtl"===D.direction?-1:1);return T[e+r]?.props.disabled?t(e+r,o):e+r};let o=j;"ArrowRight"===e.key?o=t(j,"right"):"ArrowLeft"===e.key&&(o=t(j,"left")),o<0||o>=F||o!==j&&(e.preventDefault(),e.stopPropagation(),E(o))}},I,{children:[N.map(((e,t)=>o.cloneElement(e,{key:t,touchRippleRef:S(t),onClick:V(t,e.props.onClick),tabIndex:j===t?g:-1}))),P.length>0&&L&&u(O.slots.baseIconButton,e({ref:M,id:L,"aria-label":k.current.getLocaleText("actionsCellMore"),"aria-haspopup":"menu","aria-expanded":w,"aria-controls":w?A:void 0,role:"menuitem",size:"small",onClick:()=>{x(!0),E(F-1),q.current=!0},touchRippleRef:S(L),tabIndex:j===N.length?g:-1},O.slotProps?.baseIconButton,{children:u(O.slots.moreActionsIcon,{fontSize:"small"})})),P.length>0&&u(s,{open:w,target:M.current,position:R,onClose:G,children:u(p,{id:A,className:n.menuList,onKeyDown:e=>{"Tab"===e.key&&e.preventDefault(),["Tab","Escape"].includes(e.key)&&G()},"aria-labelledby":L,variant:"menu",autoFocusItem:!0,children:P.map(((e,t)=>o.cloneElement(e,{key:t,closeMenu:G})))})})]}))}"production"!==process.env.NODE_ENV&&(m.propTypes={api:r.object,cellMode:r.oneOf(["edit","view"]).isRequired,colDef:r.object.isRequired,field:r.string.isRequired,focusElementRef:r.oneOfType([r.func,r.shape({current:r.shape({focus:r.func.isRequired})})]),formattedValue:r.any,hasFocus:r.bool.isRequired,id:r.oneOfType([r.number,r.string]).isRequired,isEditable:r.bool,position:r.oneOf(["bottom-end","bottom-start","bottom","left-end","left-start","left","right-end","right-start","right","top-end","top-start","top"]),row:r.any.isRequired,rowNode:r.object.isRequired,tabIndex:r.oneOf([-1,0]).isRequired,value:r.any});const h=t=>u(m,e({},t));export{m as GridActionsCell,h as renderActionsCell};
