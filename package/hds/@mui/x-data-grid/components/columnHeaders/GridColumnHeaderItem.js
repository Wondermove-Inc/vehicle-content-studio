import e from"../../../../@babel/runtime/helpers/esm/extends.js";import*as o from"react";import r from"../../../../prop-types/index.js";import{clsx as n}from"../../node_modules/clsx/dist/clsx.js";import{fastMemo as t}from"../../utils/fastMemo.js";import{useGridPrivateApiContext as l}from"../../hooks/utils/useGridPrivateApiContext.js";import{GridColumnHeaderSortIcon as i}from"./GridColumnHeaderSortIcon.js";import{ColumnHeaderMenuIcon as s}from"./ColumnHeaderMenuIcon.js";import{GridColumnHeaderMenu as u}from"../menu/columnMenu/GridColumnHeaderMenu.js";import{gridClasses as a,getDataGridUtilityClass as d}from"../../constants/gridClasses.js";import{useGridRootProps as c}from"../../hooks/utils/useGridRootProps.js";import{GridGenericColumnHeaderItem as m}from"./GridGenericColumnHeaderItem.js";import{isEventTargetInPortal as f}from"../../utils/domUtils.js";import{shouldCellShowLeftBorder as p,shouldCellShowRightBorder as g}from"../../utils/cellBorderUtils.js";import{jsx as b,jsxs as C}from"react/jsx-runtime";import H from"../../../utils/useId/useId.js";import h from"../../../utils/composeClasses/composeClasses.js";function R(r){const{colDef:t,columnMenuOpen:R,colIndex:D,headerHeight:I,isResizing:M,isLast:x,sortDirection:j,sortIndex:B,filterItemsCounter:O,hasFocus:S,tabIndex:w,disableReorder:L,separatorSide:q,style:E,pinnedPosition:P,indexInSection:y,sectionLength:F,gridHasFiller:k}=r,v=l(),G=c(),N=o.useRef(null),z=H(),A=H(),T=o.useRef(null),[K,U]=o.useState(R),V=o.useMemo((()=>!G.disableColumnReorder&&!L&&!t.disableReorder),[G.disableColumnReorder,L,t.disableReorder]);let _;t.renderHeader&&(_=t.renderHeader(v.current.getColumnHeaderParams(t.field)));const W=p(P,y),J=g(P,y,F,G.showCellVerticalBorder,k),Q=(e=>{const{colDef:o,classes:r,isDragging:n,sortDirection:t,showRightBorder:l,showLeftBorder:i,filterItemsCounter:s,pinnedPosition:u}=e,a=null!=t,c=null!=s&&s>0,m="number"===o.type,f={root:["columnHeader","left"===o.headerAlign&&"columnHeader--alignLeft","center"===o.headerAlign&&"columnHeader--alignCenter","right"===o.headerAlign&&"columnHeader--alignRight",o.sortable&&"columnHeader--sortable",n&&"columnHeader--moving",a&&"columnHeader--sorted",c&&"columnHeader--filtered",m&&"columnHeader--numeric","withBorderColor",l&&"columnHeader--withRightBorder",i&&"columnHeader--withLeftBorder","left"===u&&"columnHeader--pinnedLeft","right"===u&&"columnHeader--pinnedRight"],draggableContainer:["columnHeaderDraggableContainer"],titleContainer:["columnHeaderTitleContainer"],titleContainerContent:["columnHeaderTitleContainerContent"]};return h(f,d,r)})(e({},r,{classes:G.classes,showRightBorder:J,showLeftBorder:W})),X=o.useCallback((e=>o=>{f(o)||v.current.publishEvent(e,v.current.getColumnHeaderParams(t.field),o)}),[v,t.field]),Y=o.useMemo((()=>({onClick:X("columnHeaderClick"),onDoubleClick:X("columnHeaderDoubleClick"),onMouseOver:X("columnHeaderOver"),onMouseOut:X("columnHeaderOut"),onMouseEnter:X("columnHeaderEnter"),onMouseLeave:X("columnHeaderLeave"),onKeyDown:X("columnHeaderKeyDown"),onFocus:X("columnHeaderFocus"),onBlur:X("columnHeaderBlur")})),[X]),Z=o.useMemo((()=>V?{onDragStart:X("columnHeaderDragStart"),onDragEnter:X("columnHeaderDragEnter"),onDragOver:X("columnHeaderDragOver"),onDragEnd:X("columnHeaderDragEnd")}:{}),[V,X]),$=o.useMemo((()=>({onMouseDown:X("columnSeparatorMouseDown"),onDoubleClick:X("columnSeparatorDoubleClick")})),[X]);o.useEffect((()=>{K||U(R)}),[K,R]);const ee=o.useCallback((()=>{U(!1)}),[]),oe=!G.disableColumnMenu&&!t.disableColumnMenu&&b(s,{colDef:t,columnMenuId:z,columnMenuButtonId:A,open:K,iconButtonRef:T}),re=b(u,{columnMenuId:z,columnMenuButtonId:A,field:t.field,open:R,target:T.current,ContentComponent:G.slots.columnMenu,contentComponentProps:G.slotProps?.columnMenu,onExited:ee}),ne=t.sortingOrder??G.sortingOrder,te=(t.sortable||null!=j)&&!t.hideSortIcons&&!G.disableColumnSorting,le=C(o.Fragment,{children:[!G.disableColumnFilter&&b(G.slots.columnHeaderFilterIconButton,e({field:t.field,counter:O},G.slotProps?.columnHeaderFilterIconButton)),te&&b(i,{direction:j,index:B,sortingOrder:ne,disabled:!t.sortable})]});o.useLayoutEffect((()=>{const e=v.current.state.columnMenu;if(S&&!e.open){const e=N.current.querySelector('[tabindex="0"]')||N.current;e?.focus(),v.current.columnHeadersContainerRef?.current&&(v.current.columnHeadersContainerRef.current.scrollLeft=0)}}),[v,S]);const ie="function"==typeof t.headerClassName?t.headerClassName({field:t.field,colDef:t}):t.headerClassName,se=t.headerName??t.field;return b(m,e({ref:N,classes:Q,columnMenuOpen:R,colIndex:D,height:I,isResizing:M,sortDirection:j,hasFocus:S,tabIndex:w,separatorSide:q,isDraggable:V,headerComponent:_,description:t.description,elementId:t.field,width:t.computedWidth,columnMenuIconButton:oe,columnTitleIconButtons:le,headerClassName:n(ie,x&&a["columnHeader--last"]),label:se,resizable:!G.disableColumnResize&&!!t.resizable,"data-field":t.field,columnMenu:re,draggableContainerProps:Z,columnHeaderSeparatorProps:$,style:E},Y))}"production"!==process.env.NODE_ENV&&(R.propTypes={colDef:r.object.isRequired,colIndex:r.number.isRequired,columnMenuOpen:r.bool.isRequired,disableReorder:r.bool,filterItemsCounter:r.number,gridHasFiller:r.bool.isRequired,hasFocus:r.bool,headerHeight:r.number.isRequired,indexInSection:r.number.isRequired,isDragging:r.bool.isRequired,isLast:r.bool.isRequired,isResizing:r.bool.isRequired,pinnedPosition:r.oneOf(["left","right"]),sectionLength:r.number.isRequired,separatorSide:r.oneOf(["left","right"]),sortDirection:r.oneOf(["asc","desc"]),sortIndex:r.number,style:r.object,tabIndex:r.oneOf([-1,0]).isRequired});const D=t(R);export{D as GridColumnHeaderItem};
