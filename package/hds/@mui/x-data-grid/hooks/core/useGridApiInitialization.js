import*as e from"react";import{Store as t}from"../../utils/Store.js";import{useGridApiMethod as r}from"../utils/useGridApiMethod.js";import{GridSignature as n}from"../utils/useGridApiEventHandler.js";import{EventManager as u}from"../../utils/EventManager.js";const i=Symbol("mui.api_private");let s=0;function c(c,a){const o=e.useRef(),p=e.useRef();p.current||(p.current=function(e){const r=e.current?.[i];if(r)return r;const n={},c={state:n,store:t.create(n),instanceId:{id:s}};return s+=1,c.getPublicApi=()=>e.current,c.register=(t,r)=>{Object.keys(r).forEach((n=>{const u=r[n],i=c[n];if(!0===i?.spying?i.target=u:c[n]=u,"public"===t){const t=e.current,r=t[n];!0===r?.spying?r.target=u:t[n]=u}}))},c.register("private",{caches:{},eventManager:new u}),c}(o)),o.current||(o.current=function(e){return{get state(){return e.current.state},get store(){return e.current.store},get instanceId(){return e.current.instanceId},[i]:e.current}}(p));const g=e.useCallback(((...e)=>{const[t,r,u={}]=e;if(u.defaultMuiPrevented=!1,(e=>void 0!==e.isPropagationStopped)(u)&&u.isPropagationStopped())return;const i=a.signature===n.DataGridPro?{api:p.current.getPublicApi()}:{};p.current.eventManager.emit(t,r,u,i)}),[p,a.signature]),l=e.useCallback(((e,t,r)=>{p.current.eventManager.on(e,t,r);const n=p.current;return()=>{n.eventManager.removeListener(e,t)}}),[p]);return r(p,{subscribeEvent:l,publishEvent:g},"public"),c&&!c.current?.state&&(c.current=o.current),e.useImperativeHandle(c,(()=>o.current),[o]),e.useEffect((()=>{const e=p.current;return()=>{e.publishEvent("unmount")}}),[p]),p}export{c as useGridApiInitialization};
