import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as r from"react";import{useGridApiMethod as n}from"../../utils/useGridApiMethod.js";import{useGridLogger as t}from"../../utils/useGridLogger.js";import{gridPreferencePanelStateSelector as a}from"./gridPreferencePanelSelector.js";import{useGridRegisterPipeProcessor as l}from"../../core/pipeProcessing/useGridRegisterPipeProcessor.js";const c=(r,n)=>e({},r,{preferencePanel:n.initialState?.preferencePanel??{open:!1}}),s=(c,s)=>{const o=t(c,"useGridPreferencesPanel"),u=r.useRef(),p=r.useRef(),i=r.useCallback((()=>{o.debug("Hiding Preferences Panel");const r=a(c.current.state);r.openedPanelValue&&c.current.publishEvent("preferencePanelClose",{openedPanelValue:r.openedPanelValue}),c.current.setState((r=>e({},r,{preferencePanel:{open:!1}}))),c.current.forceUpdate()}),[c,o]),f=r.useCallback((()=>{p.current=setTimeout((()=>clearTimeout(u.current)),0)}),[]),P=r.useCallback((()=>{u.current=setTimeout(i,100)}),[i]),d=r.useCallback(((r,n,t)=>{o.debug("Opening Preferences Panel"),f(),c.current.setState((a=>e({},a,{preferencePanel:e({},a.preferencePanel,{open:!0,openedPanelValue:r,panelId:n,labelId:t})}))),c.current.publishEvent("preferencePanelOpen",{openedPanelValue:r}),c.current.forceUpdate()}),[o,f,c]);n(c,{showPreferences:d,hidePreferences:P},"public");const m=r.useCallback(((r,n)=>{const t=a(c.current.state);return!n.exportOnlyDirtyModels||null!=s.initialState?.preferencePanel||t.open?e({},r,{preferencePanel:t}):r}),[c,s.initialState?.preferencePanel]),b=r.useCallback(((r,n)=>{const t=n.stateToRestore.preferencePanel;return null!=t&&c.current.setState((r=>e({},r,{preferencePanel:t}))),r}),[c]);l(c,"exportState",m),l(c,"restoreState",b),r.useEffect((()=>()=>{clearTimeout(u.current),clearTimeout(p.current)}),[])};export{c as preferencePanelStateInitializer,s as useGridPreferencesPanel};
