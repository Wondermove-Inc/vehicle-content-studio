import o from"../../../../../@babel/runtime/helpers/esm/extends.js";import e from"../../../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as r from"react";import{isLeaf as n}from"../../../models/gridColumnGrouping.js";import{gridColumnGroupsUnwrappedModelSelector as u,gridColumnGroupsLookupSelector as t}from"./gridColumnGroupsSelector.js";import{useGridApiMethod as l}from"../../utils/useGridApiMethod.js";import{unwrapGroupingColumnModel as i,getColumnGroupsHeaderStructure as m}from"./gridColumnGroupsUtils.js";import{useGridApiEventHandler as p}from"../../utils/useGridApiEventHandler.js";import{gridColumnFieldsSelector as s,gridVisibleColumnFieldsSelector as c}from"../columns/gridColumnsSelector.js";const d=["groupId","children"],g=r=>{let u={};return r.forEach((r=>{if(n(r))return;const{groupId:t,children:l}=r,i=e(r,d);if(!t)throw new Error("MUI X: An element of the columnGroupingModel does not have either `field` or `groupId`.");"production"!==process.env.NODE_ENV&&(l||console.warn(`MUI X: group groupId=${t} has no children.`));const m=o({},i,{groupId:t}),p=g(l);if(void 0!==p[t]||void 0!==u[t])throw new Error(`MUI X: The groupId ${t} is used multiple times in the columnGroupingModel.`);u=o({},u,p,{[t]:m})})),o({},u)},a=(e,r,n)=>{if(!r.columnGroupingModel)return e;const u=s(n),t=c(n),l=g(r.columnGroupingModel??[]),p=i(r.columnGroupingModel??[]),d=m(u,p,n.current.state.pinnedColumns??{}),a=0===t.length?0:Math.max(...t.map((o=>p[o]?.length??0)));return o({},e,{columnGrouping:{lookup:l,unwrappedGroupingModel:p,headerStructure:d,maxDepth:a}})},h=(e,n)=>{const d=r.useCallback((o=>u(e)[o]??[]),[e]),a=r.useCallback((()=>t(e)),[e]);l(e,{getColumnGroupPath:d,getAllGroupDetails:a},"public");const h=r.useCallback((()=>{const r=i(n.columnGroupingModel??[]);e.current.setState((e=>{const n=e.columns?.orderedFields??[],u=e.pinnedColumns??{},t=m(n,r,u);return o({},e,{columnGrouping:o({},e.columnGrouping,{headerStructure:t})})}))}),[e,n.columnGroupingModel]),G=r.useCallback((r=>{const n=e.current.getPinnedColumns?.()??{},u=s(e),t=c(e),l=g(r??[]),p=i(r??[]),d=m(u,p,n),a=0===t.length?0:Math.max(...t.map((o=>p[o]?.length??0)));e.current.setState((e=>o({},e,{columnGrouping:{lookup:l,unwrappedGroupingModel:p,headerStructure:d,maxDepth:a}})))}),[e]);p(e,"columnIndexChange",h),p(e,"columnsChange",(()=>{G(n.columnGroupingModel)})),p(e,"columnVisibilityModelChange",(()=>{G(n.columnGroupingModel)})),r.useEffect((()=>{G(n.columnGroupingModel)}),[G,n.columnGroupingModel])};export{a as columnGroupsStateInitializer,h as useGridColumnGrouping};
