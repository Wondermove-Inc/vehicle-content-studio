import t from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as o from"react";import{gridPaginationRowCountSelector as e,gridPaginationMetaSelector as n,gridPaginationModelSelector as r}from"./gridPaginationSelector.js";import{useGridSelector as i}from"../../utils/useGridSelector.js";import{gridFilteredTopLevelRowCountSelector as a}from"../filter/gridFilterSelector.js";import s from"../../../../utils/useLazyRef/useLazyRef.js";import{useGridLogger as u}from"../../utils/useGridLogger.js";import{useGridApiMethod as p}from"../../utils/useGridApiMethod.js";import{useGridRegisterPipeProcessor as g}from"../../core/pipeProcessing/useGridRegisterPipeProcessor.js";import{useGridApiEventHandler as l}from"../../utils/useGridApiEventHandler.js";const c=(c,C)=>{const m=u(c,"useGridRowCount"),w=i(c,a),d=i(c,e),f=i(c,n),S=i(c,r),R=s((()=>r(c).pageSize));c.current.registerControlState({stateId:"paginationRowCount",propModel:C.rowCount,propOnChange:C.onRowCountChange,stateSelector:e,changeEvent:"rowCountChange"});const j=o.useCallback((o=>{d!==o&&(m.debug("Setting 'rowCount' to",o),c.current.setState((e=>t({},e,{pagination:t({},e.pagination,{rowCount:o})}))))}),[c,m,d]);p(c,{setRowCount:j},"public");const b=o.useCallback(((o,n)=>{const r=e(c);return!n.exportOnlyDirtyModels||null!=C.rowCount||null!=C.initialState?.pagination?.rowCount?t({},o,{pagination:t({},o.pagination,{rowCount:r})}):o}),[c,C.rowCount,C.initialState?.pagination?.rowCount]),h=o.useCallback(((o,n)=>{const r=n.stateToRestore.pagination?.rowCount?n.stateToRestore.pagination.rowCount:e(c);return c.current.setState((o=>t({},o,{pagination:t({},o.pagination,{rowCount:r})}))),o}),[c]);g(c,"exportState",b),g(c,"restoreState",h);const M=o.useCallback((t=>{"client"!==C.paginationMode&&R.current&&t.pageSize!==R.current&&(R.current=t.pageSize,-1===d&&c.current.setPage(0))}),[C.paginationMode,R,d,c]);l(c,"paginationModelChange",M),o.useEffect((()=>{"client"===C.paginationMode?c.current.setRowCount(w):null!=C.rowCount&&c.current.setRowCount(C.rowCount)}),[c,C.paginationMode,w,C.rowCount]);const z=!1===f.hasNextPage;o.useEffect((()=>{z&&-1===d&&c.current.setRowCount(S.pageSize*S.page+w)}),[c,w,z,d,S])};export{c as useGridRowCount};
