import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{gridPaginationModelSelector as a,gridPageCountSelector as i}from"./gridPaginationSelector.js";import{getValidPage as n,throwIfPageSizeExceedsTheLimit as o,defaultPageSize as r,getDefaultGridPaginationModel as g,getPageCount as p}from"./gridPaginationUtils.js";import{useGridSelector as s}from"../../utils/useGridSelector.js";import{gridDensityFactorSelector as l}from"../density/densitySelector.js";import{useGridLogger as u}from"../../utils/useGridLogger.js";import{useGridApiMethod as c}from"../../utils/useGridApiMethod.js";import{useGridRegisterPipeProcessor as d}from"../../core/pipeProcessing/useGridRegisterPipeProcessor.js";import{useGridApiEventHandler as S}from"../../utils/useGridApiEventHandler.js";const M=(t,a,i)=>{let r=t.paginationModel;const g=t.rowCount,s=i?.pageSize??r.pageSize,l=i?.page??r.page,u=p(g,s,l);!i||i?.page===r.page&&i?.pageSize===r.pageSize||(r=i);const c=n(r.page,u);return c!==r.page&&(r=e({},r,{page:c})),o(r.pageSize,a),r},m=(n,o)=>{const p=u(n,"useGridPaginationModel"),m=s(n,l),z=Math.floor(o.rowHeight*m);n.current.registerControlState({stateId:"paginationModel",propModel:o.paginationModel,propOnChange:o.onPaginationModelChange,stateSelector:a,changeEvent:"paginationModelChange"});const P=t.useCallback((e=>{const t=a(n);e!==t.page&&(p.debug(`Setting page to ${e}`),n.current.setPaginationModel({page:e,pageSize:t.pageSize}))}),[n,p]),f=t.useCallback((e=>{const t=a(n);e!==t.pageSize&&(p.debug(`Setting page size to ${e}`),n.current.setPaginationModel({pageSize:e,page:t.page}))}),[n,p]),C=t.useCallback((t=>{const i=a(n);t!==i&&(p.debug("Setting 'paginationModel' to",t),n.current.setState((a=>e({},a,{pagination:e({},a.pagination,{paginationModel:M(a.pagination,o.signature,t)})}))))}),[n,p,o.signature]);c(n,{setPage:P,setPageSize:f,setPaginationModel:C},"public");const h=t.useCallback(((t,i)=>{const g=a(n);return!i.exportOnlyDirtyModels||null!=o.paginationModel||null!=o.initialState?.pagination?.paginationModel||0!==g.page&&g.pageSize!==r(o.autoPageSize)?e({},t,{pagination:e({},t.pagination,{paginationModel:g})}):t}),[n,o.paginationModel,o.initialState?.pagination?.paginationModel,o.autoPageSize]),b=t.useCallback(((t,i)=>{const r=i.stateToRestore.pagination?.paginationModel?e({},g(o.autoPageSize),i.stateToRestore.pagination?.paginationModel):a(n);return n.current.setState((t=>e({},t,{pagination:e({},t.pagination,{paginationModel:M(t.pagination,o.signature,r)})}))),t}),[n,o.autoPageSize,o.signature]);d(n,"exportState",h),d(n,"restoreState",b);const j=t.useCallback((()=>{if(!o.autoPageSize)return;const e=n.current.getRootDimensions(),t=Math.floor(e.viewportInnerSize.height/z);n.current.setPageSize(t)}),[n,o.autoPageSize,z]),k=t.useCallback((e=>{if(null==e)return;const t=a(n),o=i(n);t.page>o-1&&n.current.setPage(Math.max(0,o-1))}),[n]);S(n,"viewportInnerSizeChange",j),S(n,"paginationModelChange",(()=>{const e=a(n);n.current.virtualScrollerRef?.current&&n.current.scrollToIndexes({rowIndex:e.page*e.pageSize})})),S(n,"rowCountChange",k),t.useEffect((()=>{n.current.setState((t=>e({},t,{pagination:e({},t.pagination,{paginationModel:M(t.pagination,o.signature,o.paginationModel)})})))}),[n,o.paginationModel,o.paginationMode,o.signature]),t.useEffect(j,[j])};export{M as getDerivedPaginationModel,m as useGridPaginationModel};
