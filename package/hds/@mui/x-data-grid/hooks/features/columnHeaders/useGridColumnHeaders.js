import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as n from"react";import{clsx as t}from"../../../node_modules/clsx/dist/clsx.js";import{useGridRootProps as o}from"../../utils/useGridRootProps.js";import{useGridPrivateApiContext as l}from"../../utils/useGridPrivateApiContext.js";import{useGridApiEventHandler as r}from"../../utils/useGridApiEventHandler.js";import{GridColumnHeaderItem as i}from"../../../components/columnHeaders/GridColumnHeaderItem.js";import{computeOffsetLeft as s}from"../virtualization/useGridVirtualScroller.js";import{GridColumnGroupHeader as d}from"../../../components/columnHeaders/GridColumnGroupHeader.js";import{gridColumnGroupsUnwrappedModelSelector as u}from"../columnGrouping/gridColumnGroupsSelector.js";import{GridScrollbarFillerCell as m}from"../../../components/GridScrollbarFillerCell.js";import{getPinnedCellOffset as a}from"../../../internals/utils/getPinnedCellOffset.js";import{GridColumnHeaderSeparatorSides as c}from"../../../components/columnHeaders/GridColumnHeaderSeparator.js";import{gridClasses as p}from"../../../constants/gridClasses.js";import{jsxs as f,jsx as h}from"react/jsx-runtime";import g from"../../../../material/styles/styled.js";import C from"../../../../material/styles/useTheme.js";import{useGridSelector as x}from"../../utils/useGridSelector.js";import{gridVirtualizationColumnEnabledSelector as I,gridRenderContextColumnsSelector as H}from"../virtualization/gridVirtualizationSelectors.js";import{gridColumnPositionsSelector as F,gridVisiblePinnedColumnDefinitionsSelector as S}from"../columns/gridColumnsSelector.js";import{gridDimensionsSelector as R}from"../dimensions/gridDimensionsSelectors.js";import{GridPinnedColumnPosition as G}from"../columns/gridColumnsInterfaces.js";const j=g("div",{name:"MuiDataGrid",slot:"ColumnHeaderRow",overridesResolver:(e,n)=>n.columnHeaderRow})({display:"flex"}),b=g=>{const{visibleColumns:b,sortColumnLookup:w,filterColumnLookup:T,columnHeaderTabIndexState:L,columnGroupHeaderTabIndexState:v,columnHeaderFocus:y,columnGroupHeaderFocus:D,headerGroupingMaxDepth:P,columnMenuState:z,columnVisibility:W,columnGroupsHeaderStructure:k,hasOtherElementInTabSequence:E}=g,[M,O]=n.useState(""),[V,A]=n.useState(""),q=l(),N=C(),_=o(),B=x(q,R),J=x(q,I),K=x(q,u),Q=x(q,F),U=x(q,H),X=x(q,S),Y=s(Q,U,N.direction,X.left.length),Z=B.columnsTotalWidth<B.viewportOuterSize.width;n.useEffect((()=>{q.current.columnHeadersContainerRef.current.scrollLeft=0}),[q]);const $=n.useCallback((e=>A(e.field)),[]),ee=n.useCallback((()=>A("")),[]),ne=n.useCallback((e=>O(e.field)),[]),te=n.useCallback((()=>O("")),[]),oe=n.useMemo((()=>X.left.length?{firstColumnIndex:0,lastColumnIndex:X.left.length}:null),[X.left.length]),le=n.useMemo((()=>X.right.length?{firstColumnIndex:b.length-X.right.length,lastColumnIndex:b.length}:null),[X.right.length,b.length]);r(q,"columnResizeStart",$),r(q,"columnResizeStop",ee),r(q,"columnHeaderDragStart",ne),r(q,"columnHeaderDragEnd",te);const re=e=>{const{renderContext:n=U,maxLastColumn:t=b.length}=e||{},o=J?n.firstColumnIndex:0,l=J?n.lastColumnIndex:t;return{renderedColumns:b.slice(o,l),firstColumnToRender:o,lastColumnToRender:l}},ie=(e,o,l,r=!1)=>{const i=e?.position===G.RIGHT,s=void 0===e?.position,d=X.right.length>0&&i||0===X.right.length&&s,u=Y-l;return f(n.Fragment,{children:[s&&h("div",{role:"presentation",style:{width:u}}),o,s&&h("div",{role:"presentation",className:t(p.filler,r&&p["filler--borderTop"])}),d&&h(m,{header:!0,borderTop:r,pinnedRight:i})]})},se=({pinnedPosition:e,columnIndex:n,computedWidth:t})=>{let o;if("left"===e||"right"===e){const l=a(e,t,n,Q,B);"left"===e&&(o={left:l}),"right"===e&&(o={right:l})}return o},de=(n,t={})=>{const{renderedColumns:o,firstColumnToRender:l}=re(n),r=[];for(let s=0;s<o.length;s+=1){const d=o[s],u=l+s,m=0===u,a=null!==L&&L.field===d.field||m&&!E?0:-1,c=null!==y&&y.field===d.field,p=z.open&&z.field===d.field,f=n?.position,g=se({pinnedPosition:f,columnIndex:u,computedWidth:d.computedWidth});r.push(h(i,e({},w[d.field],{columnMenuOpen:p,filterItemsCounter:T[d.field]&&T[d.field].length,headerHeight:B.headerHeight,isDragging:d.field===M,colDef:d,colIndex:u,isResizing:V===d.field,isLast:u===Q.length-1,hasFocus:c,tabIndex:a,pinnedPosition:f,style:g,indexInSection:s,sectionLength:o.length,gridHasFiller:Z},t),d.field))}return ie(n,r,0)},ue=({depth:n,params:t})=>{const o=re(t);if(0===o.renderedColumns.length)return null;const{renderedColumns:l,firstColumnToRender:r,lastColumnToRender:i}=o,s=k[n],u=b[r].field,m=K[u]?.[n]??null,a=s.findIndex((({groupId:e,columnFields:n})=>e===m&&n.includes(u))),c=b[i-1].field,p=K[c]?.[n]??null,f=s.findIndex((({groupId:e,columnFields:n})=>e===p&&n.includes(c))),g=s.slice(a,f+1).map((n=>e({},n,{columnFields:n.columnFields.filter((e=>!1!==W[e]))}))).filter((e=>e.columnFields.length>0)),C=g[0].columnFields.indexOf(u),x=g[0].columnFields.slice(0,C).reduce(((e,n)=>e+(q.current.getColumn(n).computedWidth??0)),0);let I=r;const H=g.map((({groupId:e,columnFields:o},r)=>{const i=null!==D&&D.depth===n&&o.includes(D.field),s=null!==v&&v.depth===n&&o.includes(v.field)?0:-1,u={groupId:e,width:o.reduce(((e,n)=>e+q.current.getColumn(n).computedWidth),0),fields:o,colIndex:I,hasFocus:i,tabIndex:s},m=t.position,a=se({pinnedPosition:m,columnIndex:I,computedWidth:u.width});I+=o.length;let c=r;return"left"===m&&(c=I-1),h(d,{groupId:e,width:u.width,fields:u.fields,colIndex:u.colIndex,depth:n,isLastColumn:u.colIndex===b.length-u.fields.length,maxDepth:P,height:B.headerHeight,hasFocus:i,tabIndex:s,pinnedPosition:m,style:a,indexInSection:c,sectionLength:l.length,gridHasFiller:Z},r)}));return ie(t,H,x)};return{renderContext:U,leftRenderContext:oe,rightRenderContext:le,pinnedColumns:X,visibleColumns:b,getCellOffsetStyle:se,getFillers:ie,getColumnHeadersRow:()=>f(j,{role:"row","aria-rowindex":P+1,ownerState:_,children:[oe&&de({position:G.LEFT,renderContext:oe,minFirstColumn:oe.firstColumnIndex,maxLastColumn:oe.lastColumnIndex},{disableReorder:!0}),de({renderContext:U,minFirstColumn:X.left.length,maxLastColumn:b.length-X.right.length}),le&&de({position:G.RIGHT,renderContext:le,minFirstColumn:le.firstColumnIndex,maxLastColumn:le.lastColumnIndex},{disableReorder:!0,separatorSide:c.Left})]}),getColumnsToRender:re,getColumnGroupHeadersRows:()=>{if(0===P)return null;const e=[];for(let n=0;n<P;n+=1)e.push(f(j,{role:"row","aria-rowindex":n+1,ownerState:_,children:[oe&&ue({depth:n,params:{position:G.LEFT,renderContext:oe,minFirstColumn:oe.firstColumnIndex,maxLastColumn:oe.lastColumnIndex}}),ue({depth:n,params:{renderContext:U}}),le&&ue({depth:n,params:{position:G.RIGHT,renderContext:le,minFirstColumn:le.firstColumnIndex,maxLastColumn:le.lastColumnIndex}})]},n));return e},isDragging:!!M,getInnerProps:()=>({role:"rowgroup"})}};export{j as GridColumnHeaderRow,b as useGridColumnHeaders};
