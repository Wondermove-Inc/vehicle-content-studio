import e from"../../../../../@babel/runtime/helpers/esm/extends.js";import*as t from"react";import{useGridApiMethod as r}from"../../utils/useGridApiMethod.js";import{useGridCellEditing as i}from"./useGridCellEditing.js";import{GridEditModes as o,GridCellModes as l}from"../../../models/gridEditRowModel.js";import{useGridRowEditing as s}from"./useGridRowEditing.js";import{gridEditRowsStateSelector as n}from"./gridEditingSelectors.js";import{isAutoGeneratedRow as c}from"../rows/gridRowsUtils.js";const d=t=>e({},t,{editRows:{}}),u=(e,d)=>{i(e,d),s(e,d);const u=t.useRef({}),{isCellEditable:a}=d,m=t.useCallback((e=>!c(e.rowNode)&&(!!e.colDef.editable&&(!!e.colDef.renderEditCell&&(!a||a(e))))),[a]);t.useEffect((()=>{const e=u.current;return()=>{Object.entries(e).forEach((([t,r])=>{Object.keys(r).forEach((r=>{const[i]=e[t][r];clearTimeout(i),delete e[t][r]}))}))}}),[]);const f=t.useCallback(((e,t)=>{if(u.current[e])if(t){if(u.current[e][t]){const[,r]=u.current[e][t];r()}}else Object.keys(u.current[e]).forEach((t=>{const[,r]=u.current[e][t];r()}))}),[]),E=t.useCallback((t=>{const{id:r,field:i,debounceMs:s}=t;return new Promise((n=>{((e,t,r,i)=>{if(!r)return void i();if(u.current[e]||(u.current[e]={}),u.current[e][t]){const[r]=u.current[e][t];clearTimeout(r)}const o=setTimeout((()=>{i(),delete u.current[e][t]}),r);u.current[e][t]=[o,()=>{const[r]=u.current[e][t];clearTimeout(r),i(),delete u.current[e][t]}]})(r,i,s,(async()=>{const s=d.editMode===o.Row?e.current.setRowEditingEditCellValue:e.current.setCellEditingEditCellValue;if(e.current.getCellMode(r,i)===l.Edit){const e=await s(t);n(e)}}))}))}),[e,d.editMode]),C=t.useCallback(((t,r)=>d.editMode===o.Cell?e.current.getRowWithUpdatedValuesFromCellEditing(t,r):e.current.getRowWithUpdatedValuesFromRowEditing(t)),[e,d.editMode]),b=t.useCallback(((t,r)=>{const i=n(e.current.state);return i[t]?.[r]??null}),[e]),g={runPendingEditCellValueMutation:f};r(e,{isCellEditable:m,setEditCellValue:E,getRowWithUpdatedValues:C,unstable_getEditCellMeta:b},"public"),r(e,g,"private")};export{d as editingStateInitializer,u as useGridEditing};
