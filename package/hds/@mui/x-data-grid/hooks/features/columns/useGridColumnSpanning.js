import*as n from"react";import{useGridApiMethod as o}from"../../utils/useGridApiMethod.js";import{useGridApiEventHandler as e}from"../../utils/useGridApiEventHandler.js";const l=l=>{const r=n.useRef({}),a=()=>{r.current={}},c={resetColSpan:a,calculateColSpan:n.useCallback((({rowId:n,minFirstColumn:o,maxLastColumn:e,columns:a})=>{for(let c=o;c<e;c+=1){const u=t({apiRef:l,lookup:r.current,columnIndex:c,rowId:n,minFirstColumnIndex:o,maxLastColumnIndex:e,columns:a});u.colSpan>1&&(c+=u.colSpan-1)}}),[l])};o(l,{unstable_getCellColSpanInfo:(n,o)=>r.current[n]?.[o]},"public"),o(l,c,"private"),e(l,"columnOrderChange",a)};function t(n){const{apiRef:o,lookup:e,columnIndex:l,rowId:t,minFirstColumnIndex:a,maxLastColumnIndex:c,columns:u}=n,p=u.length,i=u[l],s=o.current.getRow(t),m=o.current.getRowValue(s,i),d="function"==typeof i.colSpan?i.colSpan(m,s,i,o):i.colSpan;if(!d||1===d)return r(e,t,l,{spannedByColSpan:!1,cellProps:{colSpan:1,width:i.computedWidth}}),{colSpan:1};let C=i.computedWidth;for(let n=1;n<d;n+=1){const o=l+n;if(o>=a&&o<c){C+=u[o].computedWidth,r(e,t,l+n,{spannedByColSpan:!0,rightVisibleCellIndex:Math.min(l+d,p-1),leftVisibleCellIndex:l})}r(e,t,l,{spannedByColSpan:!1,cellProps:{colSpan:d,width:C}})}return{colSpan:d}}function r(n,o,e,l){n[o]||(n[o]={}),n[o][e]=l}export{l as useGridColumnSpanning};
