import*as e from"react";import{gridFocusCellSelector as t}from"../focus/gridFocusStateSelector.js";import{serializeCellValue as o}from"../export/serializers/csvSerializer.js";import{useGridNativeEventListener as r}from"../../utils/useGridNativeEventListener.js";import{useGridApiOptionHandler as i}from"../../utils/useGridApiEventHandler.js";function l(e){const t=document.createElement("span");t.style.whiteSpace="pre",t.style.userSelect="all",t.style.opacity="0px",t.textContent=e,document.body.appendChild(t);const o=document.createRange();o.selectNode(t);const r=window.getSelection();r.removeAllRanges(),r.addRange(o);try{document.execCommand("copy")}finally{document.body.removeChild(t)}}const n=(n,a)=>{const s=a.ignoreValueFormatterDuringExport,c=("object"==typeof s?s?.clipboardExport:s)||!1,p=a.clipboardCopyCellDelimiter,d=e.useCallback((e=>{if(!e.ctrlKey&&!e.metaKey||"c"!==e.key.toLowerCase()||e.shiftKey||e.altKey)return;if(r=e.target,window.getSelection()?.toString()||r&&(r.selectionEnd||0)-(r.selectionStart||0)>0)return;var r;let i="";if(n.current.getSelectedRows().size>0)i=n.current.getDataAsCsv({includeHeaders:!1,delimiter:p,shouldAppendQuotes:!1,escapeFormulas:!1});else{const e=t(n);if(e){const t=n.current.getCellParams(e.id,e.field);i=o(t,{csvOptions:{delimiter:p,shouldAppendQuotes:!1,escapeFormulas:!1},ignoreValueFormatter:c})}}var a;i=n.current.unstable_applyPipeProcessors("clipboardCopy",i),i&&(a=i,navigator.clipboard?navigator.clipboard.writeText(a).catch((()=>{l(a)})):l(a),n.current.publishEvent("clipboardCopy",i))}),[n,c,p]);r(n,n.current.rootElementRef,"keydown",d),i(n,"clipboardCopy",a.onClipboardCopy)};export{n as useGridClipboard};
