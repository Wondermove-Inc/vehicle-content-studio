import*as o from"react";import{useGridApiMethod as e}from"../../utils/useGridApiMethod.js";import{useGridLogger as r}from"../../utils/useGridLogger.js";import{exportAs as s}from"../../../utils/exportAs.js";import{buildCSV as t}from"./serializers/csvSerializer.js";import{getColumnsToExport as i,defaultGetRowsToExport as p}from"./utils.js";import{GridCsvExportMenuItem as a}from"../../../components/toolbar/GridToolbarExport.js";import{jsx as u}from"react/jsx-runtime";import{useGridRegisterPipeProcessor as n}from"../../core/pipeProcessing/useGridRegisterPipeProcessor.js";const l=(l,m)=>{const c=r(l,"useGridCsvExport"),d=m.ignoreValueFormatterDuringExport,f=("object"==typeof d?d?.csvExport:d)||!1,x=o.useCallback(((o={})=>{c.debug("Get data as CSV");const e=i({apiRef:l,options:o}),r=(o.getRowsToExport??p)({apiRef:l});return t({columns:e,rowIds:r,csvOptions:{delimiter:o.delimiter||",",shouldAppendQuotes:o.shouldAppendQuotes??!0,includeHeaders:o.includeHeaders??!0,includeColumnGroupsHeaders:o.includeColumnGroupsHeaders??!0,escapeFormulas:o.escapeFormulas??!0},ignoreValueFormatter:f,apiRef:l})}),[c,l,f]),b=o.useCallback((o=>{c.debug("Export data as CSV");const e=x(o),r=new Blob([o?.utf8WithBom?new Uint8Array([239,187,191]):"",e],{type:"text/csv"});s(r,"csv",o?.fileName)}),[c,x]);e(l,{getDataAsCsv:x,exportDataAsCsv:b},"public");const g=o.useCallback(((o,e)=>e.csvOptions?.disableToolbarButton?o:[...o,{component:u(a,{options:e.csvOptions}),componentName:"csvExport"}]),[]);n(l,"exportMenu",g)};export{l as useGridCsvExport};
