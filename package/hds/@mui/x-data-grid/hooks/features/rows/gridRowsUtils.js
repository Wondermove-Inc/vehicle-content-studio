import o from"../../../../../@babel/runtime/helpers/esm/extends.js";import{gridPinnedRowsSelector as e}from"./gridRowsSelector.js";import{gridDimensionsSelector as t}from"../dimensions/gridDimensionsSelectors.js";const r="auto-generated-group-node-root",a=Symbol("mui.id_autogenerated"),n=()=>({type:"group",id:r,depth:-1,groupingField:null,groupingKey:null,isAutoGenerated:!0,children:[],childrenFromPath:{},childrenExpanded:!0,parent:null});function d(o,e,t="A row was provided without id in the rows prop:"){if(null==o)throw new Error(["MUI X: The data grid component requires all rows to have a unique `id` property.","Alternatively, you can use the `getRowId` prop to specify a custom id for each row.",t,JSON.stringify(e)].join("\n"))}const s=(o,e,t)=>{const r=e?e(o):o.id;return d(r,o,t),r},i=({rows:o,getRowId:e,loading:t,rowCount:r})=>{const a={type:"full",rows:[]},n={},d={};for(let t=0;t<o.length;t+=1){const r=o[t],i=s(r,e);n[i]=r,d[i]=i,a.rows.push(i)}return{rowsBeforePartialUpdates:o,loadingPropBeforePartialUpdates:t,rowCountPropBeforePartialUpdates:r,updates:a,dataRowIdToIdLookup:d,dataRowIdToModelLookup:n}},p=({tree:o,rowCountProp:e=0})=>{const t=o[r];return Math.max(e,t.children.length+(null==t.footerId?0:1))},u=({apiRef:e,rowCountProp:t=0,loadingProp:r,previousTree:a,previousTreeDepths:n})=>{const d=e.current.caches.rows,{tree:s,treeDepths:i,dataRowIds:u,groupingName:l}=e.current.applyStrategyProcessor("rowTreeCreation",{previousTree:a,previousTreeDepths:n,updates:d.updates,dataRowIdToIdLookup:d.dataRowIdToIdLookup,dataRowIdToModelLookup:d.dataRowIdToModelLookup}),c=e.current.unstable_applyPipeProcessors("hydrateRows",{tree:s,treeDepths:i,dataRowIdToIdLookup:d.dataRowIdToIdLookup,dataRowIds:u,dataRowIdToModelLookup:d.dataRowIdToModelLookup});return e.current.caches.rows.updates={type:"partial",actions:{insert:[],modify:[],remove:[]},idToActionLookup:{}},o({},c,{totalRowCount:Math.max(t,c.dataRowIds.length),totalTopLevelRowCount:p({tree:c.tree,rowCountProp:t}),groupingName:l,loading:r})},l=o=>"skeletonRow"===o.type||"footer"===o.type||"group"===o.type&&o.isAutoGenerated||"pinnedRow"===o.type&&o.isAutoGenerated,c=(o,e,t)=>{const r=o[e];if("group"!==r.type)return[];const a=[];for(let e=0;e<r.children.length;e+=1){const n=r.children[e];t&&l(o[n])||a.push(n);const d=c(o,n,t);for(let o=0;o<d.length;o+=1)a.push(d[o])}return t||null==r.footerId||a.push(r.footerId),a},w=({previousCache:e,getRowId:t,updates:r})=>{if("full"===e.updates.type)throw new Error("MUI X: Unable to prepare a partial update if a full update is not applied yet.");const a=new Map;r.forEach((e=>{const r=s(e,t,"A row was provided without id when calling updateRows():");a.has(r)?a.set(r,o({},a.get(r),e)):a.set(r,e)}));const n={type:"partial",actions:{insert:[...e.updates.actions.insert??[]],modify:[...e.updates.actions.modify??[]],remove:[...e.updates.actions.remove??[]]},idToActionLookup:o({},e.updates.idToActionLookup)},d=o({},e.dataRowIdToModelLookup),i=o({},e.dataRowIdToIdLookup),p={insert:{},modify:{},remove:{}};a.forEach(((e,t)=>{const r=n.idToActionLookup[t];if("delete"===e._action){if("remove"===r||!d[t])return;return null!=r&&(p[r][t]=!0),n.actions.remove.push(t),delete d[t],void delete i[t]}const a=d[t];if(a)return"remove"===r?(p.remove[t]=!0,n.actions.modify.push(t)):null==r&&n.actions.modify.push(t),void(d[t]=o({},a,e));"remove"===r?(p.remove[t]=!0,n.actions.insert.push(t)):null==r&&n.actions.insert.push(t),d[t]=e,i[t]=t}));const u=Object.keys(p);for(let o=0;o<u.length;o+=1){const e=u[o],t=p[e];Object.keys(t).length>0&&(n.actions[e]=n.actions[e].filter((o=>!t[o])))}return{dataRowIdToModelLookup:d,dataRowIdToIdLookup:i,updates:n,rowsBeforePartialUpdates:e.rowsBeforePartialUpdates,loadingPropBeforePartialUpdates:e.loadingPropBeforePartialUpdates,rowCountPropBeforePartialUpdates:e.rowCountPropBeforePartialUpdates}};function h(o){const t=e(o);return{top:t?.top?.reduce(((e,t)=>e+=o.current.unstable_getRowHeight(t.id)),0)||0,bottom:t?.bottom?.reduce(((e,t)=>e+=o.current.unstable_getRowHeight(t.id)),0)||0}}function f(o){return`var(--DataGrid-overlayHeight, ${2*t(o.current.state).rowHeight}px)`}export{a as GRID_ID_AUTOGENERATED,r as GRID_ROOT_GROUP_ID,n as buildRootGroup,h as calculatePinnedRowsHeight,d as checkGridRowIdIsValid,i as createRowsInternalCache,f as getMinimalContentHeight,s as getRowIdFromRowModel,u as getRowsStateFromCache,p as getTopLevelRowCount,c as getTreeNodeDescendants,l as isAutoGeneratedRow,w as updateCacheWithNewRows};
