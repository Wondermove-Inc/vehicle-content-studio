"use client";
import e from"../../../@babel/runtime/helpers/esm/extends.js";import t from"../../../@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import*as r from"react";import{r as n}from"../../../react-is/index.js";import i from"../../../prop-types/index.js";import{jsx as s}from"react/jsx-runtime";import o from"../../utils/useEnhancedEffect/useEnhancedEffect.js";import l from"../../utils/getScrollbarSize/getScrollbarSize.js";import a from"../../utils/ownerDocument/ownerDocument.js";import u from"../../utils/useForkRef/useForkRef.js";import c from"../List/List.js";const d=["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"];function p(e,t,r){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:e.firstChild}function m(e,t,r){return e===t?r?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:e.lastChild}function f(e,t){if(void 0===t)return!0;let r=e.innerText;return void 0===r&&(r=e.textContent),r=r.trim().toLowerCase(),0!==r.length&&(t.repeating?r[0]===t.keys[0]:0===r.indexOf(t.keys.join("")))}function h(e,t,r,n,i,s){let o=!1,l=i(e,t,!!t&&r);for(;l;){if(l===e.firstChild){if(o)return!1;o=!0}const t=!n&&(l.disabled||"true"===l.getAttribute("aria-disabled"));if(l.hasAttribute("tabindex")&&f(l,s)&&!t)return l.focus(),!0;l=i(e,l,r)}return!1}const b=r.forwardRef((function(i,b){const{actions:g,autoFocus:y=!1,autoFocusItem:v=!1,children:E,className:w,disabledItemsFocusable:x=!1,disableListWrap:F=!1,onKeyDown:j,variant:D="selectedMenu"}=i,k=t(i,d),C=r.useRef(null),S=r.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});o((()=>{y&&C.current.focus()}),[y]),r.useImperativeHandle(g,(()=>({adjustStyleForScrollbar:(e,{direction:t})=>{const r=!C.current.style.width;if(e.clientHeight<C.current.clientHeight&&r){const r=`${l(a(e))}px`;C.current.style["rtl"===t?"paddingLeft":"paddingRight"]=r,C.current.style.width=`calc(100% + ${r})`}return C.current}})),[]);const I=u(C,b);let L=-1;r.Children.forEach(E,((e,t)=>{r.isValidElement(e)?("production"!==process.env.NODE_ENV&&n.isFragment(e)&&console.error(["MUI: The Menu component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),e.props.disabled||("selectedMenu"===D&&e.props.selected||-1===L)&&(L=t),L===t&&(e.props.disabled||e.props.muiSkipListHighlight||e.type.muiSkipListHighlight)&&(L+=1,L>=E.length&&(L=-1))):L===t&&(L+=1,L>=E.length&&(L=-1))}));const M=r.Children.map(E,((e,t)=>{if(t===L){const t={};return v&&(t.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===D&&(t.tabIndex=0),r.cloneElement(e,t)}return e}));return s(c,e({role:"menu",ref:I,className:w,onKeyDown:e=>{const t=C.current,r=e.key,n=a(t).activeElement;if("ArrowDown"===r)e.preventDefault(),h(t,n,F,x,p);else if("ArrowUp"===r)e.preventDefault(),h(t,n,F,x,m);else if("Home"===r)e.preventDefault(),h(t,null,F,x,p);else if("End"===r)e.preventDefault(),h(t,null,F,x,m);else if(1===r.length){const i=S.current,s=r.toLowerCase(),o=performance.now();i.keys.length>0&&(o-i.lastTime>500?(i.keys=[],i.repeating=!0,i.previousKeyMatched=!0):i.repeating&&s!==i.keys[0]&&(i.repeating=!1)),i.lastTime=o,i.keys.push(s);const l=n&&!i.repeating&&f(n,i);i.previousKeyMatched&&(l||h(t,n,!1,x,p,i))?e.preventDefault():i.previousKeyMatched=!1}j&&j(e)},tabIndex:y?0:-1},k,{children:M}))}));"production"!==process.env.NODE_ENV&&(b.propTypes={autoFocus:i.bool,autoFocusItem:i.bool,children:i.node,className:i.string,disabledItemsFocusable:i.bool,disableListWrap:i.bool,onKeyDown:i.func,variant:i.oneOf(["menu","selectedMenu"])});var g=b;export{g as default};
