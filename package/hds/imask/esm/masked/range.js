import t from"../core/change-details.js";import e from"../core/holder.js";import a from"./pattern.js";import"./base.js";import"./factory.js";import"./pattern/input-definition.js";import"./regexp.js";class r extends a{get _matchFrom(){return this.maxLength-String(this.from).length}constructor(t){super(t)}updateOptions(t){super.updateOptions(t)}_update(t){const{to:e=this.to||0,from:a=this.from||0,maxLength:r=this.maxLength||0,autofix:s=this.autofix,...h}=t;this.to=e,this.from=a,this.maxLength=Math.max(String(e).length,r),this.autofix=s;const i=String(this.from).padStart(this.maxLength,"0"),n=String(this.to).padStart(this.maxLength,"0");let p=0;for(;p<n.length&&n[p]===i[p];)++p;h.mask=n.slice(0,p).replace(/0/g,"\\0")+"0".repeat(this.maxLength-p),super._update(h)}get isComplete(){return super.isComplete&&Boolean(this.value)}boundaries(t){let e="",a="";const[,r,s]=t.match(/^(\D*)(\d*)(\D*)/)||[];return s&&(e="0".repeat(r.length)+s,a="9".repeat(r.length)+s),e=e.padEnd(this.maxLength,"0"),a=a.padEnd(this.maxLength,"9"),[e,a]}doPrepareChar(t,e){let a;return void 0===e&&(e={}),[t,a]=super.doPrepareChar(t.replace(/\D/g,""),e),t||(a.skip=!this.isComplete),[t,a]}_appendCharRaw(t,e){if(void 0===e&&(e={}),!this.autofix||this.value.length+1>this.maxLength)return super._appendCharRaw(t,e);const a=String(this.from).padStart(this.maxLength,"0"),r=String(this.to).padStart(this.maxLength,"0"),[s,h]=this.boundaries(this.value+t);return Number(h)<this.from?super._appendCharRaw(a[this.value.length],e):Number(s)>this.to?!e.tail&&"pad"===this.autofix&&this.value.length+1<this.maxLength?super._appendCharRaw(a[this.value.length],e).aggregate(this._appendCharRaw(t,e)):super._appendCharRaw(r[this.value.length],e):super._appendCharRaw(t,e)}doValidate(t){const e=this.value;if(-1===e.search(/[^0]/)&&e.length<=this._matchFrom)return!0;const[a,r]=this.boundaries(e);return this.from<=Number(r)&&Number(a)<=this.to&&super.doValidate(t)}pad(e){const a=new t;if(this.value.length===this.maxLength)return a;const r=this.value,s=this.maxLength-this.value.length;if(s){this.reset();for(let t=0;t<s;++t)a.aggregate(super._appendCharRaw("0",e));r.split("").forEach((t=>this._appendCharRaw(t)))}return a}}e.MaskedRange=r;export{r as default};
