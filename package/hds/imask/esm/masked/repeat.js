import t from"../core/change-details.js";import e from"../core/holder.js";import s,{normalizeOpts as i}from"./factory.js";import l from"./pattern.js";import"./base.js";import"./pattern/input-definition.js";import"./regexp.js";class a extends l{get repeatFrom(){var t;return null!=(t=Array.isArray(this.repeat)?this.repeat[0]:this.repeat===1/0?0:this.repeat)?t:0}get repeatTo(){var t;return null!=(t=Array.isArray(this.repeat)?this.repeat[1]:this.repeat)?t:1/0}constructor(t){super(t)}updateOptions(t){super.updateOptions(t)}_update(t){var e,l,a;const{repeat:r,...o}=i(t);this._blockOpts=Object.assign({},this._blockOpts,o);const p=s(this._blockOpts);this.repeat=null!=(e=null!=(l=null!=r?r:p.repeat)?l:this.repeat)?e:1/0,super._update({mask:"m".repeat(Math.max(this.repeatTo===1/0&&(null==(a=this._blocks)?void 0:a.length)||0,this.repeatFrom)),blocks:{m:p},eager:p.eager,overwrite:p.overwrite,skipInvalid:p.skipInvalid,lazy:p.lazy,placeholderChar:p.placeholderChar,displayChar:p.displayChar})}_allocateBlock(t){return t<this._blocks.length?this._blocks[t]:this.repeatTo===1/0||this._blocks.length<this.repeatTo?(this._blocks.push(s(this._blockOpts)),this.mask+="m",this._blocks[this._blocks.length-1]):void 0}_appendCharRaw(e,s){void 0===s&&(s={});const i=new t;for(let t,p,h=null!=(l=null==(a=this._mapPosToBlock(this.displayValue.length))?void 0:a.index)?l:Math.max(this._blocks.length-1,0);t=null!=(r=this._blocks[h])?r:p=!p&&this._allocateBlock(h);++h){var l,a,r,o;const n=t._appendChar(e,{...s,_beforeTailState:null==(o=s._beforeTailState)||null==(o=o._blocks)?void 0:o[h]});if(n.skip&&p){this._blocks.pop(),this.mask=this.mask.slice(1);break}if(i.aggregate(n),n.consumed)break}return i}_trimEmptyTail(t,e){var s,i;void 0===t&&(t=0);const l=Math.max((null==(s=this._mapPosToBlock(t))?void 0:s.index)||0,this.repeatFrom,0);let a;null!=e&&(a=null==(i=this._mapPosToBlock(e))?void 0:i.index),null==a&&(a=this._blocks.length-1);let r=0;for(let t=a;l<=t&&!this._blocks[t].unmaskedValue;--t,++r);r&&(this._blocks.splice(a-r+1,r),this.mask=this.mask.slice(r))}reset(){super.reset(),this._trimEmptyTail()}remove(t,e){void 0===t&&(t=0),void 0===e&&(e=this.displayValue.length);const s=super.remove(t,e);return this._trimEmptyTail(t,e),s}totalInputPositions(t,e){return void 0===t&&(t=0),null==e&&this.repeatTo===1/0?1/0:super.totalInputPositions(t,e)}get state(){return super.state}set state(t){this._blocks.length=t._blocks.length,this.mask=this.mask.slice(0,this._blocks.length),super.state=t}}e.RepeatBlock=a;export{a as default};
